[{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\AdminPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\AudioRecorder.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\BotTester.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":99,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3163,3166],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3163,3166],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":110,"column":21,"nodeType":"BlockStatement","messageId":"unexpected","endLine":111,"endColumn":10,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[3543,3552],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":114,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3583,3586],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3583,3586],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":146,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":146,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4308,4311],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4308,4311],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useRef, useEffect } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Send, Bot, User, Store, ShoppingCart, MapPin, CreditCard, CheckCircle, XCircle, Loader2 } from \"lucide-react\";\nimport { AudioRecorder } from \"./AudioRecorder\";\n\ninterface Message {\n  role: \"user\" | \"assistant\";\n  content: string;\n  timestamp: Date;\n}\n\ninterface OrderState {\n  selected_vendor_id?: string;\n  selected_vendor_name?: string;\n  cart: Array<{\n    product_id: string;\n    product_name: string;\n    quantity: number;\n    price: number;\n  }>;\n  delivery_address?: string;\n  payment_method?: string;\n}\n\nexport function BotTester() {\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [newMessage, setNewMessage] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const [orderState, setOrderState] = useState<OrderState>({ cart: [] });\n  const [testPhone] = useState(`test_${Date.now()}`);\n  const scrollAreaRef = useRef<HTMLDivElement>(null);\n  const { toast } = useToast();\n\n  useEffect(() => {\n    if (scrollAreaRef.current) {\n      scrollAreaRef.current.scrollTop = scrollAreaRef.current.scrollHeight;\n    }\n  }, [messages]);\n\n  const sendMessage = async () => {\n    if (!newMessage.trim() || isLoading) return;\n\n    const userMessage: Message = {\n      role: \"user\",\n      content: newMessage,\n      timestamp: new Date()\n    };\n\n    setMessages(prev => [...prev, userMessage]);\n    setNewMessage(\"\");\n    setIsLoading(true);\n\n    try {\n      // Call the bot through the evolution webhook\n      const { data, error } = await supabase.functions.invoke('evolution-webhook', {\n        body: {\n          event: 'messages.upsert',\n          data: {\n            key: {\n              remoteJid: testPhone\n            },\n            message: {\n              conversation: newMessage\n            }\n          }\n        }\n      });\n\n      if (error) throw error;\n\n      // Get updated context\n      const { data: sessionData } = await supabase\n        .from('user_sessions')\n        .select('last_bot_message')\n        .eq('phone', testPhone)\n        .maybeSingle();\n\n      if (sessionData?.last_bot_message) {\n        try {\n          const context = JSON.parse(sessionData.last_bot_message);\n          setOrderState({\n            selected_vendor_id: context.selected_vendor_id,\n            selected_vendor_name: context.selected_vendor_name,\n            cart: context.cart || [],\n            delivery_address: context.delivery_address,\n            payment_method: context.payment_method\n          });\n\n          // Get last assistant message from conversation history\n          if (context.conversation_history && context.conversation_history.length > 0) {\n            const lastAssistant = [...context.conversation_history]\n              .reverse()\n              .find((msg: any) => msg.role === \"assistant\");\n            \n            if (lastAssistant) {\n              const assistantMessage: Message = {\n                role: \"assistant\",\n                content: lastAssistant.content,\n                timestamp: new Date()\n              };\n              setMessages(prev => [...prev, assistantMessage]);\n            }\n          }\n        } catch (e) {\n        }\n      }\n\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Error al enviar mensaje\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleKeyPress = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      sendMessage();\n    }\n  };\n\n  const clearSession = async () => {\n    try {\n      await supabase\n        .from('user_sessions')\n        .delete()\n        .eq('phone', testPhone);\n      \n      setMessages([]);\n      setOrderState({ cart: [] });\n      \n      toast({\n        title: \"Sesi√≥n limpiada\",\n        description: \"Puedes empezar una nueva conversaci√≥n\"\n      });\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\"\n      });\n    }\n  };\n\n  const isOrderComplete = !!(\n    orderState.selected_vendor_id &&\n    orderState.cart.length > 0 &&\n    orderState.delivery_address &&\n    orderState.payment_method\n  );\n\n  const cartTotal = orderState.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);\n\n  return (\n    <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n      {/* Chat Interface */}\n      <Card className=\"flex flex-col h-[600px]\">\n        <CardHeader className=\"bg-gradient-primary text-white rounded-t-lg flex-shrink-0\">\n          <div className=\"flex items-center justify-between\">\n            <CardTitle className=\"flex items-center gap-2\">\n              <Bot className=\"h-5 w-5\" />\n              Chat con el Bot\n            </CardTitle>\n            <Button \n              variant=\"ghost\" \n              size=\"sm\" \n              onClick={clearSession}\n              className=\"text-white hover:bg-white/20\"\n            >\n              Limpiar\n            </Button>\n          </div>\n          <p className=\"text-sm opacity-90\">Prueba el bot conversacional</p>\n        </CardHeader>\n\n        <CardContent className=\"flex-1 p-0 overflow-hidden flex flex-col\">\n          <ScrollArea className=\"flex-1 p-4\" ref={scrollAreaRef}>\n            <div className=\"space-y-4\">\n              {messages.length === 0 && (\n                <div className=\"text-center text-muted-foreground py-8\">\n                  <Bot className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                  <p>Env√≠a un mensaje para comenzar</p>\n                  <p className=\"text-sm mt-2\">Ej: \"Quiero una pizza\"</p>\n                </div>\n              )}\n              {messages.map((message, i) => (\n                <div\n                  key={i}\n                  className={`flex ${message.role === \"user\" ? \"justify-end\" : \"justify-start\"}`}\n                >\n                  <div\n                    className={`max-w-[80%] rounded-2xl px-4 py-2 shadow-sm ${\n                      message.role === \"user\"\n                        ? \"bg-primary text-primary-foreground rounded-br-none\"\n                        : \"bg-muted rounded-bl-none\"\n                    }`}\n                  >\n                    <div className=\"flex items-start gap-2\">\n                      {message.role === \"assistant\" && <Bot className=\"h-4 w-4 mt-1\" />}\n                      {message.role === \"user\" && <User className=\"h-4 w-4 mt-1\" />}\n                      <div className=\"flex-1\">\n                        <p className=\"text-sm whitespace-pre-wrap\">{message.content}</p>\n                        <p className={`text-xs mt-1 ${\n                          message.role === \"user\" ? \"text-primary-foreground/70\" : \"text-muted-foreground\"\n                        }`}>\n                          {message.timestamp.toLocaleTimeString('es-AR', {\n                            hour: '2-digit',\n                            minute: '2-digit'\n                          })}\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              ))}\n              {isLoading && (\n                <div className=\"flex justify-start\">\n                  <div className=\"bg-muted rounded-2xl px-4 py-2 rounded-bl-none\">\n                    <Loader2 className=\"h-4 w-4 animate-spin\" />\n                  </div>\n                </div>\n              )}\n            </div>\n          </ScrollArea>\n\n          <div className=\"border-t p-4 flex-shrink-0\">\n            <div className=\"flex gap-2\">\n              <AudioRecorder \n                onTranscription={(text) => {\n                  setNewMessage(text);\n                }} \n              />\n              <Input\n                value={newMessage}\n                onChange={(e) => setNewMessage(e.target.value)}\n                onKeyPress={handleKeyPress}\n                placeholder=\"Escribe un mensaje o usa el micr√≥fono...\"\n                disabled={isLoading}\n                className=\"flex-1\"\n              />\n              <Button\n                onClick={sendMessage}\n                disabled={!newMessage.trim() || isLoading}\n                className=\"bg-gradient-primary hover:opacity-90\"\n              >\n                <Send className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Order State Visualization */}\n      <Card className=\"h-[600px] flex flex-col\">\n        <CardHeader className=\"flex-shrink-0\">\n          <CardTitle className=\"flex items-center gap-2\">\n            <ShoppingCart className=\"h-5 w-5\" />\n            Estado del Pedido\n          </CardTitle>\n          <div className=\"flex items-center gap-2 mt-2\">\n            {isOrderComplete ? (\n              <Badge variant=\"default\" className=\"bg-green-500\">\n                <CheckCircle className=\"h-3 w-3 mr-1\" />\n                Completo\n              </Badge>\n            ) : (\n              <Badge variant=\"secondary\">\n                <XCircle className=\"h-3 w-3 mr-1\" />\n                Incompleto\n              </Badge>\n            )}\n          </div>\n        </CardHeader>\n\n        <CardContent className=\"flex-1 overflow-auto space-y-4\">\n          {/* Vendor */}\n          <div className=\"border rounded-lg p-3\">\n            <div className=\"flex items-center gap-2 mb-2\">\n              <Store className={`h-4 w-4 ${orderState.selected_vendor_id ? 'text-green-500' : 'text-muted-foreground'}`} />\n              <span className=\"font-medium text-sm\">Negocio</span>\n            </div>\n            {orderState.selected_vendor_name ? (\n              <div className=\"ml-6\">\n                <p className=\"text-sm font-medium\">{orderState.selected_vendor_name}</p>\n                <p className=\"text-xs text-muted-foreground\">ID: {orderState.selected_vendor_id?.substring(0, 8)}</p>\n              </div>\n            ) : (\n              <p className=\"text-sm text-muted-foreground ml-6\">No seleccionado</p>\n            )}\n          </div>\n\n          {/* Cart */}\n          <div className=\"border rounded-lg p-3\">\n            <div className=\"flex items-center gap-2 mb-2\">\n              <ShoppingCart className={`h-4 w-4 ${orderState.cart.length > 0 ? 'text-green-500' : 'text-muted-foreground'}`} />\n              <span className=\"font-medium text-sm\">Carrito ({orderState.cart.length})</span>\n            </div>\n            {orderState.cart.length > 0 ? (\n              <div className=\"ml-6 space-y-2\">\n                {orderState.cart.map((item, i) => (\n                  <div key={i} className=\"text-sm border-l-2 border-primary/30 pl-2\">\n                    <p className=\"font-medium\">{item.product_name}</p>\n                    <p className=\"text-xs text-muted-foreground\">\n                      {item.quantity}x ${item.price} = ${item.price * item.quantity}\n                    </p>\n                  </div>\n                ))}\n                <div className=\"pt-2 border-t mt-2\">\n                  <p className=\"font-bold text-sm\">Total: ${cartTotal}</p>\n                </div>\n              </div>\n            ) : (\n              <p className=\"text-sm text-muted-foreground ml-6\">Vac√≠o</p>\n            )}\n          </div>\n\n          {/* Address */}\n          <div className=\"border rounded-lg p-3\">\n            <div className=\"flex items-center gap-2 mb-2\">\n              <MapPin className={`h-4 w-4 ${orderState.delivery_address ? 'text-green-500' : 'text-muted-foreground'}`} />\n              <span className=\"font-medium text-sm\">Direcci√≥n de Entrega</span>\n            </div>\n            {orderState.delivery_address ? (\n              <p className=\"text-sm ml-6\">{orderState.delivery_address}</p>\n            ) : (\n              <p className=\"text-sm text-muted-foreground ml-6\">No especificada</p>\n            )}\n          </div>\n\n          {/* Payment Method */}\n          <div className=\"border rounded-lg p-3\">\n            <div className=\"flex items-center gap-2 mb-2\">\n              <CreditCard className={`h-4 w-4 ${orderState.payment_method ? 'text-green-500' : 'text-muted-foreground'}`} />\n              <span className=\"font-medium text-sm\">M√©todo de Pago</span>\n            </div>\n            {orderState.payment_method ? (\n              <p className=\"text-sm ml-6 capitalize\">{orderState.payment_method}</p>\n            ) : (\n              <p className=\"text-sm text-muted-foreground ml-6\">No especificado</p>\n            )}\n          </div>\n\n          {/* Order Ready Status */}\n          {isOrderComplete && (\n            <div className=\"border-2 border-green-500 rounded-lg p-3 bg-green-50 dark:bg-green-950/20\">\n              <div className=\"flex items-center gap-2 text-green-600 dark:text-green-400\">\n                <CheckCircle className=\"h-5 w-5\" />\n                <span className=\"font-bold\">¬°Pedido listo para crear!</span>\n              </div>\n              <p className=\"text-sm text-green-600/80 dark:text-green-400/80 mt-1\">\n                Todos los datos necesarios est√°n completos\n              </p>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\ChatInterface.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\EvolutionConfig.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\NotificationCenter.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\OrderCancellationDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\OrderCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\OrderTracking.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\PWAInstallPrompt.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\PlatformReviewForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\SubdomainRouter.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\VendorAnalyticsDashboard.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchAnalytics'. Either include it or remove the dependency array.","line":72,"column":6,"nodeType":"ArrayExpression","endLine":72,"endColumn":24,"suggestions":[{"desc":"Update the dependencies array to be: [vendorId, period, fetchAnalytics]","fix":{"range":[1766,1784],"text":"[vendorId, period, fetchAnalytics]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useMemo } from 'react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\nimport { Tabs, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Loader2, TrendingUp, Package, Clock, DollarSign, ShoppingCart, Star } from 'lucide-react';\nimport { format, subDays, startOfDay, parseISO, getHours } from 'date-fns';\nimport { es } from 'date-fns/locale';\nimport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n} from '@/components/ui/chart';\nimport {\n  AreaChart,\n  Area,\n  BarChart,\n  Bar,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  ResponsiveContainer,\n  Cell,\n} from 'recharts';\n\ninterface VendorAnalyticsDashboardProps {\n  vendorId: string;\n}\n\ninterface DailySale {\n  date: string;\n  dateLabel: string;\n  total: number;\n  orders: number;\n}\n\ninterface TopProduct {\n  name: string;\n  quantity: number;\n  revenue: number;\n}\n\ninterface PeakHour {\n  hour: string;\n  hourNum: number;\n  orders: number;\n}\n\ninterface OrderItem {\n  product_id?: string;\n  product_name?: string;\n  name?: string;\n  quantity: number;\n  price: number;\n}\n\nexport function VendorAnalyticsDashboard({ vendorId }: VendorAnalyticsDashboardProps) {\n  const [period, setPeriod] = useState<'7d' | '30d' | 'all'>('7d');\n  const [loading, setLoading] = useState(true);\n  const [dailySales, setDailySales] = useState<DailySale[]>([]);\n  const [topProducts, setTopProducts] = useState<TopProduct[]>([]);\n  const [peakHours, setPeakHours] = useState<PeakHour[]>([]);\n  const [summary, setSummary] = useState({\n    totalRevenue: 0,\n    totalOrders: 0,\n    avgTicket: 0,\n    peakHour: '',\n    topProduct: '',\n  });\n\n  useEffect(() => {\n    fetchAnalytics();\n  }, [vendorId, period]);\n\n  const getDateFilter = () => {\n    const now = new Date();\n    switch (period) {\n      case '7d':\n        return subDays(now, 7).toISOString();\n      case '30d':\n        return subDays(now, 30).toISOString();\n      default:\n        return null;\n    }\n  };\n\n  const fetchAnalytics = async () => {\n    setLoading(true);\n    try {\n      const dateFilter = getDateFilter();\n      \n      let query = supabase\n        .from('orders')\n        .select('total, created_at, items, status')\n        .eq('vendor_id', vendorId)\n        .in('status', ['delivered', 'confirmed', 'preparing', 'ready', 'delivering']);\n\n      if (dateFilter) {\n        query = query.gte('created_at', dateFilter);\n      }\n\n      const { data: orders, error } = await query;\n\n      if (error) {\n        console.error('Error fetching analytics:', error);\n        return;\n      }\n\n      if (!orders || orders.length === 0) {\n        setDailySales([]);\n        setTopProducts([]);\n        setPeakHours([]);\n        setSummary({\n          totalRevenue: 0,\n          totalOrders: 0,\n          avgTicket: 0,\n          peakHour: '',\n          topProduct: '',\n        });\n        setLoading(false);\n        return;\n      }\n\n      // Process daily sales\n      const salesByDay = new Map<string, { total: number; orders: number }>();\n      const productSales = new Map<string, { quantity: number; revenue: number }>();\n      const hourCounts = new Map<number, number>();\n\n      orders.forEach((order) => {\n        // Daily sales\n        const date = startOfDay(parseISO(order.created_at)).toISOString();\n        const existing = salesByDay.get(date) || { total: 0, orders: 0 };\n        salesByDay.set(date, {\n          total: existing.total + order.total,\n          orders: existing.orders + 1,\n        });\n\n        // Peak hours\n        const hour = getHours(parseISO(order.created_at));\n        hourCounts.set(hour, (hourCounts.get(hour) || 0) + 1);\n\n        // Top products\n        const items = order.items as unknown as OrderItem[];\n        if (Array.isArray(items)) {\n          items.forEach((item) => {\n            const productName = item.product_name || item.name || 'Producto';\n            const existing = productSales.get(productName) || { quantity: 0, revenue: 0 };\n            productSales.set(productName, {\n              quantity: existing.quantity + item.quantity,\n              revenue: existing.revenue + item.price * item.quantity,\n            });\n          });\n        }\n      });\n\n      // Format daily sales\n      const dailySalesArray: DailySale[] = Array.from(salesByDay.entries())\n        .map(([date, data]) => ({\n          date,\n          dateLabel: format(parseISO(date), 'dd MMM', { locale: es }),\n          total: data.total,\n          orders: data.orders,\n        }))\n        .sort((a, b) => a.date.localeCompare(b.date));\n\n      // Format top products (top 8)\n      const topProductsArray: TopProduct[] = Array.from(productSales.entries())\n        .map(([name, data]) => ({\n          name: name.length > 20 ? name.substring(0, 20) + '...' : name,\n          quantity: data.quantity,\n          revenue: data.revenue,\n        }))\n        .sort((a, b) => b.quantity - a.quantity)\n        .slice(0, 8);\n\n      // Format peak hours (8:00 - 23:00)\n      const peakHoursArray: PeakHour[] = [];\n      for (let h = 8; h <= 23; h++) {\n        peakHoursArray.push({\n          hour: `${h}:00`,\n          hourNum: h,\n          orders: hourCounts.get(h) || 0,\n        });\n      }\n\n      // Calculate summary\n      const totalRevenue = orders.reduce((sum, o) => sum + o.total, 0);\n      const totalOrders = orders.length;\n      const avgTicket = totalOrders > 0 ? totalRevenue / totalOrders : 0;\n      \n      let maxHour = 0;\n      let maxHourCount = 0;\n      hourCounts.forEach((count, hour) => {\n        if (count > maxHourCount) {\n          maxHourCount = count;\n          maxHour = hour;\n        }\n      });\n\n      setDailySales(dailySalesArray);\n      setTopProducts(topProductsArray);\n      setPeakHours(peakHoursArray);\n      setSummary({\n        totalRevenue,\n        totalOrders,\n        avgTicket,\n        peakHour: maxHourCount > 0 ? `${maxHour}:00` : 'N/A',\n        topProduct: topProductsArray[0]?.name || 'N/A',\n      });\n    } catch (error) {\n      console.error('Error in fetchAnalytics:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const chartConfig = {\n    total: {\n      label: 'Ventas',\n      color: 'hsl(var(--primary))',\n    },\n    orders: {\n      label: 'Pedidos',\n      color: 'hsl(var(--chart-2))',\n    },\n    quantity: {\n      label: 'Cantidad',\n      color: 'hsl(var(--chart-3))',\n    },\n  };\n\n  const maxOrders = useMemo(() => {\n    return Math.max(...peakHours.map(h => h.orders), 1);\n  }, [peakHours]);\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  const hasData = summary.totalOrders > 0;\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Period selector */}\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\n        <div>\n          <h2 className=\"text-2xl font-bold\">Analytics de Ventas</h2>\n          <p className=\"text-muted-foreground\">Estad√≠sticas de tu negocio</p>\n        </div>\n        <Tabs value={period} onValueChange={(v) => setPeriod(v as typeof period)}>\n          <TabsList>\n            <TabsTrigger value=\"7d\">7 d√≠as</TabsTrigger>\n            <TabsTrigger value=\"30d\">30 d√≠as</TabsTrigger>\n            <TabsTrigger value=\"all\">Todo</TabsTrigger>\n          </TabsList>\n        </Tabs>\n      </div>\n\n      {/* Summary cards */}\n      <div className=\"grid gap-4 grid-cols-2 lg:grid-cols-5\">\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-2\">\n              <DollarSign className=\"h-4 w-4 text-primary\" />\n              <span className=\"text-sm text-muted-foreground\">Ingresos</span>\n            </div>\n            <p className=\"text-2xl font-bold mt-1\">\n              ‚Ç≤{summary.totalRevenue.toLocaleString()}\n            </p>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-2\">\n              <ShoppingCart className=\"h-4 w-4 text-chart-2\" />\n              <span className=\"text-sm text-muted-foreground\">Pedidos</span>\n            </div>\n            <p className=\"text-2xl font-bold mt-1\">{summary.totalOrders}</p>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-2\">\n              <TrendingUp className=\"h-4 w-4 text-chart-3\" />\n              <span className=\"text-sm text-muted-foreground\">Ticket Prom.</span>\n            </div>\n            <p className=\"text-2xl font-bold mt-1\">\n              ‚Ç≤{Math.round(summary.avgTicket).toLocaleString()}\n            </p>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-2\">\n              <Clock className=\"h-4 w-4 text-chart-4\" />\n              <span className=\"text-sm text-muted-foreground\">Hora Pico</span>\n            </div>\n            <p className=\"text-2xl font-bold mt-1\">{summary.peakHour}</p>\n          </CardContent>\n        </Card>\n        <Card className=\"col-span-2 lg:col-span-1\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-2\">\n              <Star className=\"h-4 w-4 text-chart-5\" />\n              <span className=\"text-sm text-muted-foreground\">Top Producto</span>\n            </div>\n            <p className=\"text-lg font-bold mt-1 truncate\" title={summary.topProduct}>\n              {summary.topProduct}\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n\n      {!hasData ? (\n        <Card className=\"py-12\">\n          <CardContent className=\"text-center\">\n            <Package className=\"h-12 w-12 mx-auto text-muted-foreground/50 mb-4\" />\n            <h3 className=\"text-lg font-semibold mb-2\">Sin datos suficientes</h3>\n            <p className=\"text-muted-foreground\">\n              A√∫n no hay pedidos en este per√≠odo para mostrar estad√≠sticas\n            </p>\n          </CardContent>\n        </Card>\n      ) : (\n        <>\n          {/* Daily Sales Chart */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <TrendingUp className=\"h-5 w-5 text-primary\" />\n                Ventas Diarias\n              </CardTitle>\n              <CardDescription>\n                Ingresos y cantidad de pedidos por d√≠a\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <ChartContainer config={chartConfig} className=\"h-[300px] w-full\">\n                <AreaChart data={dailySales} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>\n                  <defs>\n                    <linearGradient id=\"colorTotal\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                      <stop offset=\"5%\" stopColor=\"hsl(var(--primary))\" stopOpacity={0.3} />\n                      <stop offset=\"95%\" stopColor=\"hsl(var(--primary))\" stopOpacity={0} />\n                    </linearGradient>\n                  </defs>\n                  <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\n                  <XAxis \n                    dataKey=\"dateLabel\" \n                    tick={{ fontSize: 12 }}\n                    tickLine={false}\n                    axisLine={false}\n                  />\n                  <YAxis \n                    tick={{ fontSize: 12 }}\n                    tickLine={false}\n                    axisLine={false}\n                    tickFormatter={(value) => `‚Ç≤${(value / 1000).toFixed(0)}k`}\n                  />\n                  <ChartTooltip \n                    content={\n                      <ChartTooltipContent \n                        formatter={(value, name) => {\n                          if (name === 'total') return [`‚Ç≤${Number(value).toLocaleString()}`, 'Ventas'];\n                          return [value, 'Pedidos'];\n                        }}\n                      />\n                    } \n                  />\n                  <Area\n                    type=\"monotone\"\n                    dataKey=\"total\"\n                    stroke=\"hsl(var(--primary))\"\n                    strokeWidth={2}\n                    fill=\"url(#colorTotal)\"\n                  />\n                </AreaChart>\n              </ChartContainer>\n            </CardContent>\n          </Card>\n\n          {/* Two column layout for smaller charts */}\n          <div className=\"grid gap-6 lg:grid-cols-2\">\n            {/* Top Products */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Package className=\"h-5 w-5 text-chart-3\" />\n                  Productos M√°s Vendidos\n                </CardTitle>\n                <CardDescription>\n                  Top 8 productos por cantidad vendida\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                {topProducts.length > 0 ? (\n                  <ChartContainer config={chartConfig} className=\"h-[300px] w-full\">\n                    <BarChart \n                      data={topProducts} \n                      layout=\"vertical\"\n                      margin={{ top: 5, right: 30, left: 20, bottom: 5 }}\n                    >\n                      <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" horizontal={false} />\n                      <XAxis type=\"number\" tick={{ fontSize: 12 }} />\n                      <YAxis \n                        type=\"category\" \n                        dataKey=\"name\" \n                        tick={{ fontSize: 11 }}\n                        width={100}\n                        tickLine={false}\n                      />\n                      <ChartTooltip \n                        content={\n                          <ChartTooltipContent \n                            formatter={(value, name, item) => {\n                              const payload = item.payload as TopProduct;\n                              return [\n                                <div key=\"tooltip\" className=\"flex flex-col gap-1\">\n                                  <span>Cantidad: {payload.quantity}</span>\n                                  <span>Ingresos: ‚Ç≤{payload.revenue.toLocaleString()}</span>\n                                </div>,\n                                ''\n                              ];\n                            }}\n                          />\n                        }\n                      />\n                      <Bar \n                        dataKey=\"quantity\" \n                        fill=\"hsl(var(--chart-3))\"\n                        radius={[0, 4, 4, 0]}\n                      />\n                    </BarChart>\n                  </ChartContainer>\n                ) : (\n                  <div className=\"h-[300px] flex items-center justify-center text-muted-foreground\">\n                    No hay datos de productos\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n\n            {/* Peak Hours */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Clock className=\"h-5 w-5 text-chart-4\" />\n                  Horarios Pico\n                </CardTitle>\n                <CardDescription>\n                  Distribuci√≥n de pedidos por hora del d√≠a\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <ChartContainer config={chartConfig} className=\"h-[300px] w-full\">\n                  <BarChart data={peakHours} margin={{ top: 5, right: 10, left: -10, bottom: 5 }}>\n                    <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" vertical={false} />\n                    <XAxis \n                      dataKey=\"hour\" \n                      tick={{ fontSize: 10 }}\n                      tickLine={false}\n                      interval={1}\n                    />\n                    <YAxis \n                      tick={{ fontSize: 12 }}\n                      tickLine={false}\n                      axisLine={false}\n                      allowDecimals={false}\n                    />\n                    <ChartTooltip \n                      content={\n                        <ChartTooltipContent \n                          formatter={(value) => [`${value} pedidos`, '']}\n                        />\n                      }\n                    />\n                    <Bar dataKey=\"orders\" radius={[4, 4, 0, 0]}>\n                      {peakHours.map((entry, index) => (\n                        <Cell \n                          key={`cell-${index}`}\n                          fill={entry.orders === maxOrders && entry.orders > 0\n                            ? 'hsl(var(--chart-1))'\n                            : 'hsl(var(--chart-4))'\n                          }\n                        />\n                      ))}\n                    </Bar>\n                  </BarChart>\n                </ChartContainer>\n              </CardContent>\n            </Card>\n          </div>\n        </>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\VendorCatalog.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":32,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1030,1033],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1030,1033],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":96,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3021,3024],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3021,3024],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { MapPin, Clock, Phone, Star, Store, Pizza, Coffee, Package } from \"lucide-react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { isVendorOpen, getCurrentDayInArgentina, getCurrentTimeInArgentina } from \"@/lib/timezone\";\n\ninterface Product {\n  id?: string;\n  name: string;\n  price: number;\n  description?: string;\n  category?: string;\n}\n\n// Define interface for public vendor view (which doesn't expose sensitive data)\ninterface PublicVendor {\n  id: string;\n  name: string;\n  category: string;\n  is_active: boolean;\n  rating: number;\n  total_orders: number;\n  opening_time: string | null;\n  closing_time: string | null;\n  days_open: string[] | null;\n  image: string | null;\n  joined_at: string | null;\n  address_area: string | null;\n  has_products: boolean;\n  available_products: any;\n  products?: Product[];\n}\n\nexport function VendorCatalog() {\n  const [vendors, setVendors] = useState<PublicVendor[]>([]);\n  const [selectedCategory, setSelectedCategory] = useState<string>(\"all\");\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    fetchVendors();\n  }, []);\n\n  const fetchVendors = async () => {\n    try {\n      // Use the secure public_vendors view that doesn't expose sensitive data\n      const { data: vendorsData, error: vendorsError } = await supabase\n        .from('public_vendors')\n        .select('*')\n        .order('rating', { ascending: false });\n\n      if (vendorsError) throw vendorsError;\n\n      // Parse available_products JSON for each vendor\n      const vendorsWithProducts = vendorsData?.map(vendor => ({\n        ...vendor,\n        // Map the simplified address from the view\n        address: vendor.address_area || 'Ubicaci√≥n no disponible',\n        // Note: phone and whatsapp_number are not available in public view for security\n        phone: null,\n        whatsapp_number: null,\n        products: vendor.available_products ? \n          (Array.isArray(vendor.available_products) ? \n            (vendor.available_products as unknown as Product[]) : \n            []) : []\n      })) || [];\n\n      setVendors(vendorsWithProducts);\n    } catch (error) {\n      console.error('Error fetching vendors:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const isOpen = (vendor: PublicVendor) => {\n    return isVendorOpen(\n      vendor.days_open,\n      vendor.opening_time,\n      vendor.closing_time,\n      false\n    );\n  };\n\n  const filteredVendors = selectedCategory === \"all\" \n    ? vendors \n    : vendors.filter(v => v.category === selectedCategory);\n\n  // Get unique categories from vendors\n  const uniqueCategories = Array.from(new Set(vendors.map(v => v.category)));\n  \n  const categories = [\n    { id: \"all\", label: \"Todos\", icon: Store },\n    ...uniqueCategories.map(cat => {\n      const iconMap: Record<string, any> = {\n        'Pizzer√≠a': Pizza,\n        'Sushi': 'üç±',\n        'Hamburgueser√≠a': 'üçî',\n        'Empanadas': 'ü•ü',\n        'Pastas': 'üçù',\n        'Cafeter√≠a': Coffee,\n      };\n      return {\n        id: cat,\n        label: cat,\n        icon: iconMap[cat] || Package\n      };\n    })\n  ];\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[400px]\">\n        <div className=\"animate-pulse text-primary\">Cargando locales...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Category Filters */}\n      <div className=\"flex gap-2 overflow-x-auto pb-2\">\n        {categories.map((cat) => (\n          <Button\n            key={cat.id}\n            variant={selectedCategory === cat.id ? \"default\" : \"outline\"}\n            onClick={() => setSelectedCategory(cat.id)}\n            className=\"whitespace-nowrap\"\n          >\n            <span className=\"mr-2\">\n              {typeof cat.icon === 'string' ? cat.icon : <cat.icon className=\"h-4 w-4\" />}\n            </span>\n            {cat.label}\n          </Button>\n        ))}\n      </div>\n\n      {/* Vendors Grid */}\n      <div className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3\">\n        {filteredVendors.map((vendor) => (\n          <Card key={vendor.id} className=\"hover:shadow-lg transition-shadow\">\n            <CardHeader>\n              <div className=\"flex justify-between items-start\">\n                <div>\n                  <CardTitle className=\"text-xl\">{vendor.name}</CardTitle>\n                  <div className=\"flex items-center gap-2 mt-1\">\n                    <Star className=\"h-4 w-4 fill-primary text-primary\" />\n                    <span className=\"text-sm font-medium\">{vendor.rating.toFixed(1)}</span>\n                    <span className=\"text-sm text-muted-foreground\">\n                      ({vendor.total_orders} pedidos)\n                    </span>\n                  </div>\n                </div>\n                <Badge variant={isOpen(vendor) ? \"default\" : \"secondary\"}>\n                  {isOpen(vendor) ? \"Abierto\" : \"Cerrado\"}\n                </Badge>\n              </div>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              {/* Info b√°sica */}\n              <div className=\"space-y-2 text-sm\">\n                <div className=\"flex items-center gap-2\">\n                  <MapPin className=\"h-4 w-4 text-muted-foreground\" />\n                  <span>{vendor.address_area || 'Ubicaci√≥n no disponible'}</span>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Clock className=\"h-4 w-4 text-muted-foreground\" />\n                  <span>{vendor.opening_time?.slice(0,5)} - {vendor.closing_time?.slice(0,5)}</span>\n                </div>\n              </div>\n\n              {/* Men√∫ con productos */}\n              {vendor.products && vendor.products.length > 0 && (\n                <div className=\"border-t pt-4\">\n                  <h4 className=\"font-semibold mb-3\">Men√∫</h4>\n                  <div className=\"space-y-2 max-h-60 overflow-y-auto\">\n                    {vendor.products.slice(0, 5).map((product) => (\n                      <div key={product.id} className=\"flex justify-between items-start\">\n                        <div className=\"flex-1\">\n                          <p className=\"text-sm font-medium\">{product.name}</p>\n                          {product.description && (\n                            <p className=\"text-xs text-muted-foreground\">{product.description}</p>\n                          )}\n                        </div>\n                        <span className=\"text-sm font-semibold text-primary\">\n                          ${product.price}\n                        </span>\n                      </div>\n                    ))}\n                    {vendor.products.length > 5 && (\n                      <p className=\"text-xs text-muted-foreground text-center pt-2\">\n                        +{vendor.products.length - 5} productos m√°s\n                      </p>\n                    )}\n                  </div>\n                </div>\n              )}\n\n              {/* Contact info is now protected - vendors must be contacted through the WhatsApp bot */}\n              <div className=\"text-center text-sm text-muted-foreground bg-muted/50 rounded-lg p-3\">\n                <p>Para realizar pedidos, usa nuestro servicio de WhatsApp</p>\n                <p className=\"font-semibold mt-1\">Env√≠a un mensaje al bot de pedidos</p>\n              </div>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      {filteredVendors.length === 0 && (\n        <Card className=\"p-8 text-center\">\n          <p className=\"text-muted-foreground\">\n            No hay locales disponibles en esta categor√≠a\n          </p>\n        </Card>\n      )}\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\VendorDashboardWithRealtime.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\VendorDirectChat.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchActiveChats', 'fetchVendorInfo', and 'setupRealtimeSubscription'. Either include them or remove the dependency array.","line":50,"column":6,"nodeType":"ArrayExpression","endLine":50,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [fetchActiveChats, fetchVendorInfo, setupRealtimeSubscription, vendorId]","fix":{"range":[1674,1684],"text":"[fetchActiveChats, fetchVendorInfo, setupRealtimeSubscription, vendorId]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { supabase } from '@/integrations/supabase/client';\nimport { useToast } from '@/hooks/use-toast';\nimport { MessageCircle, Send, User, Bot, Users } from 'lucide-react';\nimport { format } from 'date-fns';\nimport { es } from 'date-fns/locale';\n\ninterface Chat {\n  id: string;\n  customer_phone: string;\n  is_active: boolean;\n  vendor_agent_name?: string;\n  started_at: Date;\n  ended_at?: Date;\n}\n\ninterface ChatMessage {\n  id: string;\n  chat_id: string;\n  sender_type: 'customer' | 'vendor' | 'bot';\n  message: string;\n  created_at: Date;\n}\n\ninterface VendorDirectChatProps {\n  vendorId: string;\n}\n\nexport function VendorDirectChat({ vendorId }: VendorDirectChatProps) {\n  const [activeChats, setActiveChats] = useState<Chat[]>([]);\n  const [selectedChat, setSelectedChat] = useState<Chat | null>(null);\n  const [messages, setMessages] = useState<ChatMessage[]>([]);\n  const [newMessage, setNewMessage] = useState('');\n  const [loading, setLoading] = useState(true);\n  const [vendorName, setVendorName] = useState<string>('');\n  const [vendorPhone, setVendorPhone] = useState<string>('');\n  const { toast } = useToast();\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const scrollAreaRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    fetchVendorInfo();\n    fetchActiveChats();\n    setupRealtimeSubscription();\n  }, [vendorId]);\n\n  useEffect(() => {\n    if (selectedChat) {\n      fetchMessages(selectedChat.id);\n    }\n  }, [selectedChat]);\n\n  useEffect(() => {\n    // Scroll to bottom whenever messages change\n    if (messages.length > 0) {\n      const timer = setTimeout(() => {\n        if (messagesEndRef.current) {\n          messagesEndRef.current.scrollIntoView({ \n            behavior: 'smooth', \n            block: 'end', \n            inline: 'nearest' \n          });\n        }\n        // Tambi√©n intentar con el scrollArea directamente\n        if (scrollAreaRef.current) {\n          const scrollContainer = scrollAreaRef.current.querySelector('[data-radix-scroll-area-viewport]');\n          if (scrollContainer) {\n            scrollContainer.scrollTop = scrollContainer.scrollHeight;\n          }\n        }\n      }, 200);\n      return () => clearTimeout(timer);\n    }\n  }, [messages]);\n\n  const setupRealtimeSubscription = () => {\n    const channel = supabase\n      .channel(`vendor-chats-${vendorId}`)\n      .on(\n        'postgres_changes',\n        {\n          event: 'INSERT',\n          schema: 'public',\n          table: 'vendor_chats',\n          filter: `vendor_id=eq.${vendorId}`\n        },\n        (payload) => {\n          const newChat = {\n            ...payload.new,\n            started_at: new Date(payload.new.started_at),\n            ended_at: payload.new.ended_at ? new Date(payload.new.ended_at) : undefined\n          } as Chat;\n          \n          setActiveChats(prev => [newChat, ...prev]);\n          \n          toast({\n            title: 'üí¨ Nuevo chat',\n            description: `Cliente ${newChat.customer_phone} quiere hablar contigo`\n          });\n        }\n      )\n      .on(\n        'postgres_changes',\n        {\n          event: 'INSERT',\n          schema: 'public',\n          table: 'chat_messages'\n        },\n        (payload) => {\n          const newMessage = {\n            ...payload.new,\n            created_at: new Date(payload.new.created_at)\n          } as ChatMessage;\n          \n          if (selectedChat && newMessage.chat_id === selectedChat.id) {\n            \n            // Evitar duplicados verificando si el mensaje ya existe\n            setMessages(prev => {\n              const exists = prev.some(msg => msg.id === newMessage.id);\n              if (exists) {\n                return prev;\n              }\n              return [...prev, newMessage];\n            });\n            \n            // Forzar scroll inmediatamente\n            setTimeout(() => {\n              if (messagesEndRef.current) {\n                messagesEndRef.current.scrollIntoView({ behavior: 'smooth', block: 'end' });\n              }\n              if (scrollAreaRef.current) {\n                const scrollContainer = scrollAreaRef.current.querySelector('[data-radix-scroll-area-viewport]');\n                if (scrollContainer) {\n                  scrollContainer.scrollTop = scrollContainer.scrollHeight;\n                }\n              }\n            }, 100);\n          }\n          \n          if (newMessage.sender_type === 'customer') {\n            toast({\n              title: 'üì© Nuevo mensaje',\n              description: newMessage.message.substring(0, 50) + (newMessage.message.length > 50 ? '...' : '')\n            });\n          }\n        }\n      )\n      .subscribe();\n\n    return () => {\n      supabase.removeChannel(channel);\n    };\n  };\n\n  const scrollToBottom = () => {\n    setTimeout(() => {\n      messagesEndRef.current?.scrollIntoView({ behavior: 'smooth', block: 'end' });\n    }, 100);\n  };\n\n  const fetchVendorInfo = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('vendors')\n        .select('name, phone, whatsapp_number')\n        .eq('id', vendorId)\n        .single();\n\n      if (error) throw error;\n\n      setVendorName(data?.name || 'el vendedor');\n      // Usar whatsapp_number si existe, sino phone\n      setVendorPhone(data?.whatsapp_number || data?.phone || '');\n    } catch (error) {\n      console.error('Error fetching vendor info:', error);\n      setVendorName('el vendedor');\n    }\n  };\n\n  const fetchActiveChats = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('vendor_chats')\n        .select('*')\n        .eq('vendor_id', vendorId)\n        .eq('is_active', true)\n        .order('started_at', { ascending: false });\n\n      if (error) throw error;\n\n      setActiveChats(data?.map(chat => ({\n        ...chat,\n        started_at: new Date(chat.started_at),\n        ended_at: chat.ended_at ? new Date(chat.ended_at) : undefined\n      })) || []);\n    } catch (error) {\n      console.error('Error fetching chats:', error);\n      toast({\n        title: 'Error',\n        description: 'No se pudieron cargar los chats',\n        variant: 'destructive'\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchMessages = async (chatId: string) => {\n    try {\n      const { data, error } = await supabase\n        .from('chat_messages')\n        .select('*')\n        .eq('chat_id', chatId)\n        .order('created_at', { ascending: true });\n\n      if (error) throw error;\n\n      setMessages(data?.map(msg => ({\n        ...msg,\n        sender_type: msg.sender_type as 'customer' | 'vendor' | 'bot',\n        created_at: new Date(msg.created_at)\n      })) || []);\n    } catch (error) {\n      console.error('Error fetching messages:', error);\n    }\n  };\n\n  const sendMessage = async () => {\n    if (!newMessage.trim()) return;\n\n    const messageText = newMessage.trim();\n    const lowerMessageText = messageText.toLowerCase();\n    \n    // Detectar comando \"activar bot\" o variaciones - sin necesidad de chat seleccionado\n    if (lowerMessageText === 'activar bot' || lowerMessageText === 'bot activo' || lowerMessageText === 'reactivar bot') {\n      if (activeChats.length === 0) {\n        toast({\n          title: '‚ÑπÔ∏è No hay chats activos',\n          description: 'No hay ning√∫n chat directo activo en este momento',\n        });\n        setNewMessage('');\n        return;\n      }\n\n      try {\n        \n        // Obtener todos los clientes afectados ANTES de cerrar los chats\n        const customerPhones = activeChats.map(chat => chat.customer_phone);\n        \n\n        // Cerrar todos los chats activos de este vendedor\n        const { error: updateError } = await supabase\n          .from('vendor_chats')\n          .update({\n            is_active: false,\n            ended_at: new Date().toISOString()\n          })\n          .eq('vendor_id', vendorId)\n          .eq('is_active', true);\n\n        if (updateError) {\n          console.error('‚ùå Error closing chats:', updateError);\n          throw updateError;\n        }\n\n\n        // Desactivar modo chat para todos los clientes y notificar\n        for (const phone of customerPhones) {\n          \n          const { error: sessionError } = await supabase\n            .from('user_sessions')\n            .update({ \n              in_vendor_chat: false, \n              assigned_vendor_phone: null,\n              updated_at: new Date().toISOString()\n            })\n            .eq('phone', phone);\n\n          if (sessionError) {\n            console.error('‚ùå Error updating user_sessions:', sessionError);\n          }\n\n          // Notificar al cliente que el bot est√° activo\n          \n          const { error: notifyError } = await supabase.functions.invoke('send-whatsapp-notification', {\n            body: {\n              phoneNumber: phone,\n              message: `‚úÖ El bot est√° activo nuevamente.`\n            }\n          });\n\n          if (notifyError) {\n            console.error('‚ùå Error sending notification:', notifyError);\n          }\n        }\n\n        // Limpiar estado local\n        setActiveChats([]);\n        setSelectedChat(null);\n        setMessages([]);\n        setNewMessage('');\n\n        toast({\n          title: '‚úÖ Bot reactivado',\n          description: `Bot activo nuevamente para ${customerPhones.length} cliente(s)`,\n        });\n        \n      } catch (error) {\n        console.error('‚ùå Error activating bot:', error);\n        toast({\n          title: 'Error',\n          description: 'No se pudo reactivar el bot',\n          variant: 'destructive'\n        });\n      }\n      return;\n    }\n\n    // Mensaje normal - requiere chat seleccionado\n    if (!selectedChat) {\n      toast({\n        title: 'Atenci√≥n',\n        description: 'Selecciona un chat o escribe \"activar bot\" para reactivar el bot',\n        variant: 'destructive'\n      });\n      return;\n    }\n\n    try {\n      const { data: insertedMessage, error } = await supabase\n        .from('chat_messages')\n        .insert({\n          chat_id: selectedChat.id,\n          sender_type: 'vendor',\n          message: newMessage\n        })\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      // Agregar inmediatamente al estado local para feedback instant√°neo\n      if (insertedMessage) {\n        const newMsg: ChatMessage = {\n          ...insertedMessage,\n          sender_type: insertedMessage.sender_type as 'customer' | 'vendor' | 'bot',\n          created_at: new Date(insertedMessage.created_at)\n        };\n        setMessages(prev => [...prev, newMsg]);\n      }\n\n      // Desactivar bot autom√°ticamente cuando el vendedor escribe cualquier mensaje\n      await supabase\n        .from('user_sessions')\n        .upsert({\n          phone: selectedChat.customer_phone,\n          in_vendor_chat: true,\n          assigned_vendor_phone: vendorPhone,\n          updated_at: new Date().toISOString()\n        }, { onConflict: 'phone' });\n\n      // Enviar mensaje por WhatsApp al cliente con el nombre del negocio\n      await supabase.functions.invoke('send-whatsapp-notification', {\n        body: {\n          phoneNumber: selectedChat.customer_phone,\n          message: `üì© Mensaje de *${vendorName}*:\\n${newMessage}`,\n          orderId: selectedChat.id\n        }\n      });\n\n      setNewMessage('');\n      \n      // Scroll to bottom after sending\n      scrollToBottom();\n      \n      toast({\n        title: '‚úÖ Mensaje enviado',\n        description: 'El cliente recibir√° tu mensaje por WhatsApp'\n      });\n    } catch (error) {\n      console.error('Error sending message:', error);\n      toast({\n        title: 'Error',\n        description: 'No se pudo enviar el mensaje',\n        variant: 'destructive'\n      });\n    }\n  };\n\n  const endChat = async (chatId: string) => {\n    if (!confirm('¬øEst√°s seguro de finalizar este chat?')) return;\n\n    try {\n      // Obtener info del chat antes de cerrarlo\n      const chatToEnd = activeChats.find(c => c.id === chatId);\n      \n      const { error } = await supabase\n        .from('vendor_chats')\n        .update({\n          is_active: false,\n          ended_at: new Date().toISOString()\n        })\n        .eq('id', chatId);\n\n      if (error) throw error;\n\n      // Desactivar modo chat directo para reactivar el bot\n      if (chatToEnd) {\n        await supabase\n          .from('user_sessions')\n          .update({\n            in_vendor_chat: false,\n            assigned_vendor_phone: null\n          })\n          .eq('phone', chatToEnd.customer_phone);\n      }\n\n      setActiveChats(prev => prev.filter(chat => chat.id !== chatId));\n      if (selectedChat?.id === chatId) {\n        setSelectedChat(null);\n        setMessages([]);\n      }\n\n      toast({\n        title: '‚úÖ Chat finalizado',\n        description: 'El bot se ha reactivado para este cliente'\n      });\n    } catch (error) {\n      console.error('Error ending chat:', error);\n      toast({\n        title: 'Error',\n        description: 'No se pudo finalizar el chat',\n        variant: 'destructive'\n      });\n    }\n  };\n\n  const getSenderIcon = (type: string) => {\n    switch (type) {\n      case 'customer':\n        return <User className=\"h-4 w-4\" />;\n      case 'vendor':\n        return <Users className=\"h-4 w-4\" />;\n      case 'bot':\n        return <Bot className=\"h-4 w-4\" />;\n      default:\n        return null;\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex justify-center items-center h-64\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 h-[600px]\">\n      {/* Lista de chats activos */}\n      <Card className=\"md:col-span-1\">\n        <CardHeader className=\"pb-3\">\n          <CardTitle className=\"text-base\">Chats Activos</CardTitle>\n        </CardHeader>\n        <CardContent className=\"p-0\">\n          <ScrollArea className=\"h-[520px]\">\n            {activeChats.map((chat) => (\n              <div\n                key={chat.id}\n                className={`p-4 border-b cursor-pointer hover:bg-muted/50 transition-colors ${\n                  selectedChat?.id === chat.id ? 'bg-muted' : ''\n                }`}\n                onClick={() => setSelectedChat(chat)}\n              >\n                <div className=\"flex items-start justify-between mb-2\">\n                  <div className=\"flex items-center gap-2\">\n                    <User className=\"h-4 w-4\" />\n                    <span className=\"font-medium text-sm\">\n                      {chat.customer_phone}\n                    </span>\n                  </div>\n                  <Badge variant=\"default\" className=\"text-xs\">\n                    Activo\n                  </Badge>\n                </div>\n                <p className=\"text-xs text-muted-foreground\">\n                  Iniciado: {format(chat.started_at, 'HH:mm', { locale: es })}\n                </p>\n              </div>\n            ))}\n\n            {activeChats.length === 0 && (\n              <div className=\"text-center py-12 px-4\">\n                <MessageCircle className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n                <p className=\"text-sm text-muted-foreground\">\n                  No hay chats activos\n                </p>\n                <p className=\"text-xs text-muted-foreground mt-2\">\n                  Los clientes pueden iniciar un chat enviando \"hablar con vendedor\" al bot\n                </p>\n              </div>\n            )}\n          </ScrollArea>\n        </CardContent>\n      </Card>\n\n      {/* √Årea de chat */}\n      <Card className=\"md:col-span-2\">\n        {selectedChat ? (\n          <>\n            <CardHeader className=\"pb-3 border-b\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-2\">\n                  <User className=\"h-5 w-5\" />\n                  <div>\n                    <p className=\"font-medium\">{selectedChat.customer_phone}</p>\n                    <p className=\"text-xs text-muted-foreground\">\n                      Chat iniciado {format(selectedChat.started_at, 'HH:mm', { locale: es })}\n                    </p>\n                  </div>\n                </div>\n                <Button\n                  size=\"sm\"\n                  variant=\"destructive\"\n                  onClick={() => endChat(selectedChat.id)}\n                >\n                  Finalizar Chat\n                </Button>\n              </div>\n            </CardHeader>\n            <CardContent className=\"p-0\">\n              <ScrollArea className=\"h-[420px] p-4\" ref={scrollAreaRef}>\n                <div className=\"space-y-4\">\n                  {messages.map((message) => (\n                    <div\n                      key={message.id}\n                      className={`flex ${\n                        message.sender_type === 'vendor'\n                          ? 'justify-end'\n                          : 'justify-start'\n                      }`}\n                    >\n                      <div\n                        className={`max-w-[70%] rounded-lg px-4 py-2 ${\n                          message.sender_type === 'vendor'\n                            ? 'bg-primary text-primary-foreground'\n                            : message.sender_type === 'bot'\n                            ? 'bg-muted'\n                            : 'bg-secondary'\n                        }`}\n                      >\n                        <div className=\"flex items-center gap-2 mb-1\">\n                          {getSenderIcon(message.sender_type)}\n                          <span className=\"text-xs opacity-80\">\n                            {format(message.created_at, 'HH:mm')}\n                          </span>\n                        </div>\n                        <p className=\"text-sm\">{message.message}</p>\n                      </div>\n                    </div>\n                  ))}\n                  <div ref={messagesEndRef} />\n                </div>\n              </ScrollArea>\n              <div className=\"p-4 border-t\">\n                <div className=\"flex gap-2\">\n                  <Input\n                    value={newMessage}\n                    onChange={(e) => setNewMessage(e.target.value)}\n                    placeholder={selectedChat ? \"Escribe un mensaje...\" : 'Escribe \"activar bot\" para reactivar el bot'}\n                    onKeyPress={(e) => e.key === 'Enter' && sendMessage()}\n                  />\n                  <Button onClick={sendMessage}>\n                    <Send className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n                <p className=\"text-xs text-muted-foreground mt-2\">\n                  üí° Escribe \"activar bot\" para cerrar todos los chats y reactivar el bot\n                </p>\n              </div>\n            </CardContent>\n          </>\n        ) : (\n          <CardContent className=\"flex items-center justify-center h-full\">\n            <div className=\"text-center\">\n              <MessageCircle className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n              <p className=\"text-muted-foreground\">\n                Selecciona un chat para comenzar\n              </p>\n            </div>\n          </CardContent>\n        )}\n      </Card>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\VendorHoursManager.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchHours'. Either include it or remove the dependency array.","line":47,"column":6,"nodeType":"ArrayExpression","endLine":47,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [fetchHours, vendorId]","fix":{"range":[1400,1410],"text":"[fetchHours, vendorId]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":61,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1752,1755],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1752,1755],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Switch } from '@/components/ui/switch';\nimport { useToast } from '@/hooks/use-toast';\nimport { Clock, Save, Plus, Trash2 } from 'lucide-react';\n\ninterface TimeSlot {\n  id?: string;\n  slot_number: number;\n  opening_time: string;\n  closing_time: string;\n}\n\ninterface DayHours {\n  day_of_week: string;\n  is_closed: boolean;\n  is_open_24_hours: boolean;\n  time_slots: TimeSlot[];\n}\n\ninterface VendorHoursManagerProps {\n  vendorId: string;\n}\n\nconst DAYS_OF_WEEK = [\n  { value: 'monday', label: 'Lunes' },\n  { value: 'tuesday', label: 'Martes' },\n  { value: 'wednesday', label: 'Mi√©rcoles' },\n  { value: 'thursday', label: 'Jueves' },\n  { value: 'friday', label: 'Viernes' },\n  { value: 'saturday', label: 'S√°bado' },\n  { value: 'sunday', label: 'Domingo' }\n];\n\nexport function VendorHoursManager({ vendorId }: VendorHoursManagerProps) {\n  const [dayHours, setDayHours] = useState<DayHours[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [saving, setSaving] = useState(false);\n  const { toast } = useToast();\n\n  useEffect(() => {\n    fetchHours();\n  }, [vendorId]);\n\n  const fetchHours = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('vendor_hours')\n        .select('*')\n        .eq('vendor_id', vendorId)\n        .order('day_of_week')\n        .order('slot_number');\n\n      if (error) throw error;\n\n      // Group hours by day\n      const groupedHours: Record<string, any[]> = {};\n      \n      if (data && data.length > 0) {\n        data.forEach(hour => {\n          if (!groupedHours[hour.day_of_week]) {\n            groupedHours[hour.day_of_week] = [];\n          }\n          groupedHours[hour.day_of_week].push(hour);\n        });\n      }\n\n      // Create day hours structure\n      const hours: DayHours[] = DAYS_OF_WEEK.map(day => {\n        const dayData = groupedHours[day.value];\n        \n        if (dayData && dayData.length > 0) {\n          const firstSlot = dayData[0];\n          return {\n            day_of_week: day.value,\n            is_closed: firstSlot.is_closed,\n            is_open_24_hours: firstSlot.is_open_24_hours,\n            time_slots: dayData.map(slot => ({\n              id: slot.id,\n              slot_number: slot.slot_number,\n              opening_time: slot.opening_time,\n              closing_time: slot.closing_time\n            }))\n          };\n        }\n        \n        // Default for days without data\n        return {\n          day_of_week: day.value,\n          is_closed: false,\n          is_open_24_hours: false,\n          time_slots: [{\n            slot_number: 1,\n            opening_time: '09:00',\n            closing_time: '21:00'\n          }]\n        };\n      });\n\n      setDayHours(hours);\n    } catch (error) {\n      console.error('Error fetching hours:', error);\n      toast({\n        title: 'Error',\n        description: 'No se pudieron cargar los horarios',\n        variant: 'destructive'\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSaveHours = async () => {\n    setSaving(true);\n    \n    try {\n      // Delete existing hours\n      await supabase\n        .from('vendor_hours')\n        .delete()\n        .eq('vendor_id', vendorId);\n\n      // Prepare hours to insert\n      const hoursToInsert = dayHours.flatMap(day => \n        day.time_slots.map(slot => ({\n          vendor_id: vendorId,\n          day_of_week: day.day_of_week,\n          slot_number: slot.slot_number,\n          opening_time: slot.opening_time,\n          closing_time: slot.closing_time,\n          is_closed: day.is_closed,\n          is_open_24_hours: day.is_open_24_hours\n        }))\n      );\n\n      const { error } = await supabase\n        .from('vendor_hours')\n        .insert(hoursToInsert);\n\n      if (error) throw error;\n\n      toast({\n        title: '√âxito',\n        description: 'Horarios actualizados correctamente'\n      });\n    } catch (error) {\n      console.error('Error saving hours:', error);\n      toast({\n        title: 'Error',\n        description: 'No se pudieron guardar los horarios',\n        variant: 'destructive'\n      });\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const updateDayField = (dayValue: string, field: 'is_closed' | 'is_open_24_hours', value: boolean) => {\n    setDayHours(prev =>\n      prev.map(day =>\n        day.day_of_week === dayValue\n          ? { ...day, [field]: value }\n          : day\n      )\n    );\n  };\n\n  const updateTimeSlot = (dayValue: string, slotNumber: number, field: 'opening_time' | 'closing_time', value: string) => {\n    setDayHours(prev =>\n      prev.map(day =>\n        day.day_of_week === dayValue\n          ? {\n              ...day,\n              time_slots: day.time_slots.map(slot =>\n                slot.slot_number === slotNumber\n                  ? { ...slot, [field]: value }\n                  : slot\n              )\n            }\n          : day\n      )\n    );\n  };\n\n  const addTimeSlot = (dayValue: string) => {\n    setDayHours(prev =>\n      prev.map(day =>\n        day.day_of_week === dayValue\n          ? {\n              ...day,\n              time_slots: [\n                ...day.time_slots,\n                {\n                  slot_number: day.time_slots.length + 1,\n                  opening_time: '09:00',\n                  closing_time: '21:00'\n                }\n              ]\n            }\n          : day\n      )\n    );\n  };\n\n  const removeTimeSlot = (dayValue: string, slotNumber: number) => {\n    setDayHours(prev =>\n      prev.map(day =>\n        day.day_of_week === dayValue\n          ? {\n              ...day,\n              time_slots: day.time_slots\n                .filter(slot => slot.slot_number !== slotNumber)\n                .map((slot, index) => ({ ...slot, slot_number: index + 1 }))\n            }\n          : day\n      )\n    );\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex justify-center p-8\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <Clock className=\"h-5 w-5\" />\n          Horarios de Atenci√≥n\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        {DAYS_OF_WEEK.map(day => {\n          const dayData = dayHours.find(h => h.day_of_week === day.value) || {\n            day_of_week: day.value,\n            is_closed: false,\n            is_open_24_hours: false,\n            time_slots: [{ slot_number: 1, opening_time: '09:00', closing_time: '21:00' }]\n          };\n\n          return (\n            <div key={day.value} className=\"space-y-3 p-4 bg-secondary/10 rounded-lg\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"font-medium\">{day.label}</div>\n                \n                <div className=\"flex items-center gap-4\">\n                  <div className=\"flex items-center gap-2\">\n                    <Label htmlFor={`${day.value}-24h`} className=\"text-sm\">\n                      24 horas\n                    </Label>\n                    <Switch\n                      id={`${day.value}-24h`}\n                      checked={dayData.is_open_24_hours}\n                      onCheckedChange={(checked) => updateDayField(day.value, 'is_open_24_hours', checked)}\n                      disabled={dayData.is_closed}\n                    />\n                  </div>\n                  \n                  <div className=\"flex items-center gap-2\">\n                    <Label htmlFor={`${day.value}-closed`} className=\"text-sm\">\n                      Cerrado\n                    </Label>\n                    <Switch\n                      id={`${day.value}-closed`}\n                      checked={dayData.is_closed}\n                      onCheckedChange={(checked) => updateDayField(day.value, 'is_closed', checked)}\n                    />\n                  </div>\n                </div>\n              </div>\n              \n              {!dayData.is_closed && !dayData.is_open_24_hours && (\n                <div className=\"space-y-2\">\n                  {dayData.time_slots.map((slot, index) => (\n                    <div key={slot.slot_number} className=\"flex items-center gap-2\">\n                      <div className=\"flex-1 grid grid-cols-2 gap-2\">\n                        <div className=\"flex items-center gap-2\">\n                          <Label className=\"text-xs whitespace-nowrap\">Abre:</Label>\n                          <Input\n                            type=\"time\"\n                            value={slot.opening_time}\n                            onChange={(e) => updateTimeSlot(day.value, slot.slot_number, 'opening_time', e.target.value)}\n                            className=\"flex-1\"\n                          />\n                        </div>\n                        \n                        <div className=\"flex items-center gap-2\">\n                          <Label className=\"text-xs whitespace-nowrap\">Cierra:</Label>\n                          <Input\n                            type=\"time\"\n                            value={slot.closing_time}\n                            onChange={(e) => updateTimeSlot(day.value, slot.slot_number, 'closing_time', e.target.value)}\n                            className=\"flex-1\"\n                          />\n                        </div>\n                      </div>\n                      \n                      {dayData.time_slots.length > 1 && (\n                        <Button\n                          size=\"icon\"\n                          variant=\"ghost\"\n                          onClick={() => removeTimeSlot(day.value, slot.slot_number)}\n                          className=\"h-8 w-8 text-destructive\"\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      )}\n                    </div>\n                  ))}\n                  \n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => addTimeSlot(day.value)}\n                    className=\"w-full mt-2\"\n                  >\n                    <Plus className=\"h-4 w-4 mr-2\" />\n                    Agregar horario cortado\n                  </Button>\n                </div>\n              )}\n            </div>\n          );\n        })}\n        \n        <Button \n          onClick={handleSaveHours} \n          disabled={saving}\n          className=\"w-full\"\n        >\n          {saving ? (\n            <>\n              <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n              Guardando...\n            </>\n          ) : (\n            <>\n              <Save className=\"h-4 w-4 mr-2\" />\n              Guardar Horarios\n            </>\n          )}\n        </Button>\n      </CardContent>\n    </Card>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\VendorNotificationSettings.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadSettings'. Either include it or remove the dependency array.","line":32,"column":6,"nodeType":"ArrayExpression","endLine":32,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [loadSettings, vendorId]","fix":{"range":[1069,1079],"text":"[loadSettings, vendorId]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Button } from \"@/components/ui/button\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { toast } from \"sonner\";\nimport { Bell, Loader2 } from \"lucide-react\";\n\ninterface VendorNotificationSettingsProps {\n  vendorId: string;\n  hasWhatsApp: boolean;\n}\n\ninterface NotificationSettings {\n  notify_new_order: boolean;\n  notify_order_cancelled: boolean;\n  notify_customer_message: boolean;\n}\n\nexport function VendorNotificationSettings({ vendorId, hasWhatsApp }: VendorNotificationSettingsProps) {\n  const [loading, setLoading] = useState(true);\n  const [saving, setSaving] = useState(false);\n  const [settings, setSettings] = useState<NotificationSettings>({\n    notify_new_order: true,\n    notify_order_cancelled: true,\n    notify_customer_message: true,\n  });\n\n  useEffect(() => {\n    loadSettings();\n  }, [vendorId]);\n\n  const loadSettings = async () => {\n    try {\n      setLoading(true);\n      const { data, error } = await supabase\n        .from('vendor_notification_settings')\n        .select('*')\n        .eq('vendor_id', vendorId)\n        .single();\n\n      if (error && error.code !== 'PGRST116') {\n        throw error;\n      }\n\n      if (data) {\n        setSettings({\n          notify_new_order: data.notify_new_order,\n          notify_order_cancelled: data.notify_order_cancelled,\n          notify_customer_message: data.notify_customer_message,\n        });\n      }\n    } catch (error) {\n      console.error('Error loading notification settings:', error);\n      toast.error('Error al cargar configuraci√≥n de notificaciones');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSave = async () => {\n    try {\n      setSaving(true);\n\n      const { error } = await supabase\n        .from('vendor_notification_settings')\n        .upsert({\n          vendor_id: vendorId,\n          ...settings,\n        }, {\n          onConflict: 'vendor_id'\n        });\n\n      if (error) throw error;\n\n      toast.success('Configuraci√≥n de notificaciones guardada');\n    } catch (error) {\n      console.error('Error saving notification settings:', error);\n      toast.error('Error al guardar la configuraci√≥n');\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  if (!hasWhatsApp) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Bell className=\"h-5 w-5\" />\n            Notificaciones por WhatsApp\n          </CardTitle>\n          <CardDescription>\n            Para recibir notificaciones por WhatsApp, primero debes agregar tu n√∫mero de WhatsApp en la configuraci√≥n del negocio.\n          </CardDescription>\n        </CardHeader>\n      </Card>\n    );\n  }\n\n  if (loading) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Bell className=\"h-5 w-5\" />\n            Notificaciones por WhatsApp\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"flex justify-center py-8\">\n          <Loader2 className=\"h-6 w-6 animate-spin\" />\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <Bell className=\"h-5 w-5\" />\n          Notificaciones por WhatsApp\n        </CardTitle>\n        <CardDescription>\n          Configura qu√© notificaciones deseas recibir en tu WhatsApp\n        </CardDescription>\n      </CardHeader>\n      <CardContent className=\"space-y-6\">\n        <div className=\"space-y-4\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"space-y-0.5\">\n              <Label htmlFor=\"notify_new_order\">Nuevos Pedidos</Label>\n              <p className=\"text-sm text-muted-foreground\">\n                Recibe una notificaci√≥n cuando llegue un nuevo pedido\n              </p>\n            </div>\n            <Switch\n              id=\"notify_new_order\"\n              checked={settings.notify_new_order}\n              onCheckedChange={(checked) =>\n                setSettings({ ...settings, notify_new_order: checked })\n              }\n            />\n          </div>\n\n          <div className=\"flex items-center justify-between\">\n            <div className=\"space-y-0.5\">\n              <Label htmlFor=\"notify_order_cancelled\">Pedidos Cancelados</Label>\n              <p className=\"text-sm text-muted-foreground\">\n                Recibe una notificaci√≥n cuando un cliente cancele un pedido\n              </p>\n            </div>\n            <Switch\n              id=\"notify_order_cancelled\"\n              checked={settings.notify_order_cancelled}\n              onCheckedChange={(checked) =>\n                setSettings({ ...settings, notify_order_cancelled: checked })\n              }\n            />\n          </div>\n\n          <div className=\"flex items-center justify-between\">\n            <div className=\"space-y-0.5\">\n              <Label htmlFor=\"notify_customer_message\">Mensajes de Clientes</Label>\n              <p className=\"text-sm text-muted-foreground\">\n                Recibe una notificaci√≥n cuando un cliente quiera hablar contigo\n              </p>\n            </div>\n            <Switch\n              id=\"notify_customer_message\"\n              checked={settings.notify_customer_message}\n              onCheckedChange={(checked) =>\n                setSettings({ ...settings, notify_customer_message: checked })\n              }\n            />\n          </div>\n        </div>\n\n        <Button onClick={handleSave} disabled={saving} className=\"w-full\">\n          {saving ? (\n            <>\n              <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n              Guardando...\n            </>\n          ) : (\n            'Guardar Configuraci√≥n'\n          )}\n        </Button>\n      </CardContent>\n    </Card>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\VendorOffersManager.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchOffers'. Either include it or remove the dependency array.","line":56,"column":6,"nodeType":"ArrayExpression","endLine":56,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [fetchOffers, vendorId]","fix":{"range":[1911,1921],"text":"[fetchOffers, vendorId]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Label } from '@/components/ui/label';\nimport { Switch } from '@/components/ui/switch';\nimport { Calendar } from '@/components/ui/calendar';\nimport { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from '@/components/ui/dialog';\nimport { Badge } from '@/components/ui/badge';\nimport { supabase } from '@/integrations/supabase/client';\nimport { useToast } from '@/hooks/use-toast';\nimport { Trash2, Edit, Plus, Tag, Calendar as CalendarIcon } from 'lucide-react';\nimport { format } from 'date-fns';\nimport { es } from 'date-fns/locale';\nimport { cn } from '@/lib/utils';\n\ninterface VendorOffer {\n  id: string;\n  title: string;\n  description: string;\n  discount_percentage?: number;\n  original_price?: number;\n  offer_price?: number;\n  is_active: boolean;\n  valid_from: Date;\n  valid_until?: Date;\n}\n\ninterface VendorOffersManagerProps {\n  vendorId: string;\n}\n\nexport function VendorOffersManager({ vendorId }: VendorOffersManagerProps) {\n  const [offers, setOffers] = useState<VendorOffer[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [dialogOpen, setDialogOpen] = useState(false);\n  const [editingOffer, setEditingOffer] = useState<VendorOffer | null>(null);\n  const { toast } = useToast();\n\n  // Form state\n  const [formData, setFormData] = useState({\n    title: '',\n    description: '',\n    discount_percentage: '',\n    original_price: '',\n    offer_price: '',\n    is_active: true,\n    valid_from: new Date(),\n    valid_until: undefined as Date | undefined\n  });\n\n  useEffect(() => {\n    fetchOffers();\n  }, [vendorId]);\n\n  const fetchOffers = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('vendor_offers')\n        .select('*')\n        .eq('vendor_id', vendorId)\n        .order('created_at', { ascending: false });\n\n      if (error) throw error;\n\n      setOffers(data?.map(offer => ({\n        ...offer,\n        valid_from: new Date(offer.valid_from),\n        valid_until: offer.valid_until ? new Date(offer.valid_until) : undefined\n      })) || []);\n    } catch (error) {\n      console.error('Error fetching offers:', error);\n      toast({\n        title: 'Error',\n        description: 'No se pudieron cargar las ofertas',\n        variant: 'destructive'\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSaveOffer = async () => {\n    try {\n      const offerData = {\n        vendor_id: vendorId,\n        title: formData.title,\n        description: formData.description,\n        discount_percentage: formData.discount_percentage ? parseInt(formData.discount_percentage) : null,\n        original_price: formData.original_price ? parseFloat(formData.original_price) : null,\n        offer_price: formData.offer_price ? parseFloat(formData.offer_price) : null,\n        is_active: formData.is_active,\n        valid_from: formData.valid_from.toISOString(),\n        valid_until: formData.valid_until?.toISOString()\n      };\n\n      if (editingOffer) {\n        const { error } = await supabase\n          .from('vendor_offers')\n          .update(offerData)\n          .eq('id', editingOffer.id);\n\n        if (error) throw error;\n        toast({\n          title: '‚úÖ Oferta actualizada',\n          description: 'La oferta se ha actualizado correctamente'\n        });\n      } else {\n        const { error } = await supabase\n          .from('vendor_offers')\n          .insert(offerData);\n\n        if (error) throw error;\n        toast({\n          title: '‚úÖ Oferta creada',\n          description: 'La nueva oferta se ha creado correctamente'\n        });\n      }\n\n      setDialogOpen(false);\n      resetForm();\n      fetchOffers();\n    } catch (error) {\n      console.error('Error saving offer:', error);\n      toast({\n        title: 'Error',\n        description: 'No se pudo guardar la oferta',\n        variant: 'destructive'\n      });\n    }\n  };\n\n  const handleDeleteOffer = async (id: string) => {\n    if (!confirm('¬øEst√°s seguro de eliminar esta oferta?')) return;\n\n    try {\n      const { error } = await supabase\n        .from('vendor_offers')\n        .delete()\n        .eq('id', id);\n\n      if (error) throw error;\n\n      toast({\n        title: 'üóëÔ∏è Oferta eliminada',\n        description: 'La oferta se ha eliminado correctamente'\n      });\n      fetchOffers();\n    } catch (error) {\n      console.error('Error deleting offer:', error);\n      toast({\n        title: 'Error',\n        description: 'No se pudo eliminar la oferta',\n        variant: 'destructive'\n      });\n    }\n  };\n\n  const handleToggleActive = async (id: string, currentStatus: boolean) => {\n    try {\n      const { error } = await supabase\n        .from('vendor_offers')\n        .update({ is_active: !currentStatus })\n        .eq('id', id);\n\n      if (error) throw error;\n\n      toast({\n        title: !currentStatus ? '‚úÖ Oferta activada' : '‚è∏Ô∏è Oferta desactivada',\n        description: `La oferta ha sido ${!currentStatus ? 'activada' : 'desactivada'}`\n      });\n      fetchOffers();\n    } catch (error) {\n      console.error('Error toggling offer:', error);\n      toast({\n        title: 'Error',\n        description: 'No se pudo actualizar el estado de la oferta',\n        variant: 'destructive'\n      });\n    }\n  };\n\n  const startEditOffer = (offer: VendorOffer) => {\n    setEditingOffer(offer);\n    setFormData({\n      title: offer.title,\n      description: offer.description,\n      discount_percentage: offer.discount_percentage?.toString() || '',\n      original_price: offer.original_price?.toString() || '',\n      offer_price: offer.offer_price?.toString() || '',\n      is_active: offer.is_active,\n      valid_from: offer.valid_from,\n      valid_until: offer.valid_until\n    });\n    setDialogOpen(true);\n  };\n\n  const resetForm = () => {\n    setFormData({\n      title: '',\n      description: '',\n      discount_percentage: '',\n      original_price: '',\n      offer_price: '',\n      is_active: true,\n      valid_from: new Date(),\n      valid_until: undefined\n    });\n    setEditingOffer(null);\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex justify-center items-center h-64\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex justify-between items-center\">\n        <h3 className=\"text-lg font-semibold\">Ofertas y Promociones</h3>\n        <Button onClick={() => { resetForm(); setDialogOpen(true); }}>\n          <Plus className=\"mr-2 h-4 w-4\" />\n          Nueva Oferta\n        </Button>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n        {offers.map((offer) => (\n          <Card key={offer.id} className={cn(\"relative\", !offer.is_active && \"opacity-60\")}>\n            <CardHeader className=\"pb-3\">\n              <div className=\"flex justify-between items-start\">\n                <CardTitle className=\"text-base\">{offer.title}</CardTitle>\n                <Badge variant={offer.is_active ? \"default\" : \"secondary\"}>\n                  {offer.is_active ? 'Activa' : 'Inactiva'}\n                </Badge>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-sm text-muted-foreground mb-3\">{offer.description}</p>\n              \n              {offer.discount_percentage && (\n                <div className=\"flex items-center gap-2 mb-2\">\n                  <Tag className=\"h-4 w-4 text-primary\" />\n                  <span className=\"font-bold text-primary\">{offer.discount_percentage}% OFF</span>\n                </div>\n              )}\n              \n              {offer.original_price && offer.offer_price && (\n                <div className=\"flex items-center gap-2 mb-2\">\n                  <span className=\"line-through text-muted-foreground\">${offer.original_price}</span>\n                  <span className=\"font-bold text-primary\">${offer.offer_price}</span>\n                </div>\n              )}\n              \n              <div className=\"text-xs text-muted-foreground mt-3\">\n                <div className=\"flex items-center gap-1\">\n                  <CalendarIcon className=\"h-3 w-3\" />\n                  Desde: {format(offer.valid_from, 'dd/MM/yyyy', { locale: es })}\n                </div>\n                {offer.valid_until && (\n                  <div className=\"flex items-center gap-1 mt-1\">\n                    <CalendarIcon className=\"h-3 w-3\" />\n                    Hasta: {format(offer.valid_until, 'dd/MM/yyyy', { locale: es })}\n                  </div>\n                )}\n              </div>\n              \n              <div className=\"flex gap-2 mt-4\">\n                <Button\n                  size=\"sm\"\n                  variant=\"outline\"\n                  onClick={() => handleToggleActive(offer.id, offer.is_active)}\n                >\n                  {offer.is_active ? 'Desactivar' : 'Activar'}\n                </Button>\n                <Button\n                  size=\"sm\"\n                  variant=\"ghost\"\n                  onClick={() => startEditOffer(offer)}\n                >\n                  <Edit className=\"h-4 w-4\" />\n                </Button>\n                <Button\n                  size=\"sm\"\n                  variant=\"ghost\"\n                  onClick={() => handleDeleteOffer(offer.id)}\n                >\n                  <Trash2 className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      {offers.length === 0 && (\n        <Card>\n          <CardContent className=\"text-center py-8\">\n            <Tag className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n            <p className=\"text-muted-foreground\">No hay ofertas creadas</p>\n            <p className=\"text-sm text-muted-foreground mt-2\">\n              Crea tu primera oferta para atraer m√°s clientes\n            </p>\n          </CardContent>\n        </Card>\n      )}\n\n      <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>\n              {editingOffer ? 'Editar Oferta' : 'Nueva Oferta'}\n            </DialogTitle>\n          </DialogHeader>\n          \n          <div className=\"space-y-4\">\n            <div>\n              <Label htmlFor=\"title\">T√≠tulo</Label>\n              <Input\n                id=\"title\"\n                value={formData.title}\n                onChange={(e) => setFormData({ ...formData, title: e.target.value })}\n                placeholder=\"Ej: 2x1 en pizzas familiares\"\n              />\n            </div>\n            \n            <div>\n              <Label htmlFor=\"description\">Descripci√≥n</Label>\n              <Textarea\n                id=\"description\"\n                value={formData.description}\n                onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n                placeholder=\"Describe tu oferta...\"\n                rows={3}\n              />\n            </div>\n            \n            <div className=\"grid grid-cols-3 gap-2\">\n              <div>\n                <Label htmlFor=\"discount\">Descuento %</Label>\n                <Input\n                  id=\"discount\"\n                  type=\"number\"\n                  value={formData.discount_percentage}\n                  onChange={(e) => setFormData({ ...formData, discount_percentage: e.target.value })}\n                  placeholder=\"20\"\n                />\n              </div>\n              \n              <div>\n                <Label htmlFor=\"original\">Precio Original</Label>\n                <Input\n                  id=\"original\"\n                  type=\"number\"\n                  value={formData.original_price}\n                  onChange={(e) => setFormData({ ...formData, original_price: e.target.value })}\n                  placeholder=\"100\"\n                />\n              </div>\n              \n              <div>\n                <Label htmlFor=\"offer\">Precio Oferta</Label>\n                <Input\n                  id=\"offer\"\n                  type=\"number\"\n                  value={formData.offer_price}\n                  onChange={(e) => setFormData({ ...formData, offer_price: e.target.value })}\n                  placeholder=\"80\"\n                />\n              </div>\n            </div>\n            \n            <div className=\"grid grid-cols-2 gap-2\">\n              <div>\n                <Label>V√°lido desde</Label>\n                <Popover>\n                  <PopoverTrigger asChild>\n                    <Button variant=\"outline\" className=\"w-full justify-start text-left font-normal\">\n                      <CalendarIcon className=\"mr-2 h-4 w-4\" />\n                      {format(formData.valid_from, 'dd/MM/yyyy', { locale: es })}\n                    </Button>\n                  </PopoverTrigger>\n                  <PopoverContent className=\"w-auto p-0\">\n                    <Calendar\n                      mode=\"single\"\n                      selected={formData.valid_from}\n                      onSelect={(date) => date && setFormData({ ...formData, valid_from: date })}\n                      initialFocus\n                    />\n                  </PopoverContent>\n                </Popover>\n              </div>\n              \n              <div>\n                <Label>V√°lido hasta</Label>\n                <Popover>\n                  <PopoverTrigger asChild>\n                    <Button variant=\"outline\" className=\"w-full justify-start text-left font-normal\">\n                      <CalendarIcon className=\"mr-2 h-4 w-4\" />\n                      {formData.valid_until ? format(formData.valid_until, 'dd/MM/yyyy', { locale: es }) : 'Sin fecha'}\n                    </Button>\n                  </PopoverTrigger>\n                  <PopoverContent className=\"w-auto p-0\">\n                    <Calendar\n                      mode=\"single\"\n                      selected={formData.valid_until}\n                      onSelect={(date) => setFormData({ ...formData, valid_until: date || undefined })}\n                      initialFocus\n                    />\n                  </PopoverContent>\n                </Popover>\n              </div>\n            </div>\n            \n            <div className=\"flex items-center space-x-2\">\n              <Switch\n                id=\"active\"\n                checked={formData.is_active}\n                onCheckedChange={(checked) => setFormData({ ...formData, is_active: checked })}\n              />\n              <Label htmlFor=\"active\">Oferta activa</Label>\n            </div>\n          </div>\n          \n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setDialogOpen(false)}>\n              Cancelar\n            </Button>\n            <Button onClick={handleSaveOffer}>\n              {editingOffer ? 'Actualizar' : 'Crear'} Oferta\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\VendorPaymentMetrics.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchMetrics'. Either include it or remove the dependency array.","line":45,"column":6,"nodeType":"ArrayExpression","endLine":45,"endColumn":24,"suggestions":[{"desc":"Update the dependencies array to be: [vendorId, period, fetchMetrics]","fix":{"range":[1259,1277],"text":"[vendorId, period, fetchMetrics]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Loader2, DollarSign, CheckCircle, XCircle, Clock, TrendingUp } from 'lucide-react';\nimport { format, subDays, startOfDay, endOfDay } from 'date-fns';\nimport { es } from 'date-fns/locale';\n\ninterface PaymentMetrics {\n  pending: {\n    count: number;\n    total: number;\n  };\n  paid: {\n    count: number;\n    total: number;\n  };\n  failed: {\n    count: number;\n    total: number;\n  };\n  totalCollected: number;\n  recentPayments: Array<{\n    id: string;\n    order_id: string;\n    amount: number;\n    status: string;\n    payment_method_name: string;\n    payment_date: string | null;\n    created_at: string;\n  }>;\n}\n\ninterface VendorPaymentMetricsProps {\n  vendorId: string;\n}\n\nexport function VendorPaymentMetrics({ vendorId }: VendorPaymentMetricsProps) {\n  const [metrics, setMetrics] = useState<PaymentMetrics | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [period, setPeriod] = useState<'7d' | '30d' | 'all'>('30d');\n\n  useEffect(() => {\n    fetchMetrics();\n  }, [vendorId, period]);\n\n  const fetchMetrics = async () => {\n    setLoading(true);\n    try {\n      // Calcular rango de fechas seg√∫n el per√≠odo\n      let dateFilter = null;\n      if (period === '7d') {\n        dateFilter = startOfDay(subDays(new Date(), 7)).toISOString();\n      } else if (period === '30d') {\n        dateFilter = startOfDay(subDays(new Date(), 30)).toISOString();\n      }\n\n      // Obtener todos los pagos del vendor\n      let query = supabase\n        .from('order_payments')\n        .select(`\n          *,\n          orders!inner(vendor_id)\n        `)\n        .eq('orders.vendor_id', vendorId);\n\n      if (dateFilter) {\n        query = query.gte('created_at', dateFilter);\n      }\n\n      const { data: payments, error } = await query.order('created_at', { ascending: false });\n\n      if (error) throw error;\n\n      // Calcular m√©tricas\n      const pending = payments?.filter(p => p.status === 'pending') || [];\n      const paid = payments?.filter(p => p.status === 'paid') || [];\n      const failed = payments?.filter(p => p.status === 'failed') || [];\n\n      const metricsData: PaymentMetrics = {\n        pending: {\n          count: pending.length,\n          total: pending.reduce((sum, p) => sum + Number(p.amount), 0),\n        },\n        paid: {\n          count: paid.length,\n          total: paid.reduce((sum, p) => sum + Number(p.amount), 0),\n        },\n        failed: {\n          count: failed.length,\n          total: failed.reduce((sum, p) => sum + Number(p.amount), 0),\n        },\n        totalCollected: paid.reduce((sum, p) => sum + Number(p.amount), 0),\n        recentPayments: payments?.slice(0, 10) || [],\n      };\n\n      setMetrics(metricsData);\n    } catch (error) {\n      console.error('Error fetching payment metrics:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case 'paid':\n        return (\n          <span className=\"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400\">\n            <CheckCircle className=\"h-3 w-3\" />\n            Pagado\n          </span>\n        );\n      case 'pending':\n        return (\n          <span className=\"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400\">\n            <Clock className=\"h-3 w-3\" />\n            Pendiente\n          </span>\n        );\n      case 'failed':\n        return (\n          <span className=\"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400\">\n            <XCircle className=\"h-3 w-3\" />\n            Fallido\n          </span>\n        );\n      default:\n        return <span className=\"px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800\">{status}</span>;\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center p-8\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  if (!metrics) {\n    return (\n      <div className=\"text-center p-8 text-muted-foreground\">\n        No se pudieron cargar las m√©tricas de pagos\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Selector de per√≠odo */}\n      <div className=\"flex justify-end\">\n        <Tabs value={period} onValueChange={(v) => setPeriod(v as '7d' | '30d' | 'all')} className=\"w-auto\">\n          <TabsList>\n            <TabsTrigger value=\"7d\">√öltimos 7 d√≠as</TabsTrigger>\n            <TabsTrigger value=\"30d\">√öltimos 30 d√≠as</TabsTrigger>\n            <TabsTrigger value=\"all\">Todo el tiempo</TabsTrigger>\n          </TabsList>\n        </Tabs>\n      </div>\n\n      {/* Cards de m√©tricas principales */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Recaudado</CardTitle>\n            <TrendingUp className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-green-600 dark:text-green-400\">\n              $ {metrics.totalCollected.toLocaleString('es-AR')}\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              {metrics.paid.count} pagos confirmados\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Pagos Pendientes</CardTitle>\n            <Clock className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-yellow-600 dark:text-yellow-400\">\n              {metrics.pending.count}\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              $ {metrics.pending.total.toLocaleString('es-AR')}\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Pagos Confirmados</CardTitle>\n            <CheckCircle className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-green-600 dark:text-green-400\">\n              {metrics.paid.count}\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              $ {metrics.paid.total.toLocaleString('es-AR')}\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Pagos Fallidos</CardTitle>\n            <XCircle className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-red-600 dark:text-red-400\">\n              {metrics.failed.count}\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              $ {metrics.failed.total.toLocaleString('es-AR')}\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Tabla de pagos recientes */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Pagos Recientes</CardTitle>\n        </CardHeader>\n        <CardContent>\n          {metrics.recentPayments.length === 0 ? (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              No hay pagos registrados en este per√≠odo\n            </div>\n          ) : (\n            <div className=\"space-y-3\">\n              {metrics.recentPayments.map((payment) => (\n                <div\n                  key={payment.id}\n                  className=\"flex items-center justify-between p-4 border rounded-lg hover:bg-accent/50 transition-colors\"\n                >\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2 mb-1\">\n                      <span className=\"text-sm font-medium\">\n                        Pedido #{payment.order_id.substring(0, 8)}\n                      </span>\n                      {getStatusBadge(payment.status)}\n                    </div>\n                    <div className=\"flex items-center gap-3 text-xs text-muted-foreground\">\n                      <span>üí≥ {payment.payment_method_name}</span>\n                      <span>‚Ä¢</span>\n                      <span>\n                        {format(new Date(payment.created_at), \"d 'de' MMMM, yyyy\", { locale: es })}\n                      </span>\n                      {payment.payment_date && (\n                        <>\n                          <span>‚Ä¢</span>\n                          <span>\n                            Pagado: {format(new Date(payment.payment_date), \"d 'de' MMMM\", { locale: es })}\n                          </span>\n                        </>\n                      )}\n                    </div>\n                  </div>\n                  <div className=\"text-right\">\n                    <div className=\"text-lg font-semibold\">\n                      $ {Number(payment.amount).toLocaleString('es-AR')}\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\VendorPaymentSettings.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadSettings'. Either include it or remove the dependency array.","line":56,"column":6,"nodeType":"ArrayExpression","endLine":56,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [loadSettings, vendorId]","fix":{"range":[1603,1613],"text":"[loadSettings, vendorId]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'loadSettings' and 'toast'. Either include them or remove the dependency array.","line":83,"column":6,"nodeType":"ArrayExpression","endLine":83,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadSettings, toast]","fix":{"range":[2415,2417],"text":"[loadSettings, toast]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":138,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3999,4002],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3999,4002],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":199,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":199,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5551,5554],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5551,5554],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Switch } from '@/components/ui/switch';\nimport { useToast } from '@/hooks/use-toast';\nimport { supabase } from '@/integrations/supabase/client';\nimport { Loader2, CreditCard, Building2, Banknote, Check, X } from 'lucide-react';\nimport { Separator } from '@/components/ui/separator';\n\ninterface PaymentSettings {\n  efectivo: boolean;\n  transferencia: {\n    activo: boolean;\n    alias: string | null;\n    cbu: string | null;\n    titular: string | null;\n  };\n  mercadoPago: {\n    activo: boolean;\n    user_id: string | null;\n    access_token: string | null;\n    refresh_token: string | null;\n    fecha_expiracion_token: string | null;\n  };\n}\n\ninterface VendorPaymentSettingsProps {\n  vendorId: string;\n}\n\nexport function VendorPaymentSettings({ vendorId }: VendorPaymentSettingsProps) {\n  const { toast } = useToast();\n  const [loading, setLoading] = useState(true);\n  const [saving, setSaving] = useState(false);\n  const [settings, setSettings] = useState<PaymentSettings>({\n    efectivo: true,\n    transferencia: {\n      activo: false,\n      alias: null,\n      cbu: null,\n      titular: null,\n    },\n    mercadoPago: {\n      activo: false,\n      user_id: null,\n      access_token: null,\n      refresh_token: null,\n      fecha_expiracion_token: null,\n    },\n  });\n\n  useEffect(() => {\n    loadSettings();\n  }, [vendorId]);\n\n  // Detectar callbacks de MercadoPago\n  useEffect(() => {\n    const params = new URLSearchParams(window.location.search);\n    const mpConnected = params.get('mp_connected');\n    const mpError = params.get('mp_error');\n\n    if (mpConnected === 'true') {\n      toast({\n        title: '¬°MercadoPago conectado!',\n        description: 'Tu cuenta de MercadoPago se conect√≥ exitosamente',\n      });\n      loadSettings(); // Recargar settings para ver la conexi√≥n\n      // Limpiar URL\n      window.history.replaceState({}, '', '/vendor');\n    }\n\n    if (mpError) {\n      toast({\n        title: 'Error al conectar MercadoPago',\n        description: decodeURIComponent(mpError),\n        variant: 'destructive',\n      });\n      // Limpiar URL\n      window.history.replaceState({}, '', '/vendor');\n    }\n  }, []);\n\n  const loadSettings = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('vendors')\n        .select('payment_settings')\n        .eq('id', vendorId)\n        .single();\n\n      if (error) throw error;\n\n      if (data?.payment_settings) {\n        setSettings(data.payment_settings as unknown as PaymentSettings);\n      }\n    } catch (error) {\n      console.error('Error loading payment settings:', error);\n      toast({\n        title: 'Error',\n        description: 'No se pudo cargar la configuraci√≥n de pagos',\n        variant: 'destructive',\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const saveSettings = async () => {\n    // Validar que si transferencia est√° activa, tenga todos los datos\n    if (settings.transferencia.activo) {\n      const { alias, cbu, titular } = settings.transferencia;\n      if (!alias || !cbu || !titular) {\n        toast({\n          title: 'Datos incompletos',\n          description: 'Para activar transferencia bancaria, complet√° Alias, CBU/CVU y Titular',\n          variant: 'destructive',\n        });\n        return;\n      }\n      \n      // Validar que no est√©n vac√≠os despu√©s de trim\n      if (alias.trim() === '' || cbu.trim() === '' || titular.trim() === '') {\n        toast({\n          title: 'Datos incompletos',\n          description: 'Ning√∫n campo puede estar vac√≠o',\n          variant: 'destructive',\n        });\n        return;\n      }\n    }\n\n    setSaving(true);\n    try {\n      const { error } = await supabase\n        .from('vendors')\n        .update({ payment_settings: settings as any })\n        .eq('id', vendorId);\n\n      if (error) throw error;\n\n      toast({\n        title: 'Configuraci√≥n guardada',\n        description: 'Los medios de pago se actualizaron correctamente',\n      });\n    } catch (error) {\n      console.error('Error saving payment settings:', error);\n      toast({\n        title: 'Error',\n        description: 'No se pudo guardar la configuraci√≥n',\n        variant: 'destructive',\n      });\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const connectMercadoPago = async () => {\n    try {\n      const { data, error } = await supabase.functions.invoke('get-mercadopago-auth-url', {\n        body: { vendorId },\n      });\n\n      if (error) throw error;\n\n      if (data?.auth_url) {\n        window.location.href = data.auth_url;\n      } else {\n        throw new Error('No se pudo obtener la URL de autorizaci√≥n');\n      }\n    } catch (error) {\n      console.error('Error connecting MercadoPago:', error);\n      toast({\n        title: 'Error',\n        description: 'No se pudo iniciar la conexi√≥n con MercadoPago',\n        variant: 'destructive',\n      });\n    }\n  };\n\n  const disconnectMercadoPago = async () => {\n    const updatedSettings = {\n      ...settings,\n      mercadoPago: {\n        activo: false,\n        user_id: null,\n        access_token: null,\n        refresh_token: null,\n        fecha_expiracion_token: null,\n      },\n    };\n\n    setSettings(updatedSettings);\n    \n    try {\n      const { error } = await supabase\n        .from('vendors')\n        .update({ payment_settings: updatedSettings as any })\n        .eq('id', vendorId);\n\n      if (error) throw error;\n\n      toast({\n        title: 'MercadoPago desconectado',\n        description: 'Se desvincul√≥ tu cuenta de MercadoPago',\n      });\n    } catch (error) {\n      console.error('Error disconnecting MercadoPago:', error);\n      toast({\n        title: 'Error',\n        description: 'No se pudo desconectar MercadoPago',\n        variant: 'destructive',\n      });\n    }\n  };\n\n  if (loading) {\n    return (\n      <Card>\n        <CardContent className=\"flex items-center justify-center py-8\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <CreditCard className=\"h-5 w-5\" />\n            üí∞ Configuraci√≥n de Pagos\n          </CardTitle>\n          <CardDescription>\n            Configura los medios de pago que aceptar√°s en tu negocio\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          {/* MercadoPago */}\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"space-y-1\">\n                <Label className=\"text-base font-semibold\">MercadoPago</Label>\n                <p className=\"text-sm text-muted-foreground\">\n                  Acepta pagos online con tarjeta y otros medios\n                </p>\n              </div>\n              {settings.mercadoPago.activo ? (\n                <div className=\"flex items-center gap-2 text-sm text-green-600\">\n                  <Check className=\"h-4 w-4\" />\n                  Conectado\n                </div>\n              ) : (\n                <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                  <X className=\"h-4 w-4\" />\n                  No conectado\n                </div>\n              )}\n            </div>\n\n            {settings.mercadoPago.activo ? (\n              <div className=\"space-y-2\">\n                <div className=\"rounded-lg border bg-muted/50 p-3\">\n                  <p className=\"text-sm\">\n                    <span className=\"font-medium\">Usuario ID:</span>{' '}\n                    {settings.mercadoPago.user_id}\n                  </p>\n                  {settings.mercadoPago.fecha_expiracion_token && (\n                    <p className=\"text-xs text-muted-foreground mt-1\">\n                      Token v√°lido hasta:{' '}\n                      {new Date(settings.mercadoPago.fecha_expiracion_token).toLocaleDateString()}\n                    </p>\n                  )}\n                </div>\n                <Button\n                  variant=\"outline\"\n                  onClick={disconnectMercadoPago}\n                  className=\"w-full\"\n                >\n                  Desconectar MercadoPago\n                </Button>\n              </div>\n            ) : (\n              <Button onClick={connectMercadoPago} className=\"w-full\">\n                üîó Conectar con MercadoPago\n              </Button>\n            )}\n          </div>\n\n          <Separator />\n\n          {/* Transferencia */}\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"space-y-1\">\n                <Label className=\"text-base font-semibold flex items-center gap-2\">\n                  <Building2 className=\"h-4 w-4\" />\n                  Transferencia Bancaria\n                </Label>\n                <p className=\"text-sm text-muted-foreground\">\n                  Recibe pagos por transferencia directa\n                </p>\n              </div>\n              <Switch\n                checked={settings.transferencia.activo}\n                onCheckedChange={(checked) =>\n                  setSettings({\n                    ...settings,\n                    transferencia: { ...settings.transferencia, activo: checked },\n                  })\n                }\n              />\n            </div>\n\n            {settings.transferencia.activo && (\n              <div className=\"space-y-3 rounded-lg border p-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"alias\">Alias</Label>\n                  <Input\n                    id=\"alias\"\n                    value={settings.transferencia.alias || ''}\n                    onChange={(e) =>\n                      setSettings({\n                        ...settings,\n                        transferencia: {\n                          ...settings.transferencia,\n                          alias: e.target.value,\n                        },\n                      })\n                    }\n                    placeholder=\"ej: mi.negocio.mp\"\n                  />\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"cbu\">CBU / CVU</Label>\n                  <Input\n                    id=\"cbu\"\n                    value={settings.transferencia.cbu || ''}\n                    onChange={(e) =>\n                      setSettings({\n                        ...settings,\n                        transferencia: {\n                          ...settings.transferencia,\n                          cbu: e.target.value,\n                        },\n                      })\n                    }\n                    placeholder=\"0000003100010000000000\"\n                  />\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"titular\">Titular</Label>\n                  <Input\n                    id=\"titular\"\n                    value={settings.transferencia.titular || ''}\n                    onChange={(e) =>\n                      setSettings({\n                        ...settings,\n                        transferencia: {\n                          ...settings.transferencia,\n                          titular: e.target.value,\n                        },\n                      })\n                    }\n                    placeholder=\"Nombre del titular de la cuenta\"\n                  />\n                </div>\n              </div>\n            )}\n          </div>\n\n          <Separator />\n\n          {/* Efectivo */}\n          <div className=\"flex items-center justify-between\">\n            <div className=\"space-y-1\">\n              <Label className=\"text-base font-semibold flex items-center gap-2\">\n                <Banknote className=\"h-4 w-4\" />\n                Efectivo\n              </Label>\n              <p className=\"text-sm text-muted-foreground\">\n                Acepta pagos en efectivo al momento de la entrega\n              </p>\n            </div>\n            <Switch\n              checked={settings.efectivo}\n              onCheckedChange={(checked) =>\n                setSettings({ ...settings, efectivo: checked })\n              }\n            />\n          </div>\n\n          <Button\n            onClick={saveSettings}\n            disabled={saving}\n            className=\"w-full\"\n            size=\"lg\"\n          >\n            {saving ? (\n              <>\n                <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                Guardando...\n              </>\n            ) : (\n              'Guardar Configuraci√≥n'\n            )}\n          </Button>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\VendorProductManager.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchProducts'. Either include it or remove the dependency array.","line":57,"column":6,"nodeType":"ArrayExpression","endLine":57,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [fetchProducts, vendorId]","fix":{"range":[2134,2144],"text":"[fetchProducts, vendorId]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":245,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":245,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7874,7877],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7874,7877],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Switch } from '@/components/ui/switch';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from '@/components/ui/dialog';\nimport { useToast } from '@/hooks/use-toast';\nimport { Plus, Edit2, Trash2, Save, X, Upload } from 'lucide-react';\n\ninterface Product {\n  id: string;\n  name: string;\n  category: string[] | string; // Soportar tanto array como string para compatibilidad\n  description: string | null;\n  price: number;\n  is_available: boolean;\n  image: string | null;\n  stock_enabled: boolean;\n  stock_quantity: number | null;\n}\n\ninterface VendorProductManagerProps {\n  vendorId: string;\n}\n\nexport function VendorProductManager({ vendorId }: VendorProductManagerProps) {\n  const [products, setProducts] = useState<Product[]>([]);\n  const [categories, setCategories] = useState<string[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [selectedCategory, setSelectedCategory] = useState<string>('all');\n  const [isAddingProduct, setIsAddingProduct] = useState(false);\n  const [editingProduct, setEditingProduct] = useState<Product | null>(null);\n  const [imageFile, setImageFile] = useState<File | null>(null);\n  const [imagePreview, setImagePreview] = useState<string | null>(null);\n  const [uploading, setUploading] = useState(false);\n  const { toast } = useToast();\n\n  // Form state\n  const [formData, setFormData] = useState({\n    name: '',\n    category: [] as string[],\n    description: '',\n    price: '',\n    is_available: true,\n    image: null as string | null,\n    stock_enabled: false,\n    stock_quantity: ''\n  });\n  const [newCategory, setNewCategory] = useState('');\n\n  useEffect(() => {\n    fetchProducts();\n  }, [vendorId]);\n\n  const fetchProducts = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('products')\n        .select('*')\n        .eq('vendor_id', vendorId)\n        .order('name', { ascending: true });\n\n      if (error) throw error;\n\n      // Asegurar que todas las categor√≠as sean arrays\n      const productsWithArrayCategories = (data || []).map(product => ({\n        ...product,\n        category: Array.isArray(product.category) \n          ? product.category \n          : (typeof product.category === 'string' ? [product.category] : [])\n      }));\n\n      setProducts(productsWithArrayCategories);\n      \n      // Extract unique categories (flatten all category arrays)\n      const allCategories = productsWithArrayCategories.flatMap(p => p.category);\n      const uniqueCategories = [...new Set(allCategories)];\n      setCategories(uniqueCategories);\n    } catch (error) {\n      console.error('Error fetching products:', error);\n      toast({\n        title: 'Error',\n        description: 'No se pudieron cargar los productos',\n        variant: 'destructive'\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleImageSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      setImageFile(file);\n      const reader = new FileReader();\n      reader.onloadend = () => {\n        setImagePreview(reader.result as string);\n      };\n      reader.readAsDataURL(file);\n    }\n  };\n\n  const handleImageUpload = async () => {\n    if (!imageFile) return formData.image;\n\n    setUploading(true);\n    try {\n      const fileExt = imageFile.name.split('.').pop();\n      const fileName = `${vendorId}/${Date.now()}.${fileExt}`;\n\n      const { error: uploadError } = await supabase.storage\n        .from('product-images')\n        .upload(fileName, imageFile, { upsert: true });\n\n      if (uploadError) throw uploadError;\n\n      const { data: { publicUrl } } = supabase.storage\n        .from('product-images')\n        .getPublicUrl(fileName);\n\n      return publicUrl;\n    } catch (error) {\n      console.error('Error uploading image:', error);\n      toast({\n        title: 'Error',\n        description: 'No se pudo subir la imagen',\n        variant: 'destructive'\n      });\n      return formData.image;\n    } finally {\n      setUploading(false);\n    }\n  };\n\n  const handleRemoveImage = () => {\n    setImageFile(null);\n    setImagePreview(null);\n    setFormData({ ...formData, image: null });\n  };\n\n  const handleSaveProduct = async () => {\n    if (!formData.name || formData.category.length === 0 || !formData.price) {\n      toast({\n        title: 'Error',\n        description: 'Por favor complete todos los campos requeridos. Debes agregar al menos una categor√≠a usando el bot√≥n +',\n        variant: 'destructive'\n      });\n      return;\n    }\n\n    try {\n      // Upload image if selected\n      const imageUrl = await handleImageUpload();\n\n      if (editingProduct) {\n        // Update existing product\n        console.log('Updating product with data:', {\n          name: formData.name,\n          category: formData.category,\n          price: parseFloat(formData.price),\n          categoryType: typeof formData.category,\n          categoryIsArray: Array.isArray(formData.category)\n        });\n        \n        const { error } = await supabase\n          .from('products')\n          .update({\n            name: formData.name,\n            category: formData.category,\n            description: formData.description || null,\n            price: parseFloat(formData.price),\n            is_available: formData.is_available,\n            image: imageUrl,\n            stock_enabled: formData.stock_enabled,\n            stock_quantity: formData.stock_enabled ? (formData.stock_quantity ? parseInt(formData.stock_quantity) : 0) : null\n          })\n          .eq('id', editingProduct.id);\n\n        if (error) {\n          console.error('Supabase error updating:', error);\n          throw error;\n        }\n\n        toast({\n          title: '√âxito',\n          description: 'Producto actualizado correctamente'\n        });\n      } else {\n        // Create new product\n        console.log('Creating product with data:', {\n          name: formData.name,\n          category: formData.category,\n          price: parseFloat(formData.price),\n          categoryType: typeof formData.category,\n          categoryIsArray: Array.isArray(formData.category),\n          categoryLength: formData.category.length\n        });\n        \n        const { error } = await supabase\n          .from('products')\n          .insert({\n            vendor_id: vendorId,\n            name: formData.name,\n            category: formData.category,\n            description: formData.description || null,\n            price: parseFloat(formData.price),\n            is_available: formData.is_available,\n            image: imageUrl,\n            stock_enabled: formData.stock_enabled,\n            stock_quantity: formData.stock_enabled ? (formData.stock_quantity ? parseInt(formData.stock_quantity) : 0) : null\n          });\n\n        if (error) {\n          console.error('Supabase error inserting:', error);\n          throw error;\n        }\n\n        toast({\n          title: '√âxito',\n          description: 'Producto agregado correctamente'\n        });\n      }\n\n      // Reset form and refresh\n      setFormData({\n        name: '',\n        category: [],\n        description: '',\n        price: '',\n        is_available: true,\n        image: null,\n        stock_enabled: false,\n        stock_quantity: ''\n      });\n      setNewCategory('');\n      setImageFile(null);\n      setImagePreview(null);\n      setIsAddingProduct(false);\n      setEditingProduct(null);\n      fetchProducts();\n    } catch (error: any) {\n      console.error('Error saving product:', error);\n      const errorMessage = error?.message || error?.error_description || 'No se pudo guardar el producto';\n      toast({\n        title: 'Error',\n        description: errorMessage,\n        variant: 'destructive'\n      });\n    }\n  };\n\n  const handleDeleteProduct = async (productId: string) => {\n    if (!confirm('¬øEst√° seguro de eliminar este producto?')) return;\n\n    try {\n      const { error } = await supabase\n        .from('products')\n        .delete()\n        .eq('id', productId);\n\n      if (error) throw error;\n\n      toast({\n        title: '√âxito',\n        description: 'Producto eliminado correctamente'\n      });\n      fetchProducts();\n    } catch (error) {\n      console.error('Error deleting product:', error);\n      toast({\n        title: 'Error',\n        description: 'No se pudo eliminar el producto',\n        variant: 'destructive'\n      });\n    }\n  };\n\n  const handleToggleAvailability = async (product: Product) => {\n    try {\n      const { error } = await supabase\n        .from('products')\n        .update({ is_available: !product.is_available })\n        .eq('id', product.id);\n\n      if (error) throw error;\n\n      fetchProducts();\n    } catch (error) {\n      console.error('Error updating availability:', error);\n      toast({\n        title: 'Error',\n        description: 'No se pudo actualizar la disponibilidad',\n        variant: 'destructive'\n      });\n    }\n  };\n\n  const startEditProduct = (product: Product) => {\n    setEditingProduct(product);\n    \n    // Asegurar que category siempre sea un array\n    let categoryArray: string[] = [];\n    if (Array.isArray(product.category)) {\n      categoryArray = product.category;\n    } else if (typeof product.category === 'string') {\n      // Convertir string a array para productos antiguos\n      categoryArray = [product.category];\n    }\n    \n    setFormData({\n      name: product.name,\n      category: categoryArray,\n      description: product.description || '',\n      price: product.price.toString(),\n      is_available: product.is_available,\n      image: product.image,\n      stock_enabled: product.stock_enabled,\n      stock_quantity: product.stock_quantity?.toString() || ''\n    });\n    setImagePreview(product.image);\n    setIsAddingProduct(true);\n  };\n\n  const filteredProducts = selectedCategory === 'all' \n    ? products \n    : products.filter(p => {\n        const categories = Array.isArray(p.category) ? p.category : [p.category];\n        return categories.includes(selectedCategory);\n      });\n\n  const handleAddCategory = () => {\n    if (newCategory.trim() && !formData.category.includes(newCategory.trim())) {\n      setFormData({ ...formData, category: [...formData.category, newCategory.trim()] });\n      setNewCategory('');\n    }\n  };\n\n  const handleRemoveCategory = (cat: string) => {\n    setFormData({ ...formData, category: formData.category.filter(c => c !== cat) });\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex justify-center p-8\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Header */}\n      <div className=\"flex justify-between items-center\">\n        <h2 className=\"text-xl font-semibold\">Gesti√≥n de Productos</h2>\n        <Button onClick={() => setIsAddingProduct(true)} size=\"sm\">\n          <Plus className=\"h-4 w-4 mr-2\" />\n          Agregar Producto\n        </Button>\n      </div>\n\n      {/* Category Tabs */}\n      <Tabs value={selectedCategory} onValueChange={setSelectedCategory}>\n        <TabsList className=\"w-full flex-wrap h-auto\">\n          <TabsTrigger value=\"all\">Todos ({products.length})</TabsTrigger>\n          {categories.map(category => {\n            const categoryProducts = products.filter(p => {\n              const cats = Array.isArray(p.category) ? p.category : [p.category];\n              return cats.includes(category);\n            });\n            return (\n              <TabsTrigger key={category} value={category}>\n                {category} ({categoryProducts.length})\n              </TabsTrigger>\n            );\n          })}\n        </TabsList>\n\n        <TabsContent value={selectedCategory} className=\"mt-4\">\n          <div className=\"grid gap-3\">\n            {filteredProducts.map(product => (\n              <Card key={product.id} className={!product.is_available ? 'opacity-60' : ''}>\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-start justify-between gap-4\">\n                    {product.image && (\n                      <img \n                        src={product.image} \n                        alt={product.name}\n                        className=\"w-20 h-20 object-cover rounded-lg\"\n                      />\n                    )}\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-start gap-2 mb-1\">\n                        <h3 className=\"font-semibold\">{product.name}</h3>\n                        <div className=\"flex flex-wrap gap-1\">\n                          {(Array.isArray(product.category) ? product.category : [product.category]).map(cat => (\n                            <span key={cat} className=\"text-xs px-2 py-1 bg-secondary rounded-full\">\n                              {cat}\n                            </span>\n                          ))}\n                        </div>\n                      </div>\n                      {product.description && (\n                        <p className=\"text-sm text-muted-foreground mb-2\">{product.description}</p>\n                      )}\n                      <div className=\"flex items-center gap-3\">\n                        <p className=\"text-lg font-bold text-primary\">\n                          ${product.price.toLocaleString('es-AR')}\n                        </p>\n                        {product.stock_enabled && (\n                          <span className={`text-xs px-2 py-1 rounded-full ${\n                            (product.stock_quantity || 0) === 0 \n                              ? 'bg-red-100 text-red-700' \n                              : (product.stock_quantity || 0) < 5\n                              ? 'bg-yellow-100 text-yellow-700'\n                              : 'bg-green-100 text-green-700'\n                          }`}>\n                            Stock: {product.stock_quantity || 0}\n                          </span>\n                        )}\n                      </div>\n                    </div>\n                    \n                    <div className=\"flex items-center gap-2\">\n                      <Switch\n                        checked={product.is_available}\n                        onCheckedChange={() => handleToggleAvailability(product)}\n                      />\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        onClick={() => startEditProduct(product)}\n                      >\n                        <Edit2 className=\"h-4 w-4\" />\n                      </Button>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        onClick={() => handleDeleteProduct(product.id)}\n                      >\n                        <Trash2 className=\"h-4 w-4 text-destructive\" />\n                      </Button>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n            \n            {filteredProducts.length === 0 && (\n              <Card>\n                <CardContent className=\"p-8 text-center text-muted-foreground\">\n                  No hay productos en esta categor√≠a\n                </CardContent>\n              </Card>\n            )}\n          </div>\n        </TabsContent>\n      </Tabs>\n\n      {/* Add/Edit Product Dialog */}\n      <Dialog open={isAddingProduct} onOpenChange={setIsAddingProduct}>\n        <DialogContent className=\"max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>\n              {editingProduct ? 'Editar Producto' : 'Agregar Producto'}\n            </DialogTitle>\n          </DialogHeader>\n          \n          <div className=\"space-y-4\">\n            <div>\n              <Label htmlFor=\"name\">Nombre *</Label>\n              <Input\n                id=\"name\"\n                value={formData.name}\n                onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                placeholder=\"Ej: Pizza Mozzarella\"\n              />\n            </div>\n            \n            <div>\n              <Label htmlFor=\"category\">Categor√≠as * (debes agregar al menos una)</Label>\n              <div className=\"flex flex-wrap gap-2 mb-2\">\n                {formData.category.length === 0 && (\n                  <p className=\"text-sm text-muted-foreground\">\n                    üëÜ Escribe una categor√≠a y presiona el bot√≥n + para agregarla\n                  </p>\n                )}\n                {formData.category.map(cat => (\n                  <span key={cat} className=\"inline-flex items-center gap-1 text-xs px-3 py-1 bg-primary text-primary-foreground rounded-full\">\n                    {cat}\n                    <button\n                      type=\"button\"\n                      onClick={() => handleRemoveCategory(cat)}\n                      className=\"hover:bg-primary-foreground/20 rounded-full p-0.5\"\n                    >\n                      <X className=\"h-3 w-3\" />\n                    </button>\n                  </span>\n                ))}\n              </div>\n              <div className=\"flex gap-2\">\n                <Input\n                  id=\"category\"\n                  value={newCategory}\n                  onChange={(e) => setNewCategory(e.target.value)}\n                  onKeyPress={(e) => e.key === 'Enter' && (e.preventDefault(), handleAddCategory())}\n                  placeholder=\"Ej: Plantas, Abonos, Herramientas...\"\n                  list=\"categories\"\n                />\n                <Button type=\"button\" onClick={handleAddCategory} size=\"sm\">\n                  <Plus className=\"h-4 w-4\" />\n                </Button>\n              </div>\n              <datalist id=\"categories\">\n                {categories.map(cat => (\n                  <option key={cat} value={cat} />\n                ))}\n              </datalist>\n            </div>\n            \n            <div>\n              <Label htmlFor=\"description\">Descripci√≥n</Label>\n              <Textarea\n                id=\"description\"\n                value={formData.description}\n                onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n                placeholder=\"Descripci√≥n opcional del producto\"\n                rows={3}\n              />\n            </div>\n            \n            <div>\n              <Label htmlFor=\"price\">Precio *</Label>\n              <Input\n                id=\"price\"\n                type=\"number\"\n                value={formData.price}\n                onChange={(e) => setFormData({ ...formData, price: e.target.value })}\n                placeholder=\"0.00\"\n                min=\"0\"\n                step=\"0.01\"\n              />\n            </div>\n\n            <div>\n              <Label htmlFor=\"product-image\">Imagen del Producto (opcional)</Label>\n              {(imagePreview || formData.image) && (\n                <div className=\"relative w-32 h-32 mb-2\">\n                  <img \n                    src={imagePreview || formData.image!} \n                    alt=\"Preview\" \n                    className=\"w-full h-full object-cover rounded-lg border\"\n                  />\n                  <Button\n                    type=\"button\"\n                    variant=\"destructive\"\n                    size=\"icon\"\n                    className=\"absolute -top-2 -right-2 h-6 w-6\"\n                    onClick={handleRemoveImage}\n                  >\n                    <X className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              )}\n              <Input\n                id=\"product-image\"\n                type=\"file\"\n                accept=\"image/*\"\n                onChange={handleImageSelect}\n                disabled={uploading}\n              />\n              <p className=\"text-xs text-muted-foreground mt-1\">\n                Formatos aceptados: JPG, PNG, WEBP (m√°x 5MB)\n              </p>\n            </div>\n            \n            <div className=\"flex items-center space-x-2\">\n              <Switch\n                id=\"available\"\n                checked={formData.is_available}\n                onCheckedChange={(checked) => setFormData({ ...formData, is_available: checked })}\n              />\n              <Label htmlFor=\"available\">Disponible</Label>\n            </div>\n\n            <div className=\"space-y-3 p-4 border rounded-lg\">\n              <div className=\"flex items-center space-x-2\">\n                <Switch\n                  id=\"stock-enabled\"\n                  checked={formData.stock_enabled}\n                  onCheckedChange={(checked) => setFormData({ ...formData, stock_enabled: checked })}\n                />\n                <Label htmlFor=\"stock-enabled\">Controlar Stock</Label>\n              </div>\n              \n              {formData.stock_enabled && (\n                <div>\n                  <Label htmlFor=\"stock-quantity\">Cantidad en Stock</Label>\n                  <Input\n                    id=\"stock-quantity\"\n                    type=\"number\"\n                    value={formData.stock_quantity}\n                    onChange={(e) => setFormData({ ...formData, stock_quantity: e.target.value })}\n                    placeholder=\"0\"\n                    min=\"0\"\n                    step=\"1\"\n                  />\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    El producto se deshabilitar√° autom√°ticamente cuando el stock llegue a 0\n                  </p>\n                </div>\n              )}\n            </div>\n          </div>\n          \n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setIsAddingProduct(false);\n                setEditingProduct(null);\n                setImageFile(null);\n                setImagePreview(null);\n                setNewCategory('');\n                setFormData({\n                  name: '',\n                  category: [],\n                  description: '',\n                  price: '',\n                  is_available: true,\n                  image: null,\n                  stock_enabled: false,\n                  stock_quantity: ''\n                });\n              }}\n            >\n              <X className=\"h-4 w-4 mr-2\" />\n              Cancelar\n            </Button>\n            <Button onClick={handleSaveProduct}>\n              <Save className=\"h-4 w-4 mr-2\" />\n              Guardar\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\VendorReviews.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchReviews' and 'fetchVendorStats'. Either include them or remove the dependency array.","line":38,"column":6,"nodeType":"ArrayExpression","endLine":38,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [fetchReviews, fetchVendorStats, vendorId]","fix":{"range":[1209,1219],"text":"[fetchReviews, fetchVendorStats, vendorId]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { supabase } from '@/integrations/supabase/client';\nimport { useToast } from '@/hooks/use-toast';\nimport { Star, MessageSquare, User, Truck, Users, Package } from 'lucide-react';\nimport { format } from 'date-fns';\nimport { es } from 'date-fns/locale';\nimport { maskPhone } from '@/lib/utils';\n\ninterface VendorReview {\n  id: string;\n  customer_name?: string;\n  customer_phone: string;\n  rating?: number | null;\n  delivery_rating?: number | null;\n  service_rating?: number | null;\n  product_rating?: number | null;\n  comment?: string;\n  created_at: Date;\n  order_id?: string | null;\n}\n\ninterface VendorReviewsProps {\n  vendorId: string;\n}\n\nexport function VendorReviews({ vendorId }: VendorReviewsProps) {\n  const [reviews, setReviews] = useState<VendorReview[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [averageRating, setAverageRating] = useState(0);\n  const [totalReviews, setTotalReviews] = useState(0);\n  const { toast } = useToast();\n\n  useEffect(() => {\n    fetchReviews();\n    fetchVendorStats();\n  }, [vendorId]);\n\n  const fetchReviews = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('vendor_reviews')\n        .select('*')\n        .eq('vendor_id', vendorId)\n        .order('created_at', { ascending: false })\n        .limit(50);\n\n      if (error) throw error;\n\n      setReviews(data?.map(review => ({\n        ...review,\n        created_at: new Date(review.created_at)\n      })) || []);\n    } catch (error) {\n      console.error('Error fetching reviews:', error);\n      toast({\n        title: 'Error',\n        description: 'No se pudieron cargar las rese√±as',\n        variant: 'destructive'\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchVendorStats = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('vendors')\n        .select('average_rating, total_reviews')\n        .eq('id', vendorId)\n        .single();\n\n      if (error) throw error;\n\n      setAverageRating(data?.average_rating || 0);\n      setTotalReviews(data?.total_reviews || 0);\n    } catch (error) {\n      console.error('Error fetching vendor stats:', error);\n    }\n  };\n\n  const renderStars = (rating: number | null | undefined, size: 'sm' | 'md' = 'md') => {\n    if (!rating) return null;\n    const sizeClass = size === 'sm' ? 'h-3 w-3' : 'h-4 w-4';\n    \n    return (\n      <div className=\"flex gap-0.5\">\n        {[1, 2, 3, 4, 5].map((star) => (\n          <Star\n            key={star}\n            className={`${sizeClass} ${\n              star <= rating\n                ? 'fill-yellow-400 text-yellow-400'\n                : 'fill-muted text-muted'\n            }`}\n          />\n        ))}\n      </div>\n    );\n  };\n\n  const getRatingDistribution = () => {\n    const distribution = { 5: 0, 4: 0, 3: 0, 2: 0, 1: 0 };\n    reviews.forEach(review => {\n      const rating = review.rating || \n        (review.delivery_rating && review.service_rating && review.product_rating \n          ? Math.round((review.delivery_rating + review.service_rating + review.product_rating) / 3)\n          : null);\n      if (rating) {\n        distribution[rating as keyof typeof distribution]++;\n      }\n    });\n    return distribution;\n  };\n\n  const getAverageDetailedRatings = () => {\n    const totals = { delivery: 0, service: 0, product: 0 };\n    const counts = { delivery: 0, service: 0, product: 0 };\n    \n    reviews.forEach(review => {\n      if (review.delivery_rating) {\n        totals.delivery += review.delivery_rating;\n        counts.delivery++;\n      }\n      if (review.service_rating) {\n        totals.service += review.service_rating;\n        counts.service++;\n      }\n      if (review.product_rating) {\n        totals.product += review.product_rating;\n        counts.product++;\n      }\n    });\n    \n    return {\n      delivery: counts.delivery > 0 ? totals.delivery / counts.delivery : 0,\n      service: counts.service > 0 ? totals.service / counts.service : 0,\n      product: counts.product > 0 ? totals.product / counts.product : 0\n    };\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex justify-center items-center h-64\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n      </div>\n    );\n  }\n\n  const ratingDistribution = getRatingDistribution();\n  const detailedAverages = getAverageDetailedRatings();\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Resumen de calificaciones */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Rese√±as de Clientes</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-6\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              {/* Promedio general */}\n              <div className=\"text-center\">\n                <div className=\"text-4xl font-bold mb-2\">\n                  {averageRating.toFixed(1)}\n                </div>\n                <div className=\"flex justify-center mb-2\">\n                  {renderStars(Math.round(averageRating))}\n                </div>\n                <p className=\"text-sm text-muted-foreground\">\n                  {totalReviews} rese√±as totales\n                </p>\n              </div>\n\n              {/* Distribuci√≥n de calificaciones */}\n              <div className=\"space-y-2\">\n                {[5, 4, 3, 2, 1].map((rating) => (\n                  <div key={rating} className=\"flex items-center gap-2\">\n                    <span className=\"text-sm w-3\">{rating}</span>\n                    <Star className=\"h-4 w-4 fill-yellow-400 text-yellow-400\" />\n                    <div className=\"flex-1 bg-muted rounded-full h-2 overflow-hidden\">\n                      <div\n                        className=\"bg-yellow-400 h-full transition-all\"\n                        style={{\n                          width: `${\n                            totalReviews > 0\n                              ? (ratingDistribution[rating as keyof typeof ratingDistribution] / totalReviews) * 100\n                              : 0\n                          }%`\n                        }}\n                      />\n                    </div>\n                    <span className=\"text-sm text-muted-foreground w-8\">\n                      {ratingDistribution[rating as keyof typeof ratingDistribution]}\n                    </span>\n                  </div>\n                ))}\n              </div>\n            </div>\n\n            {/* Calificaciones por aspecto */}\n            {(detailedAverages.delivery > 0 || detailedAverages.service > 0 || detailedAverages.product > 0) && (\n              <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4 pt-4 border-t\">\n                {detailedAverages.delivery > 0 && (\n                  <div className=\"text-center\">\n                    <div className=\"flex items-center justify-center gap-2 mb-2\">\n                      <Truck className=\"h-4 w-4 text-muted-foreground\" />\n                      <p className=\"text-sm font-medium\">Tiempo de entrega</p>\n                    </div>\n                    {renderStars(Math.round(detailedAverages.delivery), 'sm')}\n                  </div>\n                )}\n                \n                {detailedAverages.service > 0 && (\n                  <div className=\"text-center\">\n                    <div className=\"flex items-center justify-center gap-2 mb-2\">\n                      <Users className=\"h-4 w-4 text-muted-foreground\" />\n                      <p className=\"text-sm font-medium\">Atenci√≥n</p>\n                    </div>\n                    {renderStars(Math.round(detailedAverages.service), 'sm')}\n                  </div>\n                )}\n                \n                {detailedAverages.product > 0 && (\n                  <div className=\"text-center\">\n                    <div className=\"flex items-center justify-center gap-2 mb-2\">\n                      <Package className=\"h-4 w-4 text-muted-foreground\" />\n                      <p className=\"text-sm font-medium\">Producto</p>\n                    </div>\n                    {renderStars(Math.round(detailedAverages.product), 'sm')}\n                  </div>\n                )}\n              </div>\n            )}\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Lista de rese√±as */}\n      <div className=\"space-y-4\">\n        {reviews.map((review) => {\n          const hasDetailedRatings = review.delivery_rating || review.service_rating || review.product_rating;\n          const displayRating = review.rating || \n            (review.delivery_rating && review.service_rating && review.product_rating \n              ? Math.round((review.delivery_rating + review.service_rating + review.product_rating) / 3)\n              : null);\n\n          return (\n            <Card key={review.id}>\n              <CardContent className=\"pt-6\">\n                <div className=\"flex items-start justify-between mb-3\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"bg-muted rounded-full p-2\">\n                      <User className=\"h-5 w-5\" />\n                    </div>\n                    <div>\n                      <p className=\"font-medium\">\n                        {maskPhone(review.customer_phone)}\n                      </p>\n                      <p className=\"text-xs text-muted-foreground\">\n                        {format(review.created_at, \"d 'de' MMMM, yyyy\", { locale: es })}\n                      </p>\n                      {review.order_id && (\n                        <p className=\"text-xs text-muted-foreground\">\n                          Pedido: #{review.order_id.substring(0, 8)}\n                        </p>\n                      )}\n                    </div>\n                  </div>\n                  {displayRating && renderStars(displayRating)}\n                </div>\n                \n                {/* Calificaciones detalladas */}\n                {hasDetailedRatings && (\n                  <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-3 mb-3 p-3 bg-secondary/10 rounded-lg\">\n                    {review.delivery_rating && (\n                      <div className=\"flex items-center gap-2\">\n                        <Truck className=\"h-4 w-4 text-muted-foreground\" />\n                        <div className=\"flex-1\">\n                          <p className=\"text-xs text-muted-foreground\">Tiempo de entrega</p>\n                          {renderStars(review.delivery_rating, 'sm')}\n                        </div>\n                      </div>\n                    )}\n                    \n                    {review.service_rating && (\n                      <div className=\"flex items-center gap-2\">\n                        <Users className=\"h-4 w-4 text-muted-foreground\" />\n                        <div className=\"flex-1\">\n                          <p className=\"text-xs text-muted-foreground\">Atenci√≥n</p>\n                          {renderStars(review.service_rating, 'sm')}\n                        </div>\n                      </div>\n                    )}\n                    \n                    {review.product_rating && (\n                      <div className=\"flex items-center gap-2\">\n                        <Package className=\"h-4 w-4 text-muted-foreground\" />\n                        <div className=\"flex-1\">\n                          <p className=\"text-xs text-muted-foreground\">Producto</p>\n                          {renderStars(review.product_rating, 'sm')}\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                )}\n                \n                {review.comment && (\n                  <div className=\"flex gap-2\">\n                    <MessageSquare className=\"h-4 w-4 text-muted-foreground mt-0.5\" />\n                    <p className=\"text-sm text-muted-foreground flex-1\">\n                      {review.comment}\n                    </p>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          );\n        })}\n\n        {reviews.length === 0 && (\n          <Card>\n            <CardContent className=\"text-center py-12\">\n              <Star className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n              <p className=\"text-muted-foreground\">\n                A√∫n no hay rese√±as\n              </p>\n              <p className=\"text-sm text-muted-foreground mt-2\">\n                Las rese√±as de los clientes aparecer√°n aqu√≠\n              </p>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\VendorSettings.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchVendorData'. Either include it or remove the dependency array.","line":52,"column":6,"nodeType":"ArrayExpression","endLine":52,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [fetchVendorData, vendorId]","fix":{"range":[1912,1922],"text":"[fetchVendorData, vendorId]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Switch } from '@/components/ui/switch';\nimport { useToast } from '@/hooks/use-toast';\nimport { Building2, Save, Upload, X } from 'lucide-react';\nimport { VendorNotificationSettings } from '@/components/VendorNotificationSettings';\n\ninterface VendorData {\n  id: string;\n  name: string;\n  category: string;\n  phone: string;\n  whatsapp_number: string | null;\n  address: string;\n  is_active: boolean;\n  image: string | null;\n  latitude: number | null;\n  longitude: number | null;\n  delivery_radius_km: number;\n  delivery_price_per_km: number;\n  delivery_pricing_type: string;\n  delivery_fixed_price: number;\n  delivery_additional_per_km: number;\n  allows_pickup?: boolean;\n  pickup_instructions?: string | null;\n  allows_delivery?: boolean;  // ‚≠ê NUEVO: permite delivery\n}\n\ninterface VendorSettingsProps {\n  vendorId: string;\n}\n\nexport function VendorSettings({ vendorId }: VendorSettingsProps) {\n  const [vendorData, setVendorData] = useState<VendorData | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [saving, setSaving] = useState(false);\n  const [uploading, setUploading] = useState(false);\n  const [imageFile, setImageFile] = useState<File | null>(null);\n  const [imagePreview, setImagePreview] = useState<string | null>(null);\n  const [categories, setCategories] = useState<string[]>([]);\n  const { toast } = useToast();\n\n  useEffect(() => {\n    fetchVendorData();\n    fetchCategories();\n  }, [vendorId]);\n\n  const fetchCategories = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('vendors')\n        .select('category');\n\n      if (error) throw error;\n      \n      const uniqueCategories = [...new Set(data.map(v => v.category))].filter(Boolean);\n      setCategories(uniqueCategories);\n    } catch (error) {\n      console.error('Error fetching categories:', error);\n    }\n  };\n\n  const fetchVendorData = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('vendors')\n        .select('*')\n        .eq('id', vendorId)\n        .single();\n\n      if (error) throw error;\n      setVendorData(data);\n    } catch (error) {\n      console.error('Error fetching vendor data:', error);\n      toast({\n        title: 'Error',\n        description: 'No se pudieron cargar los datos del negocio',\n        variant: 'destructive'\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleImageSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      setImageFile(file);\n      const reader = new FileReader();\n      reader.onloadend = () => {\n        setImagePreview(reader.result as string);\n      };\n      reader.readAsDataURL(file);\n    }\n  };\n\n  const handleImageUpload = async () => {\n    if (!imageFile) return null;\n\n    setUploading(true);\n    try {\n      const fileExt = imageFile.name.split('.').pop();\n      const fileName = `${vendorId}/${Date.now()}.${fileExt}`;\n\n      const { error: uploadError } = await supabase.storage\n        .from('vendor-images')\n        .upload(fileName, imageFile, { upsert: true });\n\n      if (uploadError) throw uploadError;\n\n      const { data: { publicUrl } } = supabase.storage\n        .from('vendor-images')\n        .getPublicUrl(fileName);\n\n      return publicUrl;\n    } catch (error) {\n      console.error('Error uploading image:', error);\n      toast({\n        title: 'Error',\n        description: 'No se pudo subir la imagen',\n        variant: 'destructive'\n      });\n      return null;\n    } finally {\n      setUploading(false);\n    }\n  };\n\n  const handleRemoveImage = () => {\n    setImageFile(null);\n    setImagePreview(null);\n    setVendorData({ ...vendorData!, image: null });\n  };\n\n  const handleSave = async () => {\n    if (!vendorData) return;\n\n    setSaving(true);\n    try {\n      let imageUrl = vendorData.image;\n\n      // Upload new image if selected\n      if (imageFile) {\n        const uploadedUrl = await handleImageUpload();\n        if (uploadedUrl) {\n          imageUrl = uploadedUrl;\n        }\n      }\n\n      const { error } = await supabase\n        .from('vendors')\n        .update({\n          name: vendorData.name,\n          category: vendorData.category,\n          phone: vendorData.phone,\n          whatsapp_number: vendorData.whatsapp_number,\n          address: vendorData.address,\n          is_active: vendorData.is_active,\n          image: imageUrl,\n          latitude: vendorData.latitude,\n          longitude: vendorData.longitude,\n          delivery_radius_km: vendorData.delivery_radius_km,\n          delivery_price_per_km: vendorData.delivery_price_per_km,\n          delivery_pricing_type: vendorData.delivery_pricing_type,\n          delivery_fixed_price: vendorData.delivery_fixed_price,\n          delivery_additional_per_km: vendorData.delivery_additional_per_km,\n          allows_pickup: vendorData.allows_pickup || false,\n          pickup_instructions: vendorData.pickup_instructions || null,\n          allows_delivery: vendorData.allows_delivery ?? true  // ‚≠ê NUEVO\n        })\n        .eq('id', vendorId);\n\n      if (error) throw error;\n\n      toast({\n        title: '√âxito',\n        description: 'Informaci√≥n actualizada correctamente'\n      });\n\n      setImageFile(null);\n      setImagePreview(null);\n      fetchVendorData();\n    } catch (error) {\n      console.error('Error saving vendor data:', error);\n      toast({\n        title: 'Error',\n        description: 'No se pudo guardar la informaci√≥n',\n        variant: 'destructive'\n      });\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex justify-center p-8\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n      </div>\n    );\n  }\n\n  if (!vendorData) return null;\n\n  return (\n    <div className=\"space-y-6\">\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Building2 className=\"h-5 w-5\" />\n            Configuraci√≥n del Negocio\n          </CardTitle>\n        </CardHeader>\n      <CardContent className=\"space-y-4\">\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"name\">Nombre del Negocio</Label>\n            <Input\n              id=\"name\"\n              value={vendorData.name}\n              onChange={(e) => setVendorData({ ...vendorData, name: e.target.value })}\n            />\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"category\">Categor√≠a</Label>\n            <Select\n              value={vendorData.category}\n              onValueChange={(value) => setVendorData({ ...vendorData, category: value })}\n            >\n              <SelectTrigger id=\"category\">\n                <SelectValue placeholder=\"Seleccionar categor√≠a\" />\n              </SelectTrigger>\n              <SelectContent className=\"bg-background z-50\">\n                {categories.map((cat) => (\n                  <SelectItem key={cat} value={cat}>\n                    {cat.charAt(0).toUpperCase() + cat.slice(1)}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"phone\">Tel√©fono</Label>\n            <Input\n              id=\"phone\"\n              type=\"tel\"\n              value={vendorData.phone}\n              onChange={(e) => setVendorData({ ...vendorData, phone: e.target.value })}\n              placeholder=\"+54911234567890\"\n            />\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"whatsapp\">WhatsApp (opcional)</Label>\n            <Input\n              id=\"whatsapp\"\n              type=\"tel\"\n              value={vendorData.whatsapp_number || ''}\n              onChange={(e) => setVendorData({ ...vendorData, whatsapp_number: e.target.value || null })}\n              placeholder=\"+54911234567890\"\n            />\n          </div>\n        </div>\n\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"address\">Direcci√≥n</Label>\n          <Textarea\n            id=\"address\"\n            value={vendorData.address}\n            onChange={(e) => setVendorData({ ...vendorData, address: e.target.value })}\n            rows={2}\n          />\n        </div>\n\n        <div className=\"border-t pt-4 mt-4\">\n          <h3 className=\"text-lg font-semibold mb-4\">üìç Ubicaci√≥n y Radio de Cobertura</h3>\n          <p className=\"text-sm text-muted-foreground mb-4\">\n            Configur√° tu ubicaci√≥n y radio para que los clientes vean si est√°s en su zona de delivery.\n          </p>\n          \n          <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"latitude\">Latitud</Label>\n              <Input\n                id=\"latitude\"\n                type=\"number\"\n                step=\"0.000001\"\n                value={vendorData.latitude || ''}\n                onChange={(e) => setVendorData({ ...vendorData, latitude: e.target.value ? parseFloat(e.target.value) : null })}\n                placeholder=\"-27.123456\"\n              />\n              <p className=\"text-xs text-muted-foreground\">\n                Ej: -27.451944\n              </p>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"longitude\">Longitud</Label>\n              <Input\n                id=\"longitude\"\n                type=\"number\"\n                step=\"0.000001\"\n                value={vendorData.longitude || ''}\n                onChange={(e) => setVendorData({ ...vendorData, longitude: e.target.value ? parseFloat(e.target.value) : null })}\n                placeholder=\"-58.987654\"\n              />\n              <p className=\"text-xs text-muted-foreground\">\n                Ej: -58.983194\n              </p>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"delivery_radius\">Radio de Cobertura (km)</Label>\n              <Input\n                id=\"delivery_radius\"\n                type=\"number\"\n                step=\"0.5\"\n                min=\"0.5\"\n                max=\"50\"\n                value={vendorData.delivery_radius_km}\n                onChange={(e) => setVendorData({ ...vendorData, delivery_radius_km: parseFloat(e.target.value) || 5.0 })}\n              />\n              <p className=\"text-xs text-muted-foreground\">\n                Distancia m√°xima: {vendorData.delivery_radius_km} km\n              </p>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"delivery_pricing_type\">Tipo de Cobro de Delivery</Label>\n              <Select\n                value={vendorData.delivery_pricing_type || 'per_km'}\n                onValueChange={(value) => setVendorData({ ...vendorData, delivery_pricing_type: value })}\n              >\n                <SelectTrigger id=\"delivery_pricing_type\">\n                  <SelectValue placeholder=\"Seleccionar tipo de cobro\" />\n                </SelectTrigger>\n                <SelectContent className=\"bg-background z-50\">\n                  <SelectItem value=\"per_km\">Por Kil√≥metro Total</SelectItem>\n                  <SelectItem value=\"fixed\">Monto Fijo</SelectItem>\n                  <SelectItem value=\"base_plus_km\">Base + Adicional por Km</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            {vendorData.delivery_pricing_type === 'per_km' && (\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"delivery_price\">Precio por Kil√≥metro ($)</Label>\n                <Input\n                  id=\"delivery_price\"\n                  type=\"number\"\n                  step=\"100\"\n                  min=\"0\"\n                  value={vendorData.delivery_price_per_km || 0}\n                  onChange={(e) => setVendorData({ ...vendorData, delivery_price_per_km: parseFloat(e.target.value) || 0 })}\n                />\n                <p className=\"text-xs text-muted-foreground\">\n                  üí∞ Se multiplica la distancia total por este valor\n                </p>\n              </div>\n            )}\n\n            {vendorData.delivery_pricing_type === 'fixed' && (\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"delivery_fixed_price\">Precio Fijo de Delivery ($)</Label>\n                <Input\n                  id=\"delivery_fixed_price\"\n                  type=\"number\"\n                  step=\"100\"\n                  min=\"0\"\n                  value={vendorData.delivery_fixed_price || 0}\n                  onChange={(e) => setVendorData({ ...vendorData, delivery_fixed_price: parseFloat(e.target.value) || 0 })}\n                  placeholder=\"Ej: 1000\"\n                />\n                <p className=\"text-xs text-muted-foreground\">\n                  üí∞ Todos los deliveries cuestan lo mismo, sin importar la distancia\n                </p>\n              </div>\n            )}\n\n            {vendorData.delivery_pricing_type === 'base_plus_km' && (\n              <>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"delivery_fixed_price_base\">Precio Base (Primer Km) ($)</Label>\n                  <Input\n                    id=\"delivery_fixed_price_base\"\n                    type=\"number\"\n                    step=\"100\"\n                    min=\"0\"\n                    value={vendorData.delivery_fixed_price || 0}\n                    onChange={(e) => setVendorData({ ...vendorData, delivery_fixed_price: parseFloat(e.target.value) || 0 })}\n                    placeholder=\"Ej: 1000\"\n                  />\n                  <p className=\"text-xs text-muted-foreground\">\n                    üí∞ Precio dentro del primer kil√≥metro\n                  </p>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"delivery_additional_per_km\">Precio Adicional por Km ($)</Label>\n                  <Input\n                    id=\"delivery_additional_per_km\"\n                    type=\"number\"\n                    step=\"100\"\n                    min=\"0\"\n                    value={vendorData.delivery_additional_per_km || 0}\n                    onChange={(e) => setVendorData({ ...vendorData, delivery_additional_per_km: parseFloat(e.target.value) || 0 })}\n                    placeholder=\"Ej: 500\"\n                  />\n                  <p className=\"text-xs text-muted-foreground\">\n                    üí∞ Se suma por cada kil√≥metro despu√©s del primero\n                  </p>\n                </div>\n              </>\n            )}\n          </div>\n\n          <div className=\"mt-3 p-3 bg-muted rounded-lg\">\n            <p className=\"text-sm\">\n              üí° <strong>C√≥mo obtener tus coordenadas:</strong>\n            </p>\n            <ol className=\"text-sm list-decimal list-inside mt-2 space-y-1 text-muted-foreground\">\n              <li>Abr√≠ Google Maps en tu navegador</li>\n              <li>Busc√° la direcci√≥n de tu negocio</li>\n              <li>Hac√© clic derecho en el marcador</li>\n              <li>Seleccion√° las coordenadas que aparecen (formato: -27.123456, -58.987654)</li>\n              <li>Peg√° el primer n√∫mero en Latitud y el segundo en Longitud</li>\n            </ol>\n          </div>\n        </div>\n\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"image\">Imagen del Negocio (opcional)</Label>\n          {(imagePreview || vendorData.image) && (\n            <div className=\"relative w-32 h-32 mb-2\">\n              <img \n                src={imagePreview || vendorData.image!} \n                alt=\"Preview\" \n                className=\"w-full h-full object-cover rounded-lg border\"\n              />\n              <Button\n                type=\"button\"\n                variant=\"destructive\"\n                size=\"icon\"\n                className=\"absolute -top-2 -right-2 h-6 w-6\"\n                onClick={handleRemoveImage}\n              >\n                <X className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          )}\n          <Input\n            id=\"image\"\n            type=\"file\"\n            accept=\"image/*\"\n            onChange={handleImageSelect}\n            disabled={uploading}\n          />\n          <p className=\"text-xs text-muted-foreground\">\n            Formatos aceptados: JPG, PNG, WEBP (m√°x 5MB)\n          </p>\n        </div>\n\n        <div className=\"flex items-center space-x-2\">\n          <Switch\n            id=\"active\"\n            checked={vendorData.is_active}\n            onCheckedChange={(checked) => setVendorData({ ...vendorData, is_active: checked })}\n          />\n          <Label htmlFor=\"active\">\n            Negocio activo (visible para clientes)\n          </Label>\n        </div>\n\n        {/* ‚≠ê SECCI√ìN: Opciones de Entrega */}\n        <div className=\"border-t pt-4 mt-4\">\n          <h3 className=\"text-lg font-semibold mb-4\">üöö Opciones de Entrega</h3>\n          <p className=\"text-sm text-muted-foreground mb-4\">\n            Configur√° c√≥mo los clientes pueden recibir sus pedidos. Debe estar habilitada al menos una opci√≥n.\n          </p>\n          \n          {/* Validaci√≥n: al menos uno debe estar activo */}\n          {!vendorData.allows_delivery && !vendorData.allows_pickup && (\n            <div className=\"bg-destructive/10 text-destructive p-3 rounded-lg mb-4 text-sm\">\n              ‚ö†Ô∏è Debes habilitar al menos una opci√≥n de entrega (Delivery o Retiro en local)\n            </div>\n          )}\n          \n          <div className=\"space-y-4\">\n            {/* Delivery */}\n            <div className=\"p-4 border rounded-lg space-y-3\">\n              <div className=\"flex items-center space-x-2\">\n                <Switch\n                  id=\"allows_delivery\"\n                  checked={vendorData.allows_delivery ?? true}\n                  onCheckedChange={(checked) => {\n                    // No permitir desactivar si pickup tampoco est√° activo\n                    if (!checked && !vendorData.allows_pickup) {\n                      return;\n                    }\n                    setVendorData({ ...vendorData, allows_delivery: checked });\n                  }}\n                />\n                <Label htmlFor=\"allows_delivery\" className=\"font-medium\">\n                  üöö Permite Delivery (env√≠o a domicilio)\n                </Label>\n              </div>\n              {(vendorData.allows_delivery ?? true) && (\n                <p className=\"text-xs text-muted-foreground pl-6\">\n                  Los clientes pueden recibir sus pedidos en su direcci√≥n\n                </p>\n              )}\n            </div>\n            \n            {/* Pickup */}\n            <div className=\"p-4 border rounded-lg space-y-3\">\n              <div className=\"flex items-center space-x-2\">\n                <Switch\n                  id=\"allows_pickup\"\n                  checked={vendorData.allows_pickup || false}\n                  onCheckedChange={(checked) => {\n                    // No permitir desactivar si delivery tampoco est√° activo\n                    if (!checked && !(vendorData.allows_delivery ?? true)) {\n                      return;\n                    }\n                    setVendorData({ ...vendorData, allows_pickup: checked });\n                  }}\n                />\n                <Label htmlFor=\"allows_pickup\" className=\"font-medium\">\n                  üè™ Permite Retiro en Local\n                </Label>\n              </div>\n              \n              {vendorData.allows_pickup && (\n                <div className=\"space-y-2 pl-6\">\n                  <Label htmlFor=\"pickup_instructions\">Instrucciones para retiro (opcional)</Label>\n                  <Textarea\n                    id=\"pickup_instructions\"\n                    value={vendorData.pickup_instructions || ''}\n                    onChange={(e) => setVendorData({ ...vendorData, pickup_instructions: e.target.value })}\n                    placeholder=\"Ej: Retirar por la puerta lateral, horario de 9 a 18hs\"\n                    rows={3}\n                  />\n                  <p className=\"text-xs text-muted-foreground\">\n                    üí° Estas instrucciones se mostrar√°n a los clientes cuando elijan retiro en local\n                  </p>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n\n        <Button \n          onClick={handleSave} \n          disabled={saving}\n          className=\"w-full\"\n        >\n          {saving ? (\n            <>\n              <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n              Guardando...\n            </>\n          ) : (\n            <>\n              <Save className=\"h-4 w-4 mr-2\" />\n              Guardar Cambios\n            </>\n          )}\n        </Button>\n      </CardContent>\n    </Card>\n    \n    <VendorNotificationSettings \n      vendorId={vendorId} \n      hasWhatsApp={!!vendorData.whatsapp_number}\n    />\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\VendorSupportTickets.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchTickets' and 'setupRealtimeSubscription'. Either include them or remove the dependency array.","line":46,"column":6,"nodeType":"ArrayExpression","endLine":46,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [fetchTickets, setupRealtimeSubscription, vendorId]","fix":{"range":[1711,1721],"text":"[fetchTickets, setupRealtimeSubscription, vendorId]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { Button } from '@/components/ui/button';\nimport { Card } from '@/components/ui/card';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { useToast } from '@/hooks/use-toast';\nimport { Plus, MessageSquare, Send, ArrowLeft } from 'lucide-react';\nimport { ScrollArea } from '@/components/ui/scroll-area';\n\ninterface Ticket {\n  id: string;\n  subject: string;\n  status: string;\n  priority: string;\n  created_at: string;\n  updated_at: string;\n}\n\ninterface Message {\n  id: string;\n  ticket_id: string;\n  sender_type: 'customer' | 'support';\n  message: string;\n  created_at: string;\n}\n\nexport function VendorSupportTickets({ vendorId }: { vendorId: string }) {\n  const [tickets, setTickets] = useState<Ticket[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [subject, setSubject] = useState('');\n  const [description, setDescription] = useState('');\n  const [priority, setPriority] = useState('normal');\n  const [selectedTicket, setSelectedTicket] = useState<Ticket | null>(null);\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [newMessage, setNewMessage] = useState('');\n  const [sendingMessage, setSendingMessage] = useState(false);\n  const { toast } = useToast();\n\n  useEffect(() => {\n    fetchTickets();\n    setupRealtimeSubscription();\n  }, [vendorId]);\n\n  useEffect(() => {\n    if (selectedTicket) {\n      fetchMessages(selectedTicket.id);\n    }\n  }, [selectedTicket]);\n\n  const setupRealtimeSubscription = () => {\n    const ticketsChannel = supabase\n      .channel('vendor-tickets-changes')\n      .on('postgres_changes', {\n        event: '*',\n        schema: 'public',\n        table: 'support_tickets'\n      }, () => {\n        fetchTickets();\n      })\n      .on('postgres_changes', {\n        event: 'INSERT',\n        schema: 'public',\n        table: 'support_messages',\n        filter: selectedTicket ? `ticket_id=eq.${selectedTicket.id}` : undefined\n      }, (payload) => {\n        const newMsg = payload.new as Message;\n        setMessages(prev => [...prev, newMsg]);\n      })\n      .subscribe();\n\n    return () => {\n      supabase.removeChannel(ticketsChannel);\n    };\n  };\n\n  const fetchTickets = async () => {\n    try {\n      const { data: vendor } = await supabase\n        .from('vendors')\n        .select('phone')\n        .eq('id', vendorId)\n        .single();\n\n      if (!vendor) return;\n\n      const { data, error } = await supabase\n        .from('support_tickets')\n        .select('*')\n        .eq('customer_phone', vendor.phone)\n        .order('created_at', { ascending: false });\n\n      if (error) throw error;\n      setTickets(data || []);\n    } catch (error) {\n      console.error('Error fetching tickets:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleCreateTicket = async () => {\n    if (!subject.trim() || !description.trim()) {\n      toast({\n        title: 'Error',\n        description: 'Por favor completa todos los campos',\n        variant: 'destructive'\n      });\n      return;\n    }\n\n    try {\n      const { data: vendor } = await supabase\n        .from('vendors')\n        .select('phone, name')\n        .eq('id', vendorId)\n        .single();\n\n      if (!vendor) throw new Error('Vendor not found');\n\n      const { data: ticket, error } = await supabase\n        .from('support_tickets')\n        .insert({\n          customer_phone: vendor.phone,\n          customer_name: vendor.name,\n          subject,\n          priority,\n          status: 'open'\n        })\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      // Add initial message\n      await supabase\n        .from('support_messages')\n        .insert({\n          ticket_id: ticket.id,\n          sender_type: 'customer',\n          message: description\n        });\n\n      toast({\n        title: 'Ticket creado',\n        description: 'El equipo de soporte te contactar√° pronto'\n      });\n\n      setIsDialogOpen(false);\n      setSubject('');\n      setDescription('');\n      setPriority('normal');\n      fetchTickets();\n    } catch (error) {\n      console.error('Error creating ticket:', error);\n      toast({\n        title: 'Error',\n        description: 'No se pudo crear el ticket',\n        variant: 'destructive'\n      });\n    }\n  };\n\n  const fetchMessages = async (ticketId: string) => {\n    try {\n      const { data, error } = await supabase\n        .from('support_messages')\n        .select('*')\n        .eq('ticket_id', ticketId)\n        .order('created_at', { ascending: true });\n\n      if (error) throw error;\n      setMessages((data as Message[]) || []);\n    } catch (error) {\n      console.error('Error fetching messages:', error);\n    }\n  };\n\n  const handleSendMessage = async () => {\n    if (!newMessage.trim() || !selectedTicket) return;\n\n    setSendingMessage(true);\n    try {\n      const { error } = await supabase\n        .from('support_messages')\n        .insert({\n          ticket_id: selectedTicket.id,\n          sender_type: 'customer',\n          message: newMessage.trim()\n        });\n\n      if (error) throw error;\n\n      setNewMessage('');\n      toast({\n        title: 'Mensaje enviado',\n        description: 'Tu mensaje ha sido enviado al equipo de soporte'\n      });\n    } catch (error) {\n      console.error('Error sending message:', error);\n      toast({\n        title: 'Error',\n        description: 'No se pudo enviar el mensaje',\n        variant: 'destructive'\n      });\n    } finally {\n      setSendingMessage(false);\n    }\n  };\n\n  const statusLabels: Record<string, string> = {\n    open: 'Abierto',\n    in_progress: 'En progreso',\n    resolved: 'Resuelto',\n    closed: 'Cerrado'\n  };\n\n  const priorityLabels: Record<string, string> = {\n    low: 'Baja',\n    normal: 'Normal',\n    high: 'Alta',\n    urgent: 'Urgente'\n  };\n\n  if (loading) {\n    return <div>Cargando tickets...</div>;\n  }\n\n  // Vista de detalle del ticket\n  if (selectedTicket) {\n    return (\n      <div className=\"space-y-4\">\n        <div className=\"flex items-center gap-4\">\n          <Button variant=\"ghost\" size=\"sm\" onClick={() => setSelectedTicket(null)}>\n            <ArrowLeft className=\"w-4 h-4 mr-2\" />\n            Volver\n          </Button>\n          <div className=\"flex-1\">\n            <h2 className=\"text-2xl font-bold\">{selectedTicket.subject}</h2>\n            <p className=\"text-sm text-muted-foreground\">\n              ID: #{selectedTicket.id.substring(0, 8)} ‚Ä¢ {statusLabels[selectedTicket.status]} ‚Ä¢ {priorityLabels[selectedTicket.priority]}\n            </p>\n          </div>\n        </div>\n\n        <Card className=\"flex flex-col h-[600px]\">\n          <ScrollArea className=\"flex-1 p-4\">\n            <div className=\"space-y-4\">\n              {messages.map((msg) => (\n                <div\n                  key={msg.id}\n                  className={`flex ${msg.sender_type === 'customer' ? 'justify-end' : 'justify-start'}`}\n                >\n                  <div\n                    className={`max-w-[70%] rounded-lg p-3 ${\n                      msg.sender_type === 'customer'\n                        ? 'bg-primary text-primary-foreground'\n                        : 'bg-muted'\n                    }`}\n                  >\n                    <p className=\"text-sm whitespace-pre-wrap\">{msg.message}</p>\n                    <p className=\"text-xs opacity-70 mt-1\">\n                      {new Date(msg.created_at).toLocaleString('es-AR')}\n                    </p>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </ScrollArea>\n\n          <div className=\"border-t p-4\">\n            <div className=\"flex gap-2\">\n              <Textarea\n                value={newMessage}\n                onChange={(e) => setNewMessage(e.target.value)}\n                placeholder=\"Escribe tu mensaje...\"\n                className=\"min-h-[80px]\"\n                onKeyDown={(e) => {\n                  if (e.key === 'Enter' && !e.shiftKey) {\n                    e.preventDefault();\n                    handleSendMessage();\n                  }\n                }}\n              />\n              <Button\n                onClick={handleSendMessage}\n                disabled={!newMessage.trim() || sendingMessage}\n                size=\"icon\"\n                className=\"self-end\"\n              >\n                <Send className=\"w-4 h-4\" />\n              </Button>\n            </div>\n          </div>\n        </Card>\n      </div>\n    );\n  }\n\n  // Vista de lista de tickets\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex justify-between items-center\">\n        <h2 className=\"text-2xl font-bold\">Tickets de Soporte</h2>\n        <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n          <DialogTrigger asChild>\n            <Button>\n              <Plus className=\"w-4 h-4 mr-2\" />\n              Nuevo Ticket\n            </Button>\n          </DialogTrigger>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>Crear Ticket de Soporte</DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              <div>\n                <label className=\"text-sm font-medium\">Asunto</label>\n                <Input\n                  value={subject}\n                  onChange={(e) => setSubject(e.target.value)}\n                  placeholder=\"Describe brevemente el problema\"\n                />\n              </div>\n              <div>\n                <label className=\"text-sm font-medium\">Descripci√≥n</label>\n                <Textarea\n                  value={description}\n                  onChange={(e) => setDescription(e.target.value)}\n                  placeholder=\"Describe el problema en detalle\"\n                  rows={4}\n                />\n              </div>\n              <div>\n                <label className=\"text-sm font-medium\">Prioridad</label>\n                <Select value={priority} onValueChange={setPriority}>\n                  <SelectTrigger>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"low\">Baja</SelectItem>\n                    <SelectItem value=\"normal\">Normal</SelectItem>\n                    <SelectItem value=\"high\">Alta</SelectItem>\n                    <SelectItem value=\"urgent\">Urgente</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"flex gap-2\">\n                <Button onClick={handleCreateTicket} className=\"flex-1\">\n                  Crear Ticket\n                </Button>\n                <Button variant=\"outline\" onClick={() => setIsDialogOpen(false)}>\n                  Cancelar\n                </Button>\n              </div>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {tickets.length === 0 ? (\n        <Card className=\"p-8 text-center text-muted-foreground\">\n          <MessageSquare className=\"w-12 h-12 mx-auto mb-4 opacity-50\" />\n          <p>No tienes tickets de soporte</p>\n        </Card>\n      ) : (\n        <div className=\"grid gap-4\">\n          {tickets.map((ticket) => (\n            <Card\n              key={ticket.id}\n              className=\"p-4 cursor-pointer hover:bg-accent transition-colors\"\n              onClick={() => setSelectedTicket(ticket)}\n            >\n              <div className=\"flex justify-between items-start\">\n                <div>\n                  <h3 className=\"font-semibold\">{ticket.subject}</h3>\n                  <p className=\"text-sm text-muted-foreground\">\n                    ID: #{ticket.id.substring(0, 8)}\n                  </p>\n                  <p className=\"text-sm mt-2\">\n                    Estado: <span className=\"font-medium\">{statusLabels[ticket.status]}</span>\n                  </p>\n                  <p className=\"text-sm\">\n                    Prioridad: <span className=\"font-medium\">{priorityLabels[ticket.priority]}</span>\n                  </p>\n                </div>\n                <div className=\"text-right text-sm text-muted-foreground\">\n                  {new Date(ticket.created_at).toLocaleDateString('es-AR')}\n                </div>\n              </div>\n            </Card>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\admin\\AdminPaymentMetrics.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchMetrics'. Either include it or remove the dependency array.","line":39,"column":6,"nodeType":"ArrayExpression","endLine":39,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [fetchMetrics, period]","fix":{"range":[1205,1213],"text":"[fetchMetrics, period]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":65,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2017,2020],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2017,2020],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":111,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3621,3624],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3621,3624],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":178,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":178,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5644,5647],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5644,5647],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { Loader2, TrendingUp, DollarSign, Users, Clock } from \"lucide-react\";\nimport { toast } from \"sonner\";\n\ninterface PaymentMetrics {\n  totalPending: number;\n  totalCollected: number;\n  totalHistorical: number;\n  averageCommissionPerVendor: number;\n  vendorsWithPending: number;\n  totalVendors: number;\n  recentInvoices: Invoice[];\n}\n\ninterface Invoice {\n  id: string;\n  vendor_id: string;\n  vendor_name: string;\n  invoice_number: string;\n  period_start: string;\n  period_end: string;\n  total_amount: number;\n  status: 'pending' | 'paid' | 'cancelled';\n  generated_at: string;\n  paid_at: string | null;\n}\n\nexport default function AdminPaymentMetrics() {\n  const [metrics, setMetrics] = useState<PaymentMetrics | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [period, setPeriod] = useState<'7d' | '30d' | 'all'>('30d');\n\n  useEffect(() => {\n    fetchMetrics();\n  }, [period]);\n\n  const fetchMetrics = async () => {\n    try {\n      setLoading(true);\n\n      // Calculate date range\n      let startDate = new Date();\n      if (period === '7d') {\n        startDate.setDate(startDate.getDate() - 7);\n      } else if (period === '30d') {\n        startDate.setDate(startDate.getDate() - 30);\n      } else {\n        startDate = new Date(0); // All time\n      }\n\n      // Fetch commissions\n      const startDateStr = startDate.toISOString();\n      const { data: commissions, error: commissionsError } = await supabase\n        .from('vendor_commissions')\n        .select('*')\n        .gte('created_at', startDateStr);\n\n      if (commissionsError) throw commissionsError;\n\n      // Fetch invoices with vendor names\n      const { data: invoices, error: invoicesError } = await (supabase as any)\n        .from('commission_invoices')\n        .select(`\n          *,\n          vendors (name)\n        `)\n        .gte('generated_at', startDateStr)\n        .order('generated_at', { ascending: false })\n        .limit(10);\n\n      if (invoicesError) throw invoicesError;\n\n      // Calculate metrics\n      const totalPending = commissions\n        ?.filter((c) => c.status === 'pending' || c.status === 'invoiced')\n        .reduce((sum, c) => sum + Number(c.commission_amount || 0), 0) || 0;\n\n      const totalCollected = commissions\n        ?.filter((c) => c.status === 'paid')\n        .reduce((sum, c) => sum + Number(c.commission_amount || 0), 0) || 0;\n\n      // Fetch total historical (all time)\n      const { data: allCommissions } = await supabase\n        .from('vendor_commissions')\n        .select('commission_amount')\n        .eq('status', 'paid');\n\n      const totalHistorical = allCommissions\n        ?.reduce((sum, c) => sum + Number(c.commission_amount || 0), 0) || 0;\n\n      // Get unique vendors with pending commissions\n      const vendorsWithPending = new Set(\n        commissions\n          ?.filter((c) => c.status === 'pending' || c.status === 'invoiced')\n          .map((c) => c.vendor_id)\n      ).size;\n\n      // Get total active vendors\n      const { count: totalVendors } = await supabase\n        .from('vendors')\n        .select('*', { count: 'exact', head: true })\n        .eq('is_active', true);\n\n      const averageCommissionPerVendor = \n        totalVendors && totalVendors > 0 ? totalPending / totalVendors : 0;\n\n      const formattedInvoices: Invoice[] = invoices?.map((inv: any) => ({\n        id: inv.id,\n        vendor_id: inv.vendor_id,\n        vendor_name: inv.vendors?.name || 'Desconocido',\n        invoice_number: inv.invoice_number,\n        period_start: inv.period_start,\n        period_end: inv.period_end,\n        total_amount: parseFloat(inv.total_amount || '0'),\n        status: inv.status,\n        generated_at: inv.generated_at,\n        paid_at: inv.paid_at\n      })) || [];\n\n      setMetrics({\n        totalPending,\n        totalCollected,\n        totalHistorical,\n        averageCommissionPerVendor,\n        vendorsWithPending,\n        totalVendors: totalVendors || 0,\n        recentInvoices: formattedInvoices\n      });\n    } catch (error) {\n      console.error('Error fetching payment metrics:', error);\n      toast.error('Error al cargar m√©tricas de pagos');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat('es-AR', {\n      style: 'currency',\n      currency: 'ARS',\n      minimumFractionDigits: 0,\n      maximumFractionDigits: 0,\n    }).format(amount);\n  };\n\n  const getStatusBadge = (status: string) => {\n    const variants: Record<string, { variant: \"default\" | \"secondary\" | \"destructive\" | \"outline\", label: string }> = {\n      pending: { variant: \"outline\", label: \"Pendiente\" },\n      paid: { variant: \"default\", label: \"Pagado\" },\n      cancelled: { variant: \"destructive\", label: \"Cancelado\" }\n    };\n    const config = variants[status] || variants.pending;\n    return <Badge variant={config.variant}>{config.label}</Badge>;\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  if (!metrics) {\n    return (\n      <div className=\"text-center py-12 text-muted-foreground\">\n        No se pudieron cargar las m√©tricas\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <Tabs value={period} onValueChange={(v) => setPeriod(v as any)}>\n        <TabsList>\n          <TabsTrigger value=\"7d\">√öltimos 7 d√≠as</TabsTrigger>\n          <TabsTrigger value=\"30d\">√öltimos 30 d√≠as</TabsTrigger>\n          <TabsTrigger value=\"all\">Todo el tiempo</TabsTrigger>\n        </TabsList>\n      </Tabs>\n\n      {/* Summary Cards */}\n      <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Pendiente</CardTitle>\n            <Clock className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{formatCurrency(metrics.totalPending)}</div>\n            <p className=\"text-xs text-muted-foreground\">\n              {metrics.vendorsWithPending} vendors con pagos pendientes\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Cobrado en Per√≠odo</CardTitle>\n            <DollarSign className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{formatCurrency(metrics.totalCollected)}</div>\n            <p className=\"text-xs text-muted-foreground\">\n              En el per√≠odo seleccionado\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Hist√≥rico</CardTitle>\n            <TrendingUp className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{formatCurrency(metrics.totalHistorical)}</div>\n            <p className=\"text-xs text-muted-foreground\">\n              Desde el inicio\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Promedio por Vendor</CardTitle>\n            <Users className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{formatCurrency(metrics.averageCommissionPerVendor)}</div>\n            <p className=\"text-xs text-muted-foreground\">\n              {metrics.totalVendors} vendors activos\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Recent Invoices */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Facturas Recientes</CardTitle>\n        </CardHeader>\n        <CardContent>\n          {metrics.recentInvoices.length === 0 ? (\n            <p className=\"text-center text-muted-foreground py-4\">\n              No hay facturas generadas a√∫n\n            </p>\n          ) : (\n            <div className=\"space-y-4\">\n              {metrics.recentInvoices.map((invoice) => (\n                <div\n                  key={invoice.id}\n                  className=\"flex items-center justify-between border-b pb-4 last:border-0 last:pb-0\"\n                >\n                  <div className=\"space-y-1\">\n                    <div className=\"font-medium\">{invoice.vendor_name}</div>\n                    <div className=\"text-sm text-muted-foreground\">\n                      {invoice.invoice_number} ‚Ä¢ {new Date(invoice.period_start).toLocaleDateString('es-AR')} - {new Date(invoice.period_end).toLocaleDateString('es-AR')}\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-4\">\n                    <div className=\"text-right\">\n                      <div className=\"font-semibold\">{formatCurrency(invoice.total_amount)}</div>\n                      <div className=\"text-xs text-muted-foreground\">\n                        {new Date(invoice.generated_at).toLocaleDateString('es-AR')}\n                      </div>\n                    </div>\n                    {getStatusBadge(invoice.status)}\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\admin\\CommissionInvoiceGenerator.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchData'. Either include it or remove the dependency array.","line":52,"column":6,"nodeType":"ArrayExpression","endLine":52,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchData]","fix":{"range":[1872,1874],"text":"[fetchData]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":84,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2661,2664],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2661,2664],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":84,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2672,2675],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2672,2675],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":112,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3619,3622],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3619,3622],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":130,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4001,4004],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4001,4004],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":150,"column":84,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":150,"endColumn":87,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4615,4618],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4615,4618],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":156,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":156,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4817,4820],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4817,4820],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":172,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":172,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5393,5396],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5393,5396],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":177,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":177,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5544,5547],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5544,5547],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":205,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":205,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6431,6434],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6431,6434],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":216,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":216,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6730,6733],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6730,6733],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":222,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":222,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6915,6918],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6915,6918],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { FileText, Download, CheckCircle, XCircle, Calendar, Loader2, Mail, MessageCircle, Send } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\n\ninterface VendorCommissionSummary {\n  vendor_id: string;\n  vendor_name: string;\n  vendor_phone: string;\n  pending_commissions: number;\n  commission_count: number;\n  commission_details: Array<{\n    id: string;\n    order_id: string;\n    commission_amount: number;\n    order_total: number;\n    created_at: string;\n  }>;\n}\n\ninterface Invoice {\n  id: string;\n  vendor_id: string;\n  vendor_name: string;\n  invoice_number: string;\n  period_start: string;\n  period_end: string;\n  total_amount: number;\n  status: string;\n  generated_at: string;\n}\n\nexport default function CommissionInvoiceGenerator() {\n  const [loading, setLoading] = useState(false);\n  const [vendorSummaries, setVendorSummaries] = useState<VendorCommissionSummary[]>([]);\n  const [recentInvoices, setRecentInvoices] = useState<Invoice[]>([]);\n  const [selectedInvoice, setSelectedInvoice] = useState<Invoice | null>(null);\n  const [generatingPeriod, setGeneratingPeriod] = useState(false);\n  const [sendingInvoice, setSendingInvoice] = useState<string | null>(null);\n  const [showEmailDialog, setShowEmailDialog] = useState(false);\n  const [vendorEmail, setVendorEmail] = useState(\"\");\n\n  useEffect(() => {\n    fetchData();\n  }, []);\n\n  const fetchData = async () => {\n    try {\n      setLoading(true);\n      await Promise.all([fetchPendingCommissions(), fetchRecentInvoices()]);\n    } catch (error) {\n      console.error('Error fetching data:', error);\n      toast.error('Error al cargar datos');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchPendingCommissions = async () => {\n    const { data: commissions, error } = await supabase\n      .from('vendor_commissions')\n      .select(`\n        id,\n        vendor_id,\n        commission_amount,\n        order_total,\n        order_id,\n        created_at,\n        vendors (name, phone)\n      `)\n      .eq('status', 'pending')\n      .order('vendor_id');\n\n    if (error) throw error;\n\n    // Group by vendor\n    const grouped = commissions?.reduce((acc: any, comm: any) => {\n      const vendorId = comm.vendor_id;\n      if (!acc[vendorId]) {\n        acc[vendorId] = {\n          vendor_id: vendorId,\n          vendor_name: comm.vendors?.name || 'Desconocido',\n          vendor_phone: comm.vendors?.phone || '',\n          pending_commissions: 0,\n          commission_count: 0,\n          commission_details: []\n        };\n      }\n      acc[vendorId].pending_commissions += parseFloat(comm.commission_amount || '0');\n      acc[vendorId].commission_count += 1;\n      acc[vendorId].commission_details.push({\n        id: comm.id,\n        order_id: comm.order_id,\n        commission_amount: parseFloat(comm.commission_amount || '0'),\n        order_total: parseFloat(comm.order_total || '0'),\n        created_at: comm.created_at\n      });\n      return acc;\n    }, {});\n\n    setVendorSummaries(Object.values(grouped || {}));\n  };\n\n  const fetchRecentInvoices = async () => {\n    const { data, error } = await (supabase as any)\n      .from('commission_invoices')\n      .select(`\n        id,\n        vendor_id,\n        invoice_number,\n        period_start,\n        period_end,\n        total_amount,\n        status,\n        generated_at,\n        vendors (name)\n      `)\n      .order('generated_at', { ascending: false })\n      .limit(20);\n\n    if (error) throw error;\n\n    const formatted = data?.map((inv: any) => ({\n      ...inv,\n      vendor_name: inv.vendors?.name || 'Desconocido'\n    })) || [];\n\n    setRecentInvoices(formatted);\n  };\n\n  const closeBiweeklyPeriod = async () => {\n    try {\n      setGeneratingPeriod(true);\n\n      // Calculate period dates (last 15 days)\n      const periodEnd = new Date();\n      const periodStart = new Date();\n      periodStart.setDate(periodStart.getDate() - 15);\n\n      // For each vendor with pending commissions\n      for (const vendor of vendorSummaries) {\n        // Generate invoice number\n        const { data: invoiceNumber, error: invoiceNumError } = await (supabase as any)\n          .rpc('generate_invoice_number');\n\n        if (invoiceNumError) throw invoiceNumError;\n\n        // Create invoice\n        const { data: invoice, error: invoiceError } = await (supabase as any)\n          .from('commission_invoices')\n          .insert({\n            vendor_id: vendor.vendor_id,\n            invoice_number: invoiceNumber,\n            period_start: periodStart.toISOString().split('T')[0],\n            period_end: periodEnd.toISOString().split('T')[0],\n            total_amount: vendor.pending_commissions,\n            status: 'pending'\n          })\n          .select()\n          .single();\n\n        if (invoiceError) throw invoiceError;\n\n        // Link commission items to invoice\n        const invoiceItems = vendor.commission_details.map((detail: any) => ({\n          invoice_id: invoice.id,\n          commission_id: detail.id\n        }));\n\n        const { error: itemsError } = await (supabase as any)\n          .from('commission_invoice_items')\n          .insert(invoiceItems);\n\n        if (itemsError) throw itemsError;\n\n        // Update commission status to 'invoiced'\n        const commissionIds = vendor.commission_details.map(d => d.id);\n        const { error: updateError } = await supabase\n          .from('vendor_commissions')\n          .update({ status: 'invoiced' })\n          .in('id', commissionIds);\n\n        if (updateError) throw updateError;\n      }\n\n      toast.success(`Se generaron ${vendorSummaries.length} facturas exitosamente`);\n      await fetchData();\n    } catch (error) {\n      console.error('Error closing period:', error);\n      toast.error('Error al cerrar per√≠odo quincenal');\n    } finally {\n      setGeneratingPeriod(false);\n    }\n  };\n\n  const markInvoiceAsPaid = async (invoiceId: string) => {\n    try {\n      const { error } = await (supabase as any)\n        .from('commission_invoices')\n        .update({ \n          status: 'paid',\n          paid_at: new Date().toISOString()\n        })\n        .eq('id', invoiceId);\n\n      if (error) throw error;\n\n      // Update related commissions to 'paid'\n      const { data: items } = await (supabase as any)\n        .from('commission_invoice_items')\n        .select('commission_id')\n        .eq('invoice_id', invoiceId);\n\n      if (items) {\n        const commissionIds = items.map((item: any) => item.commission_id);\n        await supabase\n          .from('vendor_commissions')\n          .update({ status: 'paid' })\n          .in('id', commissionIds);\n      }\n\n      toast.success('Factura marcada como pagada');\n      await fetchData();\n      setSelectedInvoice(null);\n    } catch (error) {\n      console.error('Error marking invoice as paid:', error);\n      toast.error('Error al marcar factura como pagada');\n    }\n  };\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat('es-AR', {\n      style: 'currency',\n      currency: 'ARS',\n      minimumFractionDigits: 0,\n      maximumFractionDigits: 0,\n    }).format(amount);\n  };\n\n  const downloadPDF = async (invoiceId: string, invoiceNumber: string) => {\n    try {\n      setSendingInvoice(invoiceId);\n      \n      // Make a direct fetch call to get the PDF as blob\n      const { data: { session } } = await supabase.auth.getSession();\n      const response = await fetch(\n        `https://ilhpiarkmwdjvrfqhyhi.supabase.co/functions/v1/generate-invoice-pdf`,\n        {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${session?.access_token}`,\n          },\n          body: JSON.stringify({ invoice_id: invoiceId })\n        }\n      );\n\n      if (!response.ok) throw new Error('Error al generar PDF');\n\n      // Get the PDF as blob\n      const blob = await response.blob();\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `Factura-${invoiceNumber}.pdf`;\n      document.body.appendChild(a);\n      a.click();\n      window.URL.revokeObjectURL(url);\n      document.body.removeChild(a);\n\n      toast.success('PDF descargado exitosamente');\n    } catch (error) {\n      console.error('Error downloading PDF:', error);\n      toast.error('Error al descargar el PDF');\n    } finally {\n      setSendingInvoice(null);\n    }\n  };\n\n  const sendByEmail = async (invoiceId: string) => {\n    if (!vendorEmail) {\n      toast.error('Por favor ingresa un email');\n      return;\n    }\n\n    try {\n      setSendingInvoice(invoiceId);\n      const { error } = await supabase.functions.invoke('send-invoice-email', {\n        body: { invoice_id: invoiceId, vendor_email: vendorEmail }\n      });\n\n      if (error) throw error;\n\n      toast.success('Factura enviada por email exitosamente');\n      setShowEmailDialog(false);\n      setVendorEmail('');\n    } catch (error) {\n      console.error('Error sending email:', error);\n      toast.error('Error al enviar el email');\n    } finally {\n      setSendingInvoice(null);\n    }\n  };\n\n  const sendByWhatsApp = async (invoiceId: string) => {\n    try {\n      setSendingInvoice(invoiceId);\n      const { error } = await supabase.functions.invoke('send-invoice-whatsapp', {\n        body: { invoice_id: invoiceId }\n      });\n\n      if (error) throw error;\n\n      toast.success('Factura enviada por WhatsApp exitosamente');\n    } catch (error) {\n      console.error('Error sending WhatsApp:', error);\n      toast.error('Error al enviar por WhatsApp');\n    } finally {\n      setSendingInvoice(null);\n    }\n  };\n\n  const sendByBoth = async (invoiceId: string) => {\n    if (!vendorEmail) {\n      toast.error('Por favor ingresa un email');\n      return;\n    }\n\n    try {\n      setSendingInvoice(invoiceId);\n      \n      // Send by email\n      const { error: emailError } = await supabase.functions.invoke('send-invoice-email', {\n        body: { invoice_id: invoiceId, vendor_email: vendorEmail }\n      });\n\n      if (emailError) throw emailError;\n\n      // Send by WhatsApp\n      const { error: whatsappError } = await supabase.functions.invoke('send-invoice-whatsapp', {\n        body: { invoice_id: invoiceId }\n      });\n\n      if (whatsappError) throw whatsappError;\n\n      toast.success('Factura enviada por email y WhatsApp');\n      setShowEmailDialog(false);\n      setVendorEmail('');\n    } catch (error) {\n      console.error('Error sending invoice:', error);\n      toast.error('Error al enviar la factura');\n    } finally {\n      setSendingInvoice(null);\n    }\n  };\n\n  const getStatusBadge = (status: string) => {\n    const variants: Record<string, { variant: \"default\" | \"secondary\" | \"destructive\" | \"outline\", label: string }> = {\n      pending: { variant: \"outline\", label: \"Pendiente\" },\n      paid: { variant: \"default\", label: \"Pagado\" },\n      cancelled: { variant: \"destructive\", label: \"Cancelado\" }\n    };\n    const config = variants[status] || variants.pending;\n    return <Badge variant={config.variant}>{config.label}</Badge>;\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Period Closing Section */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Calendar className=\"h-5 w-5\" />\n            Cerrar Per√≠odo Quincenal\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <Alert>\n            <AlertDescription>\n              Este proceso generar√° facturas autom√°ticamente para todos los vendors con comisiones pendientes,\n              correspondientes a los √∫ltimos 15 d√≠as.\n            </AlertDescription>\n          </Alert>\n          \n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"font-medium\">Vendors con comisiones pendientes: {vendorSummaries.length}</p>\n              <p className=\"text-sm text-muted-foreground\">\n                Total a facturar: {formatCurrency(vendorSummaries.reduce((sum, v) => sum + v.pending_commissions, 0))}\n              </p>\n            </div>\n            <Button\n              onClick={closeBiweeklyPeriod}\n              disabled={vendorSummaries.length === 0 || generatingPeriod}\n            >\n              {generatingPeriod ? (\n                <>\n                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                  Generando...\n                </>\n              ) : (\n                <>\n                  <FileText className=\"mr-2 h-4 w-4\" />\n                  Generar Facturas\n                </>\n              )}\n            </Button>\n          </div>\n\n          {vendorSummaries.length > 0 && (\n            <div className=\"border rounded-lg p-4 space-y-2\">\n              <p className=\"font-medium text-sm\">Vista previa:</p>\n              {vendorSummaries.slice(0, 5).map((vendor) => (\n                <div key={vendor.vendor_id} className=\"flex justify-between text-sm\">\n                  <span>{vendor.vendor_name}</span>\n                  <span className=\"font-medium\">{formatCurrency(vendor.pending_commissions)}</span>\n                </div>\n              ))}\n              {vendorSummaries.length > 5 && (\n                <p className=\"text-xs text-muted-foreground\">\n                  +{vendorSummaries.length - 5} vendors m√°s\n                </p>\n              )}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Recent Invoices */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Facturas Generadas</CardTitle>\n        </CardHeader>\n        <CardContent>\n          {recentInvoices.length === 0 ? (\n            <p className=\"text-center text-muted-foreground py-4\">\n              No hay facturas generadas a√∫n\n            </p>\n          ) : (\n            <div className=\"space-y-2\">\n              {recentInvoices.map((invoice) => (\n                <div\n                  key={invoice.id}\n                  className=\"flex items-center justify-between border rounded-lg p-4 hover:bg-accent/50 transition-colors\"\n                >\n                  <div className=\"flex-1\">\n                    <div className=\"font-medium\">{invoice.vendor_name}</div>\n                    <div className=\"text-sm text-muted-foreground\">\n                      {invoice.invoice_number} ‚Ä¢ {new Date(invoice.period_start).toLocaleDateString('es-AR')} - {new Date(invoice.period_end).toLocaleDateString('es-AR')}\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-4\">\n                    <div className=\"text-right\">\n                      <div className=\"font-semibold\">{formatCurrency(invoice.total_amount)}</div>\n                      <div className=\"text-xs text-muted-foreground\">\n                        {new Date(invoice.generated_at).toLocaleDateString('es-AR')}\n                      </div>\n                    </div>\n                    {getStatusBadge(invoice.status)}\n                    <div className=\"flex gap-2\">\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={() => downloadPDF(invoice.id, invoice.invoice_number)}\n                        disabled={sendingInvoice === invoice.id}\n                        title=\"Descargar PDF\"\n                      >\n                        {sendingInvoice === invoice.id ? (\n                          <Loader2 className=\"h-4 w-4 animate-spin\" />\n                        ) : (\n                          <Download className=\"h-4 w-4\" />\n                        )}\n                      </Button>\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={() => {\n                          setSelectedInvoice(invoice);\n                          setShowEmailDialog(true);\n                        }}\n                        disabled={sendingInvoice === invoice.id}\n                        title=\"Enviar por Email\"\n                      >\n                        <Mail className=\"h-4 w-4\" />\n                      </Button>\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={() => sendByWhatsApp(invoice.id)}\n                        disabled={sendingInvoice === invoice.id}\n                        title=\"Enviar por WhatsApp\"\n                      >\n                        <MessageCircle className=\"h-4 w-4\" />\n                      </Button>\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={() => setSelectedInvoice(invoice)}\n                      >\n                        <FileText className=\"h-4 w-4\" />\n                      </Button>\n                      {invoice.status === 'pending' && (\n                        <Button\n                          size=\"sm\"\n                          variant=\"default\"\n                          onClick={() => markInvoiceAsPaid(invoice.id)}\n                        >\n                          <CheckCircle className=\"h-4 w-4\" />\n                        </Button>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Email Dialog */}\n      <Dialog open={showEmailDialog} onOpenChange={setShowEmailDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Enviar Factura por Email</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div>\n              <Label htmlFor=\"email\">Email del Vendor</Label>\n              <Input\n                id=\"email\"\n                type=\"email\"\n                placeholder=\"vendor@ejemplo.com\"\n                value={vendorEmail}\n                onChange={(e) => setVendorEmail(e.target.value)}\n              />\n            </div>\n            <div className=\"flex gap-2\">\n              <Button\n                onClick={() => selectedInvoice && sendByEmail(selectedInvoice.id)}\n                disabled={!vendorEmail || !!sendingInvoice}\n                className=\"flex-1\"\n              >\n                {sendingInvoice ? (\n                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                ) : (\n                  <Mail className=\"mr-2 h-4 w-4\" />\n                )}\n                Solo Email\n              </Button>\n              <Button\n                onClick={() => selectedInvoice && sendByBoth(selectedInvoice.id)}\n                disabled={!vendorEmail || !!sendingInvoice}\n                variant=\"default\"\n                className=\"flex-1\"\n              >\n                {sendingInvoice ? (\n                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                ) : (\n                  <Send className=\"mr-2 h-4 w-4\" />\n                )}\n                Email + WhatsApp\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Invoice Details Dialog */}\n      <Dialog open={!!selectedInvoice && !showEmailDialog} onOpenChange={() => setSelectedInvoice(null)}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle>Detalle de Factura</DialogTitle>\n          </DialogHeader>\n          {selectedInvoice && (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">N√∫mero de Factura</p>\n                  <p className=\"font-medium\">{selectedInvoice.invoice_number}</p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Vendor</p>\n                  <p className=\"font-medium\">{selectedInvoice.vendor_name}</p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Per√≠odo</p>\n                  <p className=\"font-medium\">\n                    {new Date(selectedInvoice.period_start).toLocaleDateString('es-AR')} - {new Date(selectedInvoice.period_end).toLocaleDateString('es-AR')}\n                  </p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Total</p>\n                  <p className=\"font-medium text-lg\">{formatCurrency(selectedInvoice.total_amount)}</p>\n                </div>\n              </div>\n              <div className=\"flex gap-2\">\n                <Button className=\"flex-1\" variant=\"outline\">\n                  <Download className=\"mr-2 h-4 w-4\" />\n                  Descargar PDF\n                </Button>\n                {selectedInvoice.status === 'pending' && (\n                  <Button\n                    className=\"flex-1\"\n                    onClick={() => markInvoiceAsPaid(selectedInvoice.id)}\n                  >\n                    <CheckCircle className=\"mr-2 h-4 w-4\" />\n                    Marcar como Pagado\n                  </Button>\n                )}\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\admin\\CommissionManagement.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":115,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3554,3557],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3554,3557],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":221,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":221,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6931,6934],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6931,6934],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Edit, Save, Users, TrendingUp } from \"lucide-react\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Label } from \"@/components/ui/label\";\n\ninterface Vendor {\n  id: string;\n  name: string;\n}\n\ninterface CommissionSetting {\n  id: string;\n  vendor_id: string;\n  commission_type: string;\n  commission_percentage: number;\n  subscription_orders_included: number;\n  subscription_monthly_fee: number;\n  is_active: boolean;\n}\n\nexport default function CommissionManagement() {\n  const [vendors, setVendors] = useState<Vendor[]>([]);\n  const [commissions, setCommissions] = useState<CommissionSetting[]>([]);\n  const [editingVendor, setEditingVendor] = useState<string | null>(null);\n  const [selectedVendors, setSelectedVendors] = useState<string[]>([]);\n  const [bulkUpdateType, setBulkUpdateType] = useState<'set' | 'increase'>('increase');\n  const { toast } = useToast();\n\n  const [formData, setFormData] = useState({\n    vendor_id: \"\",\n    commission_type: \"percentage\",\n    commission_percentage: 10,\n    subscription_orders_included: 0,\n    subscription_monthly_fee: 0,\n  });\n\n  const [bulkFormData, setBulkFormData] = useState({\n    commission_percentage: 10,\n    increase_percentage: 20,\n    subscription_monthly_fee: 0,\n    increase_subscription_percentage: 20,\n  });\n\n  useEffect(() => {\n    fetchVendors();\n    fetchCommissions();\n  }, []);\n\n  const fetchVendors = async () => {\n    const { data } = await supabase\n      .from('vendors')\n      .select('id, name')\n      .eq('payment_status', 'active')\n      .order('name');\n    setVendors(data || []);\n  };\n\n  const fetchCommissions = async () => {\n    const { data } = await supabase\n      .from('commission_settings')\n      .select('*');\n    setCommissions(data || []);\n  };\n\n  const saveCommission = async () => {\n    try {\n      const existing = commissions.find(c => c.vendor_id === formData.vendor_id);\n\n      if (existing) {\n        const { error } = await supabase\n          .from('commission_settings')\n          .update({\n            commission_type: formData.commission_type,\n            commission_percentage: formData.commission_percentage,\n            subscription_orders_included: formData.subscription_orders_included,\n            subscription_monthly_fee: formData.subscription_monthly_fee,\n            updated_at: new Date().toISOString(),\n          })\n          .eq('id', existing.id);\n\n        if (error) throw error;\n      } else {\n        const { error } = await supabase\n          .from('commission_settings')\n          .insert({\n            vendor_id: formData.vendor_id,\n            commission_type: formData.commission_type,\n            commission_percentage: formData.commission_percentage,\n            subscription_orders_included: formData.subscription_orders_included,\n            subscription_monthly_fee: formData.subscription_monthly_fee,\n          });\n\n        if (error) throw error;\n      }\n\n      toast({\n        title: \"Comisi√≥n guardada\",\n        description: \"La configuraci√≥n de comisi√≥n ha sido actualizada\",\n      });\n\n      setEditingVendor(null);\n      fetchCommissions();\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const loadCommissionForVendor = (vendorId: string) => {\n    const commission = commissions.find(c => c.vendor_id === vendorId);\n    if (commission) {\n      setFormData({\n        vendor_id: vendorId,\n        commission_type: commission.commission_type,\n        commission_percentage: commission.commission_percentage,\n        subscription_orders_included: commission.subscription_orders_included,\n        subscription_monthly_fee: commission.subscription_monthly_fee,\n      });\n    } else {\n      setFormData({\n        vendor_id: vendorId,\n        commission_type: \"percentage\",\n        commission_percentage: 10,\n        subscription_orders_included: 0,\n        subscription_monthly_fee: 0,\n      });\n    }\n    setEditingVendor(vendorId);\n  };\n\n  const toggleVendorSelection = (vendorId: string) => {\n    setSelectedVendors(prev => \n      prev.includes(vendorId) \n        ? prev.filter(id => id !== vendorId)\n        : [...prev, vendorId]\n    );\n  };\n\n  const toggleSelectAll = () => {\n    if (selectedVendors.length === vendors.length) {\n      setSelectedVendors([]);\n    } else {\n      setSelectedVendors(vendors.map(v => v.id));\n    }\n  };\n\n  const applyBulkUpdate = async () => {\n    if (selectedVendors.length === 0) {\n      toast({\n        title: \"Error\",\n        description: \"Selecciona al menos un negocio\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    try {\n      const updates = await Promise.all(\n        selectedVendors.map(async (vendorId) => {\n          const existing = commissions.find(c => c.vendor_id === vendorId);\n          \n          let newCommissionPercentage = bulkFormData.commission_percentage;\n          let newSubscriptionFee = bulkFormData.subscription_monthly_fee;\n\n          if (bulkUpdateType === 'increase' && existing) {\n            // Incrementar porcentaje actual\n            newCommissionPercentage = existing.commission_percentage * (1 + bulkFormData.increase_percentage / 100);\n            newSubscriptionFee = existing.subscription_monthly_fee * (1 + bulkFormData.increase_subscription_percentage / 100);\n          }\n\n          if (existing) {\n            return supabase\n              .from('commission_settings')\n              .update({\n                commission_percentage: newCommissionPercentage,\n                subscription_monthly_fee: newSubscriptionFee,\n                updated_at: new Date().toISOString(),\n              })\n              .eq('id', existing.id);\n          } else {\n            return supabase\n              .from('commission_settings')\n              .insert({\n                vendor_id: vendorId,\n                commission_type: 'percentage',\n                commission_percentage: newCommissionPercentage,\n                subscription_orders_included: 0,\n                subscription_monthly_fee: newSubscriptionFee,\n              });\n          }\n        })\n      );\n\n      const errors = updates.filter(r => r.error);\n      if (errors.length > 0) {\n        throw new Error('Error al actualizar algunos negocios');\n      }\n\n      toast({\n        title: \"Actualizaci√≥n masiva exitosa\",\n        description: `Se actualizaron ${selectedVendors.length} negocios`,\n      });\n\n      setSelectedVendors([]);\n      fetchCommissions();\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <h2 className=\"text-3xl font-bold\">Gesti√≥n de Comisiones</h2>\n\n      {/* Bulk Update Section */}\n      <Card className=\"border-primary/20 bg-gradient-to-br from-primary/5 to-background\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Users className=\"h-5 w-5\" />\n            Actualizaci√≥n Masiva\n            <span className=\"text-sm font-normal text-muted-foreground ml-2\">\n              ({selectedVendors.length} seleccionados)\n            </span>\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"flex items-center gap-4 pb-4 border-b\">\n            <Checkbox\n              id=\"select-all\"\n              checked={selectedVendors.length === vendors.length && vendors.length > 0}\n              onCheckedChange={toggleSelectAll}\n            />\n            <Label htmlFor=\"select-all\" className=\"cursor-pointer font-medium\">\n              Seleccionar todos los negocios\n            </Label>\n          </div>\n\n          <div className=\"grid gap-4 md:grid-cols-2\">\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Tipo de Actualizaci√≥n</label>\n              <Select value={bulkUpdateType} onValueChange={(v: 'set' | 'increase') => setBulkUpdateType(v)}>\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"increase\">\n                    <div className=\"flex items-center gap-2\">\n                      <TrendingUp className=\"h-4 w-4\" />\n                      Incrementar % (Ajuste por Inflaci√≥n)\n                    </div>\n                  </SelectItem>\n                  <SelectItem value=\"set\">Establecer Valor Fijo</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            {bulkUpdateType === 'increase' ? (\n              <>\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-medium\">Incremento de Comisi√≥n (%)</label>\n                  <Input\n                    type=\"number\"\n                    min=\"0\"\n                    placeholder=\"Ej: 20 para subir 20%\"\n                    value={bulkFormData.increase_percentage}\n                    onChange={(e) => setBulkFormData({ ...bulkFormData, increase_percentage: parseFloat(e.target.value) || 0 })}\n                  />\n                  <p className=\"text-xs text-muted-foreground\">\n                    Ej: Si comisi√≥n es 10% y pones 20%, quedar√° en 12%\n                  </p>\n                </div>\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-medium\">Incremento de Suscripci√≥n (%)</label>\n                  <Input\n                    type=\"number\"\n                    min=\"0\"\n                    placeholder=\"Ej: 20 para subir 20%\"\n                    value={bulkFormData.increase_subscription_percentage}\n                    onChange={(e) => setBulkFormData({ ...bulkFormData, increase_subscription_percentage: parseFloat(e.target.value) || 0 })}\n                  />\n                </div>\n              </>\n            ) : (\n              <>\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-medium\">Nuevo Porcentaje de Comisi√≥n (%)</label>\n                  <Input\n                    type=\"number\"\n                    min=\"0\"\n                    max=\"100\"\n                    value={bulkFormData.commission_percentage}\n                    onChange={(e) => setBulkFormData({ ...bulkFormData, commission_percentage: parseFloat(e.target.value) || 0 })}\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-medium\">Nueva Cuota Mensual ($)</label>\n                  <Input\n                    type=\"number\"\n                    min=\"0\"\n                    value={bulkFormData.subscription_monthly_fee}\n                    onChange={(e) => setBulkFormData({ ...bulkFormData, subscription_monthly_fee: parseFloat(e.target.value) || 0 })}\n                  />\n                </div>\n              </>\n            )}\n          </div>\n\n          <Button \n            onClick={applyBulkUpdate} \n            disabled={selectedVendors.length === 0}\n            className=\"w-full\"\n            size=\"lg\"\n          >\n            <TrendingUp className=\"mr-2 h-4 w-4\" />\n            Aplicar a {selectedVendors.length} negocio{selectedVendors.length !== 1 ? 's' : ''}\n          </Button>\n        </CardContent>\n      </Card>\n\n      <div className=\"grid gap-4 md:grid-cols-2\">\n        {vendors.map((vendor) => {\n          const commission = commissions.find(c => c.vendor_id === vendor.id);\n          const isEditing = editingVendor === vendor.id;\n\n          return (\n            <Card key={vendor.id} className={selectedVendors.includes(vendor.id) ? 'border-primary' : ''}>\n              <CardHeader>\n                <div className=\"flex justify-between items-center\">\n                  <div className=\"flex items-center gap-3\">\n                    <Checkbox\n                      checked={selectedVendors.includes(vendor.id)}\n                      onCheckedChange={() => toggleVendorSelection(vendor.id)}\n                    />\n                    <CardTitle className=\"text-lg\">{vendor.name}</CardTitle>\n                  </div>\n                  {!isEditing && (\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => loadCommissionForVendor(vendor.id)}\n                    >\n                      <Edit className=\"h-4 w-4\" />\n                    </Button>\n                  )}\n                </div>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                {isEditing ? (\n                  <>\n                    <div className=\"space-y-2\">\n                      <label className=\"text-sm font-medium\">Tipo de Comisi√≥n</label>\n                      <Select\n                        value={formData.commission_type}\n                        onValueChange={(value) => setFormData({ ...formData, commission_type: value })}\n                      >\n                        <SelectTrigger>\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"percentage\">Porcentaje por Pedido</SelectItem>\n                          <SelectItem value=\"subscription\">Suscripci√≥n Mensual</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n\n                    <div className=\"space-y-2\">\n                      <label className=\"text-sm font-medium\">Porcentaje (%)</label>\n                      <Input\n                        type=\"number\"\n                        min=\"0\"\n                        max=\"100\"\n                        value={formData.commission_percentage}\n                        onChange={(e) => setFormData({ ...formData, commission_percentage: parseFloat(e.target.value) })}\n                      />\n                    </div>\n\n                    {formData.commission_type === 'subscription' && (\n                      <>\n                        <div className=\"space-y-2\">\n                          <label className=\"text-sm font-medium\">Pedidos Incluidos</label>\n                          <Input\n                            type=\"number\"\n                            min=\"0\"\n                            value={formData.subscription_orders_included}\n                            onChange={(e) => setFormData({ ...formData, subscription_orders_included: parseInt(e.target.value) })}\n                          />\n                        </div>\n                        <div className=\"space-y-2\">\n                          <label className=\"text-sm font-medium\">Cuota Mensual ($)</label>\n                          <Input\n                            type=\"number\"\n                            min=\"0\"\n                            value={formData.subscription_monthly_fee}\n                            onChange={(e) => setFormData({ ...formData, subscription_monthly_fee: parseFloat(e.target.value) })}\n                          />\n                        </div>\n                      </>\n                    )}\n\n                    <div className=\"flex gap-2\">\n                      <Button onClick={saveCommission} className=\"flex-1\">\n                        <Save className=\"mr-2 h-4 w-4\" />\n                        Guardar\n                      </Button>\n                      <Button variant=\"outline\" onClick={() => setEditingVendor(null)}>\n                        Cancelar\n                      </Button>\n                    </div>\n                  </>\n                ) : (\n                  <>\n                    {commission ? (\n                      <>\n                        <p className=\"text-sm\">\n                          <span className=\"font-medium\">Tipo:</span>{\" \"}\n                          {commission.commission_type === 'percentage' ? 'Porcentaje' : 'Suscripci√≥n'}\n                        </p>\n                        <p className=\"text-sm\">\n                          <span className=\"font-medium\">Comisi√≥n:</span> {commission.commission_percentage}%\n                        </p>\n                        {commission.commission_type === 'subscription' && (\n                          <>\n                            <p className=\"text-sm\">\n                              <span className=\"font-medium\">Pedidos incluidos:</span>{\" \"}\n                              {commission.subscription_orders_included}\n                            </p>\n                            <p className=\"text-sm\">\n                              <span className=\"font-medium\">Cuota mensual:</span> ${commission.subscription_monthly_fee}\n                            </p>\n                          </>\n                        )}\n                      </>\n                    ) : (\n                      <p className=\"text-sm text-muted-foreground\">Sin configuraci√≥n de comisi√≥n</p>\n                    )}\n                  </>\n                )}\n              </CardContent>\n            </Card>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\admin\\CommissionReports.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1089,1092],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1089,1092],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1449,1452],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1449,1452],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchCommissions'. Either include it or remove the dependency array.","line":60,"column":6,"nodeType":"ArrayExpression","endLine":60,"endColumn":38,"suggestions":[{"desc":"Update the dependencies array to be: [selectedVendor, selectedPeriod, fetchCommissions]","fix":{"range":[1708,1740],"text":"[selectedVendor, selectedPeriod, fetchCommissions]"}}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { DollarSign, TrendingUp, Calendar, FileText, Printer, Eye } from \"lucide-react\";\nimport { format, startOfMonth, endOfMonth, startOfDay, endOfDay } from \"date-fns\";\nimport { es } from \"date-fns/locale\";\n\ninterface Commission {\n  id: string;\n  vendor_id: string;\n  order_id: string;\n  commission_amount: number;\n  commission_type: string;\n  commission_percentage: number;\n  order_total: number;\n  status: string;\n  created_at: string;\n  paid_at: string | null;\n  vendors: {\n    name: string;\n    phone: string;\n    address: string;\n  };\n  orders: {\n    customer_name: string;\n    items: any;\n  };\n}\n\nexport default function CommissionReports() {\n  const [commissions, setCommissions] = useState<Commission[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [selectedVendor, setSelectedVendor] = useState<string>(\"all\");\n  const [selectedPeriod, setSelectedPeriod] = useState<string>(\"month\");\n  const [vendors, setVendors] = useState<any[]>([]);\n  const [selectedCommission, setSelectedCommission] = useState<Commission | null>(null);\n  const [showReceipt, setShowReceipt] = useState(false);\n\n  useEffect(() => {\n    fetchVendors();\n  }, []);\n\n  useEffect(() => {\n    fetchCommissions();\n  }, [selectedVendor, selectedPeriod]);\n\n  const fetchVendors = async () => {\n    const { data } = await supabase\n      .from('vendors')\n      .select('id, name')\n      .order('name');\n    setVendors(data || []);\n  };\n\n  const fetchCommissions = async () => {\n    setLoading(true);\n    try {\n      let query = supabase\n        .from('vendor_commissions')\n        .select(`\n          *,\n          vendors:vendor_id (name, phone, address),\n          orders:order_id (customer_name, items)\n        `)\n        .order('created_at', { ascending: false });\n\n      if (selectedVendor !== \"all\") {\n        query = query.eq('vendor_id', selectedVendor);\n      }\n\n      if (selectedPeriod === \"today\") {\n        const today = new Date();\n        query = query\n          .gte('created_at', startOfDay(today).toISOString())\n          .lte('created_at', endOfDay(today).toISOString());\n      } else if (selectedPeriod === \"month\") {\n        const today = new Date();\n        query = query\n          .gte('created_at', startOfMonth(today).toISOString())\n          .lte('created_at', endOfMonth(today).toISOString());\n      }\n\n      const { data, error } = await query;\n\n      if (error) throw error;\n      setCommissions(data || []);\n    } catch (error) {\n      console.error('Error fetching commissions:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const totalCommissions = commissions.reduce((sum, c) => sum + parseFloat(c.commission_amount.toString()), 0);\n  const pendingCommissions = commissions.filter(c => c.status === 'pending').reduce((sum, c) => sum + parseFloat(c.commission_amount.toString()), 0);\n  const paidCommissions = commissions.filter(c => c.status === 'paid').reduce((sum, c) => sum + parseFloat(c.commission_amount.toString()), 0);\n\n  const markAsPaid = async (commissionId: string) => {\n    const { error } = await supabase\n      .from('vendor_commissions')\n      .update({ \n        status: 'paid',\n        paid_at: new Date().toISOString()\n      })\n      .eq('id', commissionId);\n\n    if (!error) {\n      fetchCommissions();\n    }\n  };\n\n  const printReceipt = () => {\n    window.print();\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <h2 className=\"text-3xl font-bold\">Reportes de Comisiones</h2>\n        <div className=\"flex gap-4\">\n          <Select value={selectedPeriod} onValueChange={setSelectedPeriod}>\n            <SelectTrigger className=\"w-40\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"today\">Hoy</SelectItem>\n              <SelectItem value=\"month\">Este Mes</SelectItem>\n              <SelectItem value=\"all\">Todo</SelectItem>\n            </SelectContent>\n          </Select>\n          <Select value={selectedVendor} onValueChange={setSelectedVendor}>\n            <SelectTrigger className=\"w-48\">\n              <SelectValue placeholder=\"Todos los negocios\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">Todos los negocios</SelectItem>\n              {vendors.map((vendor) => (\n                <SelectItem key={vendor.id} value={vendor.id}>\n                  {vendor.name}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-3\">\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Comisiones</CardTitle>\n            <DollarSign className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">${totalCommissions.toFixed(2)}</div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Pendientes</CardTitle>\n            <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">${pendingCommissions.toFixed(2)}</div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Pagadas</CardTitle>\n            <TrendingUp className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">${paidCommissions.toFixed(2)}</div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Detalle de Comisiones</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-4\">\n            {commissions.map((commission) => (\n              <div key={commission.id} className=\"flex items-center justify-between p-4 border rounded-lg\">\n                <div className=\"flex-1\">\n                  <p className=\"font-medium\">{commission.vendors?.name}</p>\n                  <p className=\"text-sm text-muted-foreground\">\n                    {format(new Date(commission.created_at), \"d 'de' MMMM, yyyy\", { locale: es })}\n                  </p>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Pedido: ${commission.order_total.toFixed(2)} | Comisi√≥n: {commission.commission_percentage}%\n                  </p>\n                  <p className=\"text-xs text-muted-foreground\">\n                    Tipo: {commission.commission_type === 'percentage' ? 'Porcentaje' : commission.commission_type === 'subscription_overage' ? 'Suscripci√≥n (Extra)' : 'Suscripci√≥n'}\n                  </p>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"text-right\">\n                    <p className=\"text-lg font-bold\">${commission.commission_amount.toFixed(2)}</p>\n                    <Badge variant={commission.status === 'paid' ? 'default' : 'secondary'}>\n                      {commission.status === 'paid' ? 'Pagada' : 'Pendiente'}\n                    </Badge>\n                  </div>\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => {\n                      setSelectedCommission(commission);\n                      setShowReceipt(true);\n                    }}\n                  >\n                    <Eye className=\"h-4 w-4\" />\n                  </Button>\n                  {commission.status === 'pending' && (\n                    <Button\n                      size=\"sm\"\n                      onClick={() => markAsPaid(commission.id)}\n                    >\n                      Marcar como Pagada\n                    </Button>\n                  )}\n                </div>\n              </div>\n            ))}\n          </div>\n        </CardContent>\n      </Card>\n\n      <Dialog open={showReceipt} onOpenChange={setShowReceipt}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center justify-between\">\n              <span>Comprobante de Comisi√≥n</span>\n              <Button size=\"sm\" onClick={printReceipt}>\n                <Printer className=\"h-4 w-4 mr-2\" />\n                Imprimir\n              </Button>\n            </DialogTitle>\n          </DialogHeader>\n          \n          {selectedCommission && (\n            <div className=\"space-y-6 print:p-8\" id=\"receipt\">\n              {/* Header */}\n              <div className=\"text-center border-b pb-4\">\n                <h2 className=\"text-2xl font-bold\">Comprobante de Comisi√≥n</h2>\n                <p className=\"text-sm text-muted-foreground\">Tu Pedido - Sistema de Gesti√≥n</p>\n              </div>\n\n              {/* Receipt Info */}\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <p className=\"text-sm font-medium text-muted-foreground\">Comprobante #</p>\n                  <p className=\"font-mono\">{selectedCommission.id.slice(0, 8).toUpperCase()}</p>\n                </div>\n                <div>\n                  <p className=\"text-sm font-medium text-muted-foreground\">Fecha</p>\n                  <p>{format(new Date(selectedCommission.created_at), \"d 'de' MMMM, yyyy\", { locale: es })}</p>\n                </div>\n                <div>\n                  <p className=\"text-sm font-medium text-muted-foreground\">Estado</p>\n                  <Badge variant={selectedCommission.status === 'paid' ? 'default' : 'secondary'}>\n                    {selectedCommission.status === 'paid' ? 'Pagada' : 'Pendiente'}\n                  </Badge>\n                </div>\n                {selectedCommission.paid_at && (\n                  <div>\n                    <p className=\"text-sm font-medium text-muted-foreground\">Fecha de Pago</p>\n                    <p>{format(new Date(selectedCommission.paid_at), \"d 'de' MMMM, yyyy\", { locale: es })}</p>\n                  </div>\n                )}\n              </div>\n\n              {/* Vendor Info */}\n              <div className=\"border rounded-lg p-4\">\n                <h3 className=\"font-semibold mb-2\">Informaci√≥n del Negocio</h3>\n                <div className=\"space-y-1 text-sm\">\n                  <p><span className=\"font-medium\">Nombre:</span> {selectedCommission.vendors?.name}</p>\n                  <p><span className=\"font-medium\">Tel√©fono:</span> {selectedCommission.vendors?.phone}</p>\n                  <p><span className=\"font-medium\">Direcci√≥n:</span> {selectedCommission.vendors?.address}</p>\n                </div>\n              </div>\n\n              {/* Commission Details */}\n              <div className=\"border rounded-lg p-4\">\n                <h3 className=\"font-semibold mb-2\">Detalle de la Comisi√≥n</h3>\n                <div className=\"space-y-2\">\n                  <div className=\"flex justify-between text-sm\">\n                    <span>Total del Pedido:</span>\n                    <span>${selectedCommission.order_total.toFixed(2)}</span>\n                  </div>\n                  <div className=\"flex justify-between text-sm\">\n                    <span>Tipo de Comisi√≥n:</span>\n                    <span>\n                      {selectedCommission.commission_type === 'percentage' \n                        ? 'Porcentaje por Pedido' \n                        : selectedCommission.commission_type === 'subscription_overage'\n                        ? 'Suscripci√≥n (Pedido Extra)'\n                        : 'Suscripci√≥n'}\n                    </span>\n                  </div>\n                  <div className=\"flex justify-between text-sm\">\n                    <span>Porcentaje de Comisi√≥n:</span>\n                    <span>{selectedCommission.commission_percentage}%</span>\n                  </div>\n                  <div className=\"flex justify-between text-lg font-bold pt-2 border-t\">\n                    <span>Total a Pagar:</span>\n                    <span>${selectedCommission.commission_amount.toFixed(2)}</span>\n                  </div>\n                </div>\n              </div>\n\n              {/* Order Info */}\n              {selectedCommission.orders && (\n                <div className=\"border rounded-lg p-4\">\n                  <h3 className=\"font-semibold mb-2\">Informaci√≥n del Pedido</h3>\n                  <div className=\"space-y-1 text-sm\">\n                    <p><span className=\"font-medium\">ID del Pedido:</span> {selectedCommission.order_id.slice(0, 8).toUpperCase()}</p>\n                    <p><span className=\"font-medium\">Cliente:</span> {selectedCommission.orders.customer_name}</p>\n                  </div>\n                </div>\n              )}\n\n              {/* Footer */}\n              <div className=\"text-center text-xs text-muted-foreground pt-4 border-t\">\n                <p>Este comprobante es v√°lido para efectos de registro de comisi√≥n</p>\n                <p className=\"mt-1\">Generado el {format(new Date(), \"d 'de' MMMM, yyyy 'a las' HH:mm\", { locale: es })}</p>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      <style>{`\n        @media print {\n          body * {\n            visibility: hidden;\n          }\n          #receipt, #receipt * {\n            visibility: visible;\n          }\n          #receipt {\n            position: absolute;\n            left: 0;\n            top: 0;\n            width: 100%;\n          }\n        }\n      `}</style>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\admin\\EmergencyControl.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":226,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":226,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6373,6376],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6373,6376],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Switch } from '@/components/ui/switch';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Input } from '@/components/ui/input';\nimport { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group';\nimport { Badge } from '@/components/ui/badge';\nimport { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';\nimport { Separator } from '@/components/ui/separator';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { toast } from 'sonner';\nimport { \n  AlertTriangle, \n  Bot, \n  Power, \n  RefreshCw, \n  Shield, \n  Users, \n  MessageSquare, \n  Clock,\n  CheckCircle2,\n  XCircle,\n  Loader2,\n  WifiOff,\n  Store,\n  HeadphonesIcon,\n  Bell,\n  Mail,\n  Phone,\n  Send,\n  Plus,\n  Trash2\n} from 'lucide-react';\nimport { format } from 'date-fns';\nimport { es } from 'date-fns/locale';\n\ninterface PlatformSettings {\n  id: string;\n  bot_enabled: boolean;\n  emergency_mode: boolean;\n  emergency_message: string;\n  fallback_mode: 'vendor_direct' | 'support_queue' | 'menu_basico' | 'offline';\n  last_error: string | null;\n  error_count: number;\n  last_error_at: string | null;\n  auto_emergency_threshold: number;\n  created_at: string;\n  updated_at: string;\n}\n\ninterface ErrorLog {\n  id: string;\n  error_type: string;\n  error_message: string;\n  error_details: Record<string, unknown> | null;\n  customer_phone: string | null;\n  vendor_id: string | null;\n  resolved: boolean;\n  created_at: string;\n}\n\ninterface EmergencyContact {\n  id: string;\n  user_id: string;\n  email: string;\n  phone: string | null;\n  notify_email: boolean;\n  notify_whatsapp: boolean;\n}\n\nexport default function EmergencyControl() {\n  const [settings, setSettings] = useState<PlatformSettings | null>(null);\n  const [errorLogs, setErrorLogs] = useState<ErrorLog[]>([]);\n  const [emergencyContacts, setEmergencyContacts] = useState<EmergencyContact[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [saving, setSaving] = useState(false);\n  const [emergencyMessage, setEmergencyMessage] = useState('');\n  const [newContactPhone, setNewContactPhone] = useState('');\n  const [sendingTest, setSendingTest] = useState(false);\n\n  useEffect(() => {\n    fetchSettings();\n    fetchErrorLogs();\n    fetchEmergencyContacts();\n\n    // Subscribe to real-time changes\n    const settingsChannel = supabase\n      .channel('platform_settings_changes')\n      .on('postgres_changes', { \n        event: '*', \n        schema: 'public', \n        table: 'platform_settings' \n      }, () => {\n        fetchSettings();\n      })\n      .subscribe();\n\n    const errorLogsChannel = supabase\n      .channel('error_logs_changes')\n      .on('postgres_changes', { \n        event: 'INSERT', \n        schema: 'public', \n        table: 'bot_error_logs' \n      }, () => {\n        fetchErrorLogs();\n      })\n      .subscribe();\n\n    const contactsChannel = supabase\n      .channel('emergency_contacts_changes')\n      .on('postgres_changes', { \n        event: '*', \n        schema: 'public', \n        table: 'admin_emergency_contacts' \n      }, () => {\n        fetchEmergencyContacts();\n      })\n      .subscribe();\n\n    return () => {\n      supabase.removeChannel(settingsChannel);\n      supabase.removeChannel(errorLogsChannel);\n      supabase.removeChannel(contactsChannel);\n    };\n  }, []);\n\n  const fetchSettings = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('platform_settings')\n        .select('*')\n        .eq('id', 'global')\n        .single();\n\n      if (error) throw error;\n      \n      setSettings(data as PlatformSettings);\n      setEmergencyMessage(data?.emergency_message || '');\n    } catch (error) {\n      console.error('Error fetching settings:', error);\n      toast.error('Error al cargar configuraci√≥n');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchErrorLogs = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('bot_error_logs')\n        .select('*')\n        .order('created_at', { ascending: false })\n        .limit(50);\n\n      if (error) throw error;\n      setErrorLogs((data || []) as ErrorLog[]);\n    } catch (error) {\n      console.error('Error fetching error logs:', error);\n    }\n  };\n\n  const fetchEmergencyContacts = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('admin_emergency_contacts')\n        .select('*')\n        .order('created_at', { ascending: true });\n\n      if (error) throw error;\n      setEmergencyContacts((data || []) as EmergencyContact[]);\n    } catch (error) {\n      console.error('Error fetching emergency contacts:', error);\n    }\n  };\n\n  const updateEmergencyContact = async (contactId: string, updates: Partial<EmergencyContact>) => {\n    try {\n      const { error } = await supabase\n        .from('admin_emergency_contacts')\n        .update(updates)\n        .eq('id', contactId);\n\n      if (error) throw error;\n      toast.success('Contacto actualizado');\n      await fetchEmergencyContacts();\n    } catch (error) {\n      console.error('Error updating contact:', error);\n      toast.error('Error al actualizar contacto');\n    }\n  };\n\n  const addPhoneToContact = async (contactId: string) => {\n    if (!newContactPhone.trim()) {\n      toast.error('Ingresa un n√∫mero de tel√©fono');\n      return;\n    }\n\n    // Format phone number\n    let phone = newContactPhone.trim();\n    if (!phone.startsWith('+')) {\n      phone = '+54' + phone.replace(/^0/, '');\n    }\n\n    await updateEmergencyContact(contactId, { phone });\n    setNewContactPhone('');\n  };\n\n  const sendTestNotification = async () => {\n    setSendingTest(true);\n    try {\n      const { data, error } = await supabase.functions.invoke('notify-admin-emergency', {\n        body: {\n          error_type: 'TEST_NOTIFICATION',\n          error_message: 'Esta es una notificaci√≥n de prueba del sistema de alertas de emergencia.',\n          error_count: 0,\n          threshold: 3,\n        },\n      });\n\n      if (error) throw error;\n\n      toast.success(`Notificaci√≥n de prueba enviada: ${data.emails_sent} emails, ${data.whatsapps_sent} WhatsApps`);\n    } catch (error: any) {\n      console.error('Error sending test notification:', error);\n      toast.error('Error al enviar notificaci√≥n de prueba');\n    } finally {\n      setSendingTest(false);\n    }\n  };\n\n  const updateSettings = async (updates: Partial<PlatformSettings>) => {\n    setSaving(true);\n    try {\n      const { error } = await supabase\n        .from('platform_settings')\n        .update(updates)\n        .eq('id', 'global');\n\n      if (error) throw error;\n      \n      toast.success('Configuraci√≥n actualizada');\n      await fetchSettings();\n    } catch (error) {\n      console.error('Error updating settings:', error);\n      toast.error('Error al actualizar configuraci√≥n');\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const toggleBotEnabled = () => {\n    if (!settings) return;\n    updateSettings({ bot_enabled: !settings.bot_enabled });\n  };\n\n  const toggleEmergencyMode = async () => {\n    if (!settings) return;\n    \n    const newEmergencyMode = !settings.emergency_mode;\n    \n    // Si estamos DESACTIVANDO el modo emergencia, cerrar tickets de emergencia autom√°ticamente\n    if (!newEmergencyMode) {\n      try {\n        const { error, count } = await supabase\n          .from('support_tickets')\n          .update({\n            status: 'resolved',\n            resolved_at: new Date().toISOString()\n          })\n          .in('status', ['open', 'in_progress'])\n          .ilike('subject', '%[EMERGENCIA]%');\n        \n        if (!error && count && count > 0) {\n          toast.info(`Se cerraron ${count} ticket(s) de emergencia autom√°ticamente`);\n        }\n      } catch (err) {\n        console.error('Error closing emergency tickets:', err);\n      }\n    }\n    \n    await updateSettings({ \n      emergency_mode: newEmergencyMode,\n      // Reset error count when manually toggling\n      error_count: newEmergencyMode ? settings.error_count : 0\n    });\n  };\n\n  const updateFallbackMode = (mode: 'vendor_direct' | 'support_queue' | 'menu_basico' | 'offline') => {\n    updateSettings({ fallback_mode: mode });\n  };\n\n  const saveEmergencyMessage = () => {\n    updateSettings({ emergency_message: emergencyMessage });\n  };\n\n  const resetErrorCounters = async () => {\n    await updateSettings({ \n      error_count: 0, \n      last_error: null, \n      last_error_at: null \n    });\n    toast.success('Contadores reseteados');\n  };\n\n  const markErrorResolved = async (errorId: string) => {\n    try {\n      const { error } = await supabase\n        .from('bot_error_logs')\n        .update({ resolved: true })\n        .eq('id', errorId);\n\n      if (error) throw error;\n      \n      toast.success('Error marcado como resuelto');\n      fetchErrorLogs();\n    } catch (error) {\n      console.error('Error marking resolved:', error);\n      toast.error('Error al actualizar');\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center p-8\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n      </div>\n    );\n  }\n\n  const unresolvedErrors = errorLogs.filter(e => !e.resolved);\n  const last24hErrors = errorLogs.filter(e => {\n    const errorDate = new Date(e.created_at);\n    const now = new Date();\n    return (now.getTime() - errorDate.getTime()) < 24 * 60 * 60 * 1000;\n  });\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Emergency Alert Banner */}\n      {settings?.emergency_mode && (\n        <Alert variant=\"destructive\" className=\"border-2\">\n          <AlertTriangle className=\"h-5 w-5\" />\n          <AlertTitle className=\"text-lg font-bold\">\n            ‚ö†Ô∏è MODO EMERGENCIA ACTIVO\n          </AlertTitle>\n          <AlertDescription>\n            El bot est√° en modo de contingencia. Los mensajes se est√°n manejando seg√∫n el modo de fallback configurado.\n          </AlertDescription>\n        </Alert>\n      )}\n\n      {/* Main Status Cards */}\n      <div className=\"grid gap-4 md:grid-cols-2\">\n        {/* Bot Status Card */}\n        <Card className={settings?.bot_enabled ? 'border-green-500/50' : 'border-red-500/50'}>\n          <CardHeader className=\"pb-2\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-2\">\n                <Bot className=\"h-5 w-5\" />\n                <CardTitle>Estado del Bot</CardTitle>\n              </div>\n              <Badge variant={settings?.bot_enabled ? 'default' : 'destructive'}>\n                {settings?.bot_enabled ? (\n                  <><CheckCircle2 className=\"h-3 w-3 mr-1\" /> Activo</>\n                ) : (\n                  <><XCircle className=\"h-3 w-3 mr-1\" /> Desactivado</>\n                )}\n              </Badge>\n            </div>\n            <CardDescription>\n              Controla si el bot de IA responde a los mensajes de WhatsApp\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center space-x-2\">\n                <Switch\n                  id=\"bot-enabled\"\n                  checked={settings?.bot_enabled}\n                  onCheckedChange={toggleBotEnabled}\n                  disabled={saving}\n                />\n                <Label htmlFor=\"bot-enabled\">\n                  {settings?.bot_enabled ? 'Bot habilitado' : 'Bot deshabilitado'}\n                </Label>\n              </div>\n              <Power className={`h-6 w-6 ${settings?.bot_enabled ? 'text-green-500' : 'text-red-500'}`} />\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Emergency Mode Card */}\n        <Card className={settings?.emergency_mode ? 'border-orange-500/50 bg-orange-50/50 dark:bg-orange-950/20' : ''}>\n          <CardHeader className=\"pb-2\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-2\">\n                <Shield className=\"h-5 w-5\" />\n                <CardTitle>Modo Emergencia</CardTitle>\n              </div>\n              <Badge variant={settings?.emergency_mode ? 'destructive' : 'outline'}>\n                {settings?.emergency_mode ? (\n                  <><AlertTriangle className=\"h-3 w-3 mr-1\" /> ACTIVO</>\n                ) : (\n                  'Normal'\n                )}\n              </Badge>\n            </div>\n            <CardDescription>\n              Activa el modo de contingencia cuando hay problemas con la IA\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center space-x-2\">\n                <Switch\n                  id=\"emergency-mode\"\n                  checked={settings?.emergency_mode}\n                  onCheckedChange={toggleEmergencyMode}\n                  disabled={saving}\n                />\n                <Label htmlFor=\"emergency-mode\">\n                  {settings?.emergency_mode ? 'Emergencia activa' : 'Modo normal'}\n                </Label>\n              </div>\n              <AlertTriangle className={`h-6 w-6 ${settings?.emergency_mode ? 'text-orange-500' : 'text-muted-foreground'}`} />\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Fallback Mode Configuration */}\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center gap-2\">\n            <Users className=\"h-5 w-5\" />\n            <CardTitle>Modo de Fallback</CardTitle>\n          </div>\n          <CardDescription>\n            Cuando el bot est√° desactivado o en emergencia, ¬øc√≥mo se manejan los mensajes?\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <RadioGroup\n            value={settings?.fallback_mode}\n            onValueChange={(value) => updateFallbackMode(value as 'vendor_direct' | 'support_queue' | 'menu_basico' | 'offline')}\n            className=\"space-y-4\"\n          >\n            <div className=\"flex items-start space-x-3 p-4 rounded-lg border hover:bg-accent/50 transition-colors\">\n              <RadioGroupItem value=\"menu_basico\" id=\"menu_basico\" />\n              <div className=\"flex-1\">\n                <Label htmlFor=\"menu_basico\" className=\"flex items-center gap-2 font-medium cursor-pointer\">\n                  <Store className=\"h-4 w-4 text-primary\" />\n                  Men√∫ B√°sico\n                  <Badge variant=\"secondary\" className=\"ml-2 text-xs\">Recomendado</Badge>\n                </Label>\n                <p className=\"text-sm text-muted-foreground mt-1\">\n                  Env√≠a una lista de negocios abiertos con sus n√∫meros de WhatsApp para que el cliente contacte directamente.\n                </p>\n              </div>\n            </div>\n\n            <div className=\"flex items-start space-x-3 p-4 rounded-lg border hover:bg-accent/50 transition-colors\">\n              <RadioGroupItem value=\"vendor_direct\" id=\"vendor_direct\" />\n              <div className=\"flex-1\">\n                <Label htmlFor=\"vendor_direct\" className=\"flex items-center gap-2 font-medium cursor-pointer\">\n                  <Store className=\"h-4 w-4 text-green-600\" />\n                  Directo al Vendor\n                </Label>\n                <p className=\"text-sm text-muted-foreground mt-1\">\n                  Si el cliente tiene un pedido activo, los mensajes van directamente al negocio. \n                  Si no, se crea un ticket de soporte.\n                </p>\n              </div>\n            </div>\n\n            <div className=\"flex items-start space-x-3 p-4 rounded-lg border hover:bg-accent/50 transition-colors\">\n              <RadioGroupItem value=\"support_queue\" id=\"support_queue\" />\n              <div className=\"flex-1\">\n                <Label htmlFor=\"support_queue\" className=\"flex items-center gap-2 font-medium cursor-pointer\">\n                  <HeadphonesIcon className=\"h-4 w-4 text-blue-600\" />\n                  Cola de Soporte\n                </Label>\n                <p className=\"text-sm text-muted-foreground mt-1\">\n                  Todos los mensajes se convierten en tickets de soporte para que el equipo los atienda manualmente.\n                </p>\n              </div>\n            </div>\n\n            <div className=\"flex items-start space-x-3 p-4 rounded-lg border hover:bg-accent/50 transition-colors\">\n              <RadioGroupItem value=\"offline\" id=\"offline\" />\n              <div className=\"flex-1\">\n                <Label htmlFor=\"offline\" className=\"flex items-center gap-2 font-medium cursor-pointer\">\n                  <WifiOff className=\"h-4 w-4 text-red-600\" />\n                  Offline (Solo mensaje)\n                </Label>\n                <p className=\"text-sm text-muted-foreground mt-1\">\n                  Solo se env√≠a el mensaje de emergencia. No se procesan los mensajes entrantes.\n                </p>\n              </div>\n            </div>\n          </RadioGroup>\n        </CardContent>\n      </Card>\n\n      {/* Emergency Message */}\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center gap-2\">\n            <MessageSquare className=\"h-5 w-5\" />\n            <CardTitle>Mensaje de Emergencia</CardTitle>\n          </div>\n          <CardDescription>\n            Este mensaje se env√≠a a los clientes cuando el bot no puede procesar sus solicitudes\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <Textarea\n            value={emergencyMessage}\n            onChange={(e) => setEmergencyMessage(e.target.value)}\n            placeholder=\"Escribe el mensaje que ver√°n los clientes...\"\n            rows={4}\n          />\n          <div className=\"flex justify-end\">\n            <Button \n              onClick={saveEmergencyMessage}\n              disabled={saving || emergencyMessage === settings?.emergency_message}\n            >\n              {saving ? <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" /> : null}\n              Guardar Mensaje\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Emergency Contacts */}\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-2\">\n              <Bell className=\"h-5 w-5\" />\n              <CardTitle>Contactos de Emergencia</CardTitle>\n            </div>\n            <Button \n              variant=\"outline\" \n              size=\"sm\" \n              onClick={sendTestNotification}\n              disabled={sendingTest || emergencyContacts.length === 0}\n            >\n              {sendingTest ? (\n                <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n              ) : (\n                <Send className=\"h-4 w-4 mr-2\" />\n              )}\n              Enviar Prueba\n            </Button>\n          </div>\n          <CardDescription>\n            Estos contactos recibir√°n notificaciones cuando el modo emergencia se active autom√°ticamente\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          {emergencyContacts.length === 0 ? (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              <Bell className=\"h-12 w-12 mx-auto mb-2 opacity-50\" />\n              <p>No hay contactos de emergencia configurados</p>\n              <p className=\"text-sm mt-1\">Los administradores aparecer√°n aqu√≠ autom√°ticamente</p>\n            </div>\n          ) : (\n            <div className=\"space-y-4\">\n              {emergencyContacts.map((contact) => (\n                <div \n                  key={contact.id}\n                  className=\"p-4 rounded-lg border bg-card\"\n                >\n                  <div className=\"flex items-start justify-between gap-4\">\n                    <div className=\"flex-1 space-y-3\">\n                      {/* Email */}\n                      <div className=\"flex items-center gap-3\">\n                        <Mail className=\"h-4 w-4 text-muted-foreground\" />\n                        <span className=\"text-sm font-medium\">{contact.email}</span>\n                        <div className=\"flex items-center gap-2 ml-auto\">\n                          <Switch\n                            id={`email-${contact.id}`}\n                            checked={contact.notify_email}\n                            onCheckedChange={(checked) => \n                              updateEmergencyContact(contact.id, { notify_email: checked })\n                            }\n                          />\n                          <Label htmlFor={`email-${contact.id}`} className=\"text-xs\">\n                            Email\n                          </Label>\n                        </div>\n                      </div>\n\n                      {/* Phone */}\n                      <div className=\"flex items-center gap-3\">\n                        <Phone className=\"h-4 w-4 text-muted-foreground\" />\n                        {contact.phone ? (\n                          <>\n                            <span className=\"text-sm\">{contact.phone}</span>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              onClick={() => updateEmergencyContact(contact.id, { phone: null })}\n                              className=\"h-6 px-2\"\n                            >\n                              <Trash2 className=\"h-3 w-3\" />\n                            </Button>\n                          </>\n                        ) : (\n                          <div className=\"flex items-center gap-2\">\n                            <Input\n                              placeholder=\"+5493435123456\"\n                              value={newContactPhone}\n                              onChange={(e) => setNewContactPhone(e.target.value)}\n                              className=\"h-8 w-40 text-sm\"\n                            />\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => addPhoneToContact(contact.id)}\n                              className=\"h-8\"\n                            >\n                              <Plus className=\"h-3 w-3 mr-1\" />\n                              Agregar\n                            </Button>\n                          </div>\n                        )}\n                        <div className=\"flex items-center gap-2 ml-auto\">\n                          <Switch\n                            id={`wa-${contact.id}`}\n                            checked={contact.notify_whatsapp}\n                            disabled={!contact.phone}\n                            onCheckedChange={(checked) => \n                              updateEmergencyContact(contact.id, { notify_whatsapp: checked })\n                            }\n                          />\n                          <Label htmlFor={`wa-${contact.id}`} className=\"text-xs\">\n                            WhatsApp\n                          </Label>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Status badges */}\n                  <div className=\"flex gap-2 mt-3\">\n                    {contact.notify_email && (\n                      <Badge variant=\"outline\" className=\"text-xs\">\n                        <Mail className=\"h-3 w-3 mr-1\" />\n                        Email activo\n                      </Badge>\n                    )}\n                    {contact.notify_whatsapp && contact.phone && (\n                      <Badge variant=\"outline\" className=\"text-xs\">\n                        <Phone className=\"h-3 w-3 mr-1\" />\n                        WhatsApp activo\n                      </Badge>\n                    )}\n                    {!contact.notify_email && !contact.notify_whatsapp && (\n                      <Badge variant=\"secondary\" className=\"text-xs\">\n                        Sin notificaciones\n                      </Badge>\n                    )}\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Error Statistics */}\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-2\">\n              <AlertTriangle className=\"h-5 w-5\" />\n              <CardTitle>Estad√≠sticas de Errores</CardTitle>\n            </div>\n            <Button variant=\"outline\" size=\"sm\" onClick={resetErrorCounters}>\n              <RefreshCw className=\"h-4 w-4 mr-2\" />\n              Resetear Contadores\n            </Button>\n          </div>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid gap-4 md:grid-cols-4\">\n            <div className=\"text-center p-4 rounded-lg bg-muted/50\">\n              <div className=\"text-3xl font-bold text-red-600\">{settings?.error_count || 0}</div>\n              <div className=\"text-sm text-muted-foreground\">Errores consecutivos</div>\n            </div>\n            <div className=\"text-center p-4 rounded-lg bg-muted/50\">\n              <div className=\"text-3xl font-bold text-orange-600\">{last24hErrors.length}</div>\n              <div className=\"text-sm text-muted-foreground\">Errores (24h)</div>\n            </div>\n            <div className=\"text-center p-4 rounded-lg bg-muted/50\">\n              <div className=\"text-3xl font-bold text-yellow-600\">{unresolvedErrors.length}</div>\n              <div className=\"text-sm text-muted-foreground\">Sin resolver</div>\n            </div>\n            <div className=\"text-center p-4 rounded-lg bg-muted/50\">\n              <div className=\"text-3xl font-bold\">{settings?.auto_emergency_threshold || 3}</div>\n              <div className=\"text-sm text-muted-foreground\">Umbral auto-emergencia</div>\n            </div>\n          </div>\n\n          {settings?.last_error && (\n            <div className=\"mt-4 p-4 rounded-lg bg-red-50 dark:bg-red-950/20 border border-red-200 dark:border-red-900\">\n              <div className=\"flex items-center gap-2 text-red-600 font-medium mb-2\">\n                <Clock className=\"h-4 w-4\" />\n                √öltimo error: {settings.last_error_at \n                  ? format(new Date(settings.last_error_at), \"dd MMM yyyy HH:mm:ss\", { locale: es })\n                  : 'N/A'}\n              </div>\n              <code className=\"text-sm text-red-700 dark:text-red-400 break-all\">\n                {settings.last_error}\n              </code>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Error Logs */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Log de Errores Recientes</CardTitle>\n          <CardDescription>\n            √öltimos 50 errores registrados del bot\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          {errorLogs.length === 0 ? (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              <CheckCircle2 className=\"h-12 w-12 mx-auto mb-2 text-green-500\" />\n              <p>No hay errores registrados</p>\n            </div>\n          ) : (\n            <ScrollArea className=\"h-[400px]\">\n              <div className=\"space-y-3\">\n                {errorLogs.map((log) => (\n                  <div \n                    key={log.id} \n                    className={`p-4 rounded-lg border ${\n                      log.resolved \n                        ? 'bg-muted/30 border-muted' \n                        : 'bg-red-50 dark:bg-red-950/20 border-red-200 dark:border-red-900'\n                    }`}\n                  >\n                    <div className=\"flex items-start justify-between gap-4\">\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-center gap-2 mb-1\">\n                          <Badge variant={log.resolved ? 'outline' : 'destructive'}>\n                            {log.error_type}\n                          </Badge>\n                          <span className=\"text-xs text-muted-foreground\">\n                            {format(new Date(log.created_at), \"dd/MM/yy HH:mm:ss\", { locale: es })}\n                          </span>\n                        </div>\n                        <p className=\"text-sm break-all\">{log.error_message}</p>\n                        {log.customer_phone && (\n                          <p className=\"text-xs text-muted-foreground mt-1\">\n                            Cliente: {log.customer_phone}\n                          </p>\n                        )}\n                      </div>\n                      {!log.resolved && (\n                        <Button \n                          variant=\"ghost\" \n                          size=\"sm\"\n                          onClick={() => markErrorResolved(log.id)}\n                        >\n                          <CheckCircle2 className=\"h-4 w-4\" />\n                        </Button>\n                      )}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </ScrollArea>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\admin\\PharmacyProductLoader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\admin\\PlatformReviewsPanel.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchReviews'. Either include it or remove the dependency array.","line":27,"column":6,"nodeType":"ArrayExpression","endLine":27,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchReviews]","fix":{"range":[878,880],"text":"[fetchReviews]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Star } from \"lucide-react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\n\ninterface PlatformReview {\n  id: string;\n  user_type: 'vendor' | 'customer';\n  reviewer_name: string;\n  reviewer_phone: string;\n  reviewer_email: string | null;\n  rating: number;\n  comment: string | null;\n  created_at: string;\n}\n\nexport const PlatformReviewsPanel = () => {\n  const [reviews, setReviews] = useState<PlatformReview[]>([]);\n  const [loading, setLoading] = useState(true);\n  const { toast } = useToast();\n\n  useEffect(() => {\n    fetchReviews();\n  }, []);\n\n  const fetchReviews = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('platform_reviews')\n        .select('*')\n        .order('created_at', { ascending: false });\n\n      if (error) throw error;\n      setReviews((data as PlatformReview[]) || []);\n    } catch (error) {\n      console.error('Error fetching reviews:', error);\n      toast({\n        title: \"Error\",\n        description: \"No se pudieron cargar las rese√±as\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const renderStars = (rating: number) => {\n    return (\n      <div className=\"flex gap-1\">\n        {[1, 2, 3, 4, 5].map((star) => (\n          <Star\n            key={star}\n            className={`w-4 h-4 ${\n              star <= rating ? 'fill-yellow-400 text-yellow-400' : 'text-muted-foreground'\n            }`}\n          />\n        ))}\n      </div>\n    );\n  };\n\n  const calculateStats = (filterType?: 'vendor' | 'customer') => {\n    const filtered = filterType \n      ? reviews.filter(r => r.user_type === filterType)\n      : reviews;\n    \n    const avgRating = filtered.length > 0\n      ? (filtered.reduce((acc, r) => acc + r.rating, 0) / filtered.length).toFixed(1)\n      : '0';\n    \n    const ratingDistribution = [5, 4, 3, 2, 1].map(rating => ({\n      rating,\n      count: filtered.filter(r => r.rating === rating).length\n    }));\n\n    return { avgRating, total: filtered.length, distribution: ratingDistribution };\n  };\n\n  const renderReviewsList = (filterType?: 'vendor' | 'customer') => {\n    const filtered = filterType \n      ? reviews.filter(r => r.user_type === filterType)\n      : reviews;\n\n    if (loading) {\n      return <div className=\"text-center py-8 text-muted-foreground\">Cargando rese√±as...</div>;\n    }\n\n    if (filtered.length === 0) {\n      return <div className=\"text-center py-8 text-muted-foreground\">No hay rese√±as disponibles</div>;\n    }\n\n    return (\n      <div className=\"space-y-4\">\n        {filtered.map((review) => (\n          <Card key={review.id}>\n            <CardHeader>\n              <div className=\"flex justify-between items-start\">\n                <div className=\"space-y-1\">\n                  <CardTitle className=\"text-base\">{review.reviewer_name}</CardTitle>\n                  <CardDescription className=\"text-sm\">\n                    {review.reviewer_phone}\n                    {review.reviewer_email && ` ‚Ä¢ ${review.reviewer_email}`}\n                  </CardDescription>\n                </div>\n                <div className=\"flex flex-col items-end gap-2\">\n                  <Badge variant={review.user_type === 'vendor' ? 'default' : 'secondary'}>\n                    {review.user_type === 'vendor' ? 'üëî Vendedor' : 'üë§ Cliente'}\n                  </Badge>\n                  <span className=\"text-xs text-muted-foreground\">\n                    {new Date(review.created_at).toLocaleDateString('es-ES', {\n                      day: '2-digit',\n                      month: '2-digit',\n                      year: 'numeric'\n                    })}\n                  </span>\n                </div>\n              </div>\n            </CardHeader>\n            <CardContent className=\"space-y-2\">\n              {renderStars(review.rating)}\n              {review.comment && (\n                <p className=\"text-sm text-muted-foreground mt-2\">{review.comment}</p>\n              )}\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n    );\n  };\n\n  const renderStats = (filterType?: 'vendor' | 'customer') => {\n    const stats = calculateStats(filterType);\n    \n    return (\n      <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3 mb-6\">\n        <Card>\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-sm font-medium\">Calificaci√≥n promedio</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex items-center gap-2\">\n              <span className=\"text-3xl font-bold\">{stats.avgRating}</span>\n              {renderStars(Math.round(parseFloat(stats.avgRating)))}\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Basado en {stats.total} rese√±a{stats.total !== 1 ? 's' : ''}\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card className=\"lg:col-span-2\">\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-sm font-medium\">Distribuci√≥n de calificaciones</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-2\">\n              {stats.distribution.map(({ rating, count }) => (\n                <div key={rating} className=\"flex items-center gap-2\">\n                  <span className=\"text-sm w-3\">{rating}</span>\n                  <Star className=\"w-4 h-4 fill-yellow-400 text-yellow-400\" />\n                  <div className=\"flex-1 h-2 bg-muted rounded-full overflow-hidden\">\n                    <div \n                      className=\"h-full bg-primary\"\n                      style={{ \n                        width: `${stats.total > 0 ? (count / stats.total) * 100 : 0}%` \n                      }}\n                    />\n                  </div>\n                  <span className=\"text-sm text-muted-foreground w-8 text-right\">{count}</span>\n                </div>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h2 className=\"text-2xl font-bold mb-2\">üåü Rese√±as de la Plataforma</h2>\n        <p className=\"text-muted-foreground\">\n          Opiniones de vendedores y clientes sobre Lapacho\n        </p>\n      </div>\n\n      <Tabs defaultValue=\"all\" className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-3\">\n          <TabsTrigger value=\"all\">Todas</TabsTrigger>\n          <TabsTrigger value=\"vendors\">Vendedores</TabsTrigger>\n          <TabsTrigger value=\"customers\">Clientes</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"all\" className=\"mt-6\">\n          {renderStats()}\n          {renderReviewsList()}\n        </TabsContent>\n\n        <TabsContent value=\"vendors\" className=\"mt-6\">\n          {renderStats('vendor')}\n          {renderReviewsList('vendor')}\n        </TabsContent>\n\n        <TabsContent value=\"customers\" className=\"mt-6\">\n          {renderStats('customer')}\n          {renderReviewsList('customer')}\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\admin\\SoporteUserManagement.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchSoporteUsers'. Either include it or remove the dependency array.","line":52,"column":6,"nodeType":"ArrayExpression","endLine":52,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchSoporteUsers]","fix":{"range":[1485,1487],"text":"[fetchSoporteUsers]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":83,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2326,2329],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2326,2329],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":139,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3976,3979],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3976,3979],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":173,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":173,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4732,4735],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4732,4735],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { UserPlus, Trash2, Mail, Key } from \"lucide-react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n  DialogDescription,\n} from \"@/components/ui/dialog\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\n\ninterface SoporteUser {\n  id: string;\n  email: string;\n  full_name: string | null;\n  created_at: string;\n}\n\nexport default function SoporteUserManagement() {\n  const [users, setUsers] = useState<SoporteUser[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [dialogOpen, setDialogOpen] = useState(false);\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [selectedUser, setSelectedUser] = useState<SoporteUser | null>(null);\n  const { toast } = useToast();\n\n  const [formData, setFormData] = useState({\n    email: \"\",\n    password: \"\",\n    full_name: \"\",\n  });\n\n  useEffect(() => {\n    fetchSoporteUsers();\n  }, []);\n\n  const fetchSoporteUsers = async () => {\n    try {\n      setLoading(true);\n      \n      // Get users with soporte role\n      const { data: userRoles, error: rolesError } = await supabase\n        .from('user_roles')\n        .select('user_id')\n        .eq('role', 'soporte');\n\n      if (rolesError) throw rolesError;\n\n      if (!userRoles || userRoles.length === 0) {\n        setUsers([]);\n        return;\n      }\n\n      const userIds = userRoles.map(ur => ur.user_id);\n\n      // Get profiles for these users\n      const { data: profiles, error: profilesError } = await supabase\n        .from('profiles')\n        .select('id, email, full_name, created_at')\n        .in('id', userIds)\n        .order('created_at', { ascending: false });\n\n      if (profilesError) throw profilesError;\n\n      setUsers(profiles || []);\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const createSoporteUser = async () => {\n    try {\n      if (!formData.email || !formData.password) {\n        throw new Error(\"Email y contrase√±a son requeridos\");\n      }\n\n      setLoading(true);\n\n      // Create user in auth\n      const { data: authData, error: authError } = await supabase.auth.admin.createUser({\n        email: formData.email,\n        password: formData.password,\n        email_confirm: true,\n        user_metadata: {\n          full_name: formData.full_name || null,\n        },\n      });\n\n      if (authError) throw authError;\n      if (!authData.user) throw new Error(\"No se pudo crear el usuario\");\n\n      // Update profile with full_name if provided\n      if (formData.full_name) {\n        const { error: profileError } = await supabase\n          .from('profiles')\n          .update({ full_name: formData.full_name })\n          .eq('id', authData.user.id);\n\n        if (profileError) throw profileError;\n      }\n\n      // Assign soporte role using the database function\n      const { data: functionData, error: functionError } = await supabase\n        .rpc('make_user_soporte', { user_email: formData.email });\n\n      if (functionError) throw functionError;\n\n      toast({\n        title: \"‚úÖ Usuario de soporte creado\",\n        description: `${formData.email} ahora tiene acceso al panel de soporte`,\n      });\n\n      setFormData({ email: \"\", password: \"\", full_name: \"\" });\n      setDialogOpen(false);\n      fetchSoporteUsers();\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const removeSoporteRole = async () => {\n    if (!selectedUser) return;\n\n    try {\n      setLoading(true);\n\n      // Remove soporte role\n      const { error } = await supabase\n        .from('user_roles')\n        .delete()\n        .eq('user_id', selectedUser.id)\n        .eq('role', 'soporte');\n\n      if (error) throw error;\n\n      toast({\n        title: \"‚úÖ Rol removido\",\n        description: `${selectedUser.email} ya no tiene acceso al panel de soporte`,\n      });\n\n      setDeleteDialogOpen(false);\n      setSelectedUser(null);\n      fetchSoporteUsers();\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (loading && users.length === 0) {\n    return (\n      <div className=\"flex items-center justify-center py-8\">\n        <p className=\"text-muted-foreground\">Cargando usuarios de soporte...</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h2 className=\"text-2xl font-bold\">Usuarios de Soporte</h2>\n          <p className=\"text-muted-foreground\">\n            Gestiona los usuarios con acceso al panel de soporte\n          </p>\n        </div>\n        <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n          <DialogTrigger asChild>\n            <Button>\n              <UserPlus className=\"mr-2 h-4 w-4\" />\n              Crear Usuario de Soporte\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"sm:max-w-md\">\n            <DialogHeader>\n              <DialogTitle>Crear Usuario de Soporte</DialogTitle>\n              <DialogDescription>\n                Crea un nuevo usuario con acceso al panel de soporte\n              </DialogDescription>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"email\">\n                  <Mail className=\"inline mr-2 h-4 w-4\" />\n                  Email *\n                </Label>\n                <Input\n                  id=\"email\"\n                  type=\"email\"\n                  placeholder=\"soporte@ejemplo.com\"\n                  value={formData.email}\n                  onChange={(e) =>\n                    setFormData({ ...formData, email: e.target.value })\n                  }\n                  required\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"password\">\n                  <Key className=\"inline mr-2 h-4 w-4\" />\n                  Contrase√±a *\n                </Label>\n                <Input\n                  id=\"password\"\n                  type=\"password\"\n                  placeholder=\"M√≠nimo 6 caracteres\"\n                  value={formData.password}\n                  onChange={(e) =>\n                    setFormData({ ...formData, password: e.target.value })\n                  }\n                  required\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"full_name\">Nombre Completo (opcional)</Label>\n                <Input\n                  id=\"full_name\"\n                  placeholder=\"Juan P√©rez\"\n                  value={formData.full_name}\n                  onChange={(e) =>\n                    setFormData({ ...formData, full_name: e.target.value })\n                  }\n                />\n              </div>\n              <Button\n                onClick={createSoporteUser}\n                disabled={loading || !formData.email || !formData.password}\n                className=\"w-full\"\n              >\n                {loading ? \"Creando...\" : \"Crear Usuario\"}\n              </Button>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {users.length === 0 ? (\n        <Card>\n          <CardContent className=\"flex flex-col items-center justify-center py-12\">\n            <UserPlus className=\"h-12 w-12 text-muted-foreground mb-4\" />\n            <p className=\"text-muted-foreground text-center\">\n              No hay usuarios de soporte creados\n            </p>\n            <p className=\"text-sm text-muted-foreground text-center mt-2\">\n              Crea el primer usuario de soporte para comenzar\n            </p>\n          </CardContent>\n        </Card>\n      ) : (\n        <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n          {users.map((user) => (\n            <Card key={user.id}>\n              <CardHeader>\n                <div className=\"flex items-start justify-between\">\n                  <div>\n                    <CardTitle className=\"text-lg\">\n                      {user.full_name || \"Sin nombre\"}\n                    </CardTitle>\n                    <p className=\"text-sm text-muted-foreground mt-1\">\n                      {user.email}\n                    </p>\n                  </div>\n                  <Badge variant=\"secondary\">Soporte</Badge>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-2\">\n                  <p className=\"text-xs text-muted-foreground\">\n                    Creado: {new Date(user.created_at).toLocaleDateString('es-AR')}\n                  </p>\n                  <Button\n                    variant=\"destructive\"\n                    size=\"sm\"\n                    className=\"w-full\"\n                    onClick={() => {\n                      setSelectedUser(user);\n                      setDeleteDialogOpen(true);\n                    }}\n                  >\n                    <Trash2 className=\"mr-2 h-4 w-4\" />\n                    Remover Acceso\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      )}\n\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>¬øRemover acceso de soporte?</AlertDialogTitle>\n            <AlertDialogDescription>\n              Se remover√° el rol de soporte de <strong>{selectedUser?.email}</strong>.\n              El usuario ya no podr√° acceder al panel de soporte, pero su cuenta seguir√° existiendo.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancelar</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={removeSoporteRole}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n            >\n              Remover Acceso\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\admin\\SupportPanel.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchTickets' and 'setupRealtimeSubscription'. Either include them or remove the dependency array.","line":51,"column":6,"nodeType":"ArrayExpression","endLine":51,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchTickets, setupRealtimeSubscription]","fix":{"range":[1419,1421],"text":"[fetchTickets, setupRealtimeSubscription]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchMessages'. Either include it or remove the dependency array.","line":57,"column":6,"nodeType":"ArrayExpression","endLine":57,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [fetchMessages, selectedTicket]","fix":{"range":[1522,1538],"text":"[fetchMessages, selectedTicket]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":75,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2078,2081],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2078,2081],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":97,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2614,2617],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2614,2617],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":118,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3122,3125],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3122,3125],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":172,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":172,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4653,4656],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4653,4656],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":202,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":202,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5372,5375],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5372,5375],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":212,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":212,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5597,5600],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5597,5600],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { \n  MessageSquare, \n  Clock, \n  CheckCircle, \n  XCircle, \n  Send,\n  AlertCircle,\n  User\n} from \"lucide-react\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\n\ninterface Ticket {\n  id: string;\n  customer_phone: string;\n  customer_name: string | null;\n  subject: string;\n  status: string;\n  priority: string;\n  created_at: string;\n  updated_at: string;\n  assigned_to: string | null;\n}\n\ninterface Message {\n  id: string;\n  ticket_id: string;\n  sender_type: string;\n  message: string;\n  created_at: string;\n}\n\nexport default function SupportPanel() {\n  const [tickets, setTickets] = useState<Ticket[]>([]);\n  const [selectedTicket, setSelectedTicket] = useState<Ticket | null>(null);\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [newMessage, setNewMessage] = useState(\"\");\n  const [loading, setLoading] = useState(true);\n  const { toast } = useToast();\n\n  useEffect(() => {\n    fetchTickets();\n    setupRealtimeSubscription();\n  }, []);\n\n  useEffect(() => {\n    if (selectedTicket) {\n      fetchMessages(selectedTicket.id);\n    }\n  }, [selectedTicket]);\n\n  const setupRealtimeSubscription = () => {\n    const channel = supabase\n      .channel('support-changes')\n      .on(\n        'postgres_changes',\n        { event: 'INSERT', schema: 'public', table: 'support_tickets' },\n        () => fetchTickets()\n      )\n      .on(\n        'postgres_changes',\n        { event: 'UPDATE', schema: 'public', table: 'support_tickets' },\n        () => fetchTickets()\n      )\n      .on(\n        'postgres_changes',\n        { event: 'INSERT', schema: 'public', table: 'support_messages' },\n        (payload: any) => {\n          if (selectedTicket && payload.new.ticket_id === selectedTicket.id) {\n            fetchMessages(selectedTicket.id);\n          }\n        }\n      )\n      .subscribe();\n\n    return () => {\n      supabase.removeChannel(channel);\n    };\n  };\n\n  const fetchTickets = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('support_tickets')\n        .select('*')\n        .order('created_at', { ascending: false });\n\n      if (error) throw error;\n      setTickets(data || []);\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchMessages = async (ticketId: string) => {\n    try {\n      const { data, error } = await supabase\n        .from('support_messages')\n        .select('*')\n        .eq('ticket_id', ticketId)\n        .order('created_at', { ascending: true });\n\n      if (error) throw error;\n      setMessages(data || []);\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const sendMessage = async () => {\n    if (!newMessage.trim() || !selectedTicket) return;\n\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      \n      const { data, error } = await supabase\n        .from('support_messages')\n        .insert({\n          ticket_id: selectedTicket.id,\n          sender_type: 'support',\n          sender_id: user?.id,\n          message: newMessage.trim(),\n        })\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      // Actualizar la lista de mensajes inmediatamente\n      if (data) {\n        setMessages(prev => [...prev, data]);\n      }\n\n      // Enviar notificaci√≥n por WhatsApp al cliente\n      try {\n        const { error: whatsappError } = await supabase.functions.invoke('send-whatsapp-notification', {\n          body: {\n            phoneNumber: selectedTicket.customer_phone,\n            message: `üì© Respuesta de soporte:\\n\\n${newMessage.trim()}\\n\\n---\\nTicket: ${selectedTicket.subject}`\n          }\n        });\n\n        if (whatsappError) {\n          console.error('Error sending WhatsApp:', whatsappError);\n        }\n      } catch (whatsappError) {\n        console.error('WhatsApp notification failed:', whatsappError);\n      }\n\n      setNewMessage(\"\");\n      toast({\n        title: \"Mensaje enviado\",\n        description: \"El cliente recibir√° tu respuesta por WhatsApp\",\n      });\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const updateTicketStatus = async (status: string) => {\n    if (!selectedTicket) return;\n\n    try {\n      const { error } = await supabase\n        .from('support_tickets')\n        .update({ \n          status,\n          resolved_at: status === 'resolved' ? new Date().toISOString() : null\n        })\n        .eq('id', selectedTicket.id);\n\n      if (error) throw error;\n\n      setSelectedTicket({ ...selectedTicket, status });\n      fetchTickets();\n\n      toast({\n        title: \"Estado actualizado\",\n        description: `Ticket marcado como ${status}`,\n      });\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const getStatusBadge = (status: string) => {\n    const variants: Record<string, { icon: any; className: string; label: string }> = {\n      open: { icon: Clock, className: \"bg-yellow-500\", label: \"Abierto\" },\n      in_progress: { icon: AlertCircle, className: \"bg-blue-500\", label: \"En Progreso\" },\n      resolved: { icon: CheckCircle, className: \"bg-green-500\", label: \"Resuelto\" },\n      closed: { icon: XCircle, className: \"bg-gray-500\", label: \"Cerrado\" },\n    };\n\n    const config = variants[status] || variants.open;\n    const Icon = config.icon;\n\n    return (\n      <Badge className={config.className}>\n        <Icon className=\"w-3 h-3 mr-1\" />\n        {config.label}\n      </Badge>\n    );\n  };\n\n  const filterTickets = (status: string) => {\n    return tickets.filter(t => status === 'all' || t.status === status);\n  };\n\n  if (loading) {\n    return <div className=\"p-8\">Cargando tickets...</div>;\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <h2 className=\"text-3xl font-bold\">Panel de Soporte</h2>\n\n      <div className=\"grid md:grid-cols-3 gap-4\">\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-sm\">Tickets Abiertos</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-3xl font-bold\">\n              {tickets.filter(t => t.status === 'open').length}\n            </p>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-sm\">En Progreso</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-3xl font-bold\">\n              {tickets.filter(t => t.status === 'in_progress').length}\n            </p>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-sm\">Resueltos Hoy</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-3xl font-bold\">\n              {tickets.filter(t => t.status === 'resolved' && \n                new Date(t.updated_at).toDateString() === new Date().toDateString()\n              ).length}\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"grid md:grid-cols-2 gap-6\">\n        {/* Lista de Tickets */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Tickets</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <Tabs defaultValue=\"all\">\n              <TabsList className=\"grid w-full grid-cols-4\">\n                <TabsTrigger value=\"all\">Todos</TabsTrigger>\n                <TabsTrigger value=\"open\">Abiertos</TabsTrigger>\n                <TabsTrigger value=\"in_progress\">En Curso</TabsTrigger>\n                <TabsTrigger value=\"resolved\">Resueltos</TabsTrigger>\n              </TabsList>\n\n              {['all', 'open', 'in_progress', 'resolved'].map(status => (\n                <TabsContent key={status} value={status} className=\"space-y-2\">\n                  {filterTickets(status).map(ticket => (\n                    <div\n                      key={ticket.id}\n                      onClick={() => setSelectedTicket(ticket)}\n                      className={`p-4 border rounded-lg cursor-pointer transition-colors ${\n                        selectedTicket?.id === ticket.id \n                          ? 'border-primary bg-primary/5' \n                          : 'hover:border-primary/50'\n                      }`}\n                    >\n                      <div className=\"flex justify-between items-start mb-2\">\n                        <div className=\"flex items-center gap-2\">\n                          <User className=\"h-4 w-4\" />\n                          <span className=\"font-medium\">\n                            {ticket.customer_name || ticket.customer_phone}\n                          </span>\n                        </div>\n                        {getStatusBadge(ticket.status)}\n                      </div>\n                      <p className=\"text-sm text-muted-foreground mb-2\">{ticket.subject}</p>\n                      <p className=\"text-xs text-muted-foreground\">\n                        {new Date(ticket.created_at).toLocaleString('es-AR')}\n                      </p>\n                    </div>\n                  ))}\n                </TabsContent>\n              ))}\n            </Tabs>\n          </CardContent>\n        </Card>\n\n        {/* Chat del Ticket */}\n        <Card>\n          <CardHeader>\n            <div className=\"flex justify-between items-center\">\n              <CardTitle>\n                {selectedTicket ? selectedTicket.subject : 'Selecciona un ticket'}\n              </CardTitle>\n              {selectedTicket && (\n                <div className=\"flex gap-2\">\n                  {selectedTicket.status !== 'in_progress' && (\n                    <Button \n                      size=\"sm\" \n                      variant=\"outline\"\n                      onClick={() => updateTicketStatus('in_progress')}\n                    >\n                      En Progreso\n                    </Button>\n                  )}\n                  {selectedTicket.status !== 'resolved' && (\n                    <Button \n                      size=\"sm\"\n                      onClick={() => updateTicketStatus('resolved')}\n                    >\n                      Resolver\n                    </Button>\n                  )}\n                </div>\n              )}\n            </div>\n          </CardHeader>\n          <CardContent>\n            {selectedTicket ? (\n              <div className=\"space-y-4\">\n                {/* Mensajes */}\n                <div className=\"h-96 overflow-y-auto space-y-3 p-4 border rounded-lg\">\n                  {messages.map(msg => (\n                    <div\n                      key={msg.id}\n                      className={`flex ${msg.sender_type === 'support' ? 'justify-end' : 'justify-start'}`}\n                    >\n                      <div\n                        className={`max-w-[80%] p-3 rounded-lg ${\n                          msg.sender_type === 'support'\n                            ? 'bg-primary text-primary-foreground'\n                            : 'bg-muted'\n                        }`}\n                      >\n                        <p className=\"text-sm\">{msg.message}</p>\n                        <p className=\"text-xs mt-1 opacity-70\">\n                          {new Date(msg.created_at).toLocaleTimeString('es-AR')}\n                        </p>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n\n                {/* Input de Respuesta */}\n                <div className=\"flex gap-2\">\n                  <Textarea\n                    placeholder=\"Escribe tu respuesta...\"\n                    value={newMessage}\n                    onChange={(e) => setNewMessage(e.target.value)}\n                    onKeyDown={(e) => {\n                      if (e.key === 'Enter' && !e.shiftKey) {\n                        e.preventDefault();\n                        sendMessage();\n                      }\n                    }}\n                    className=\"resize-none\"\n                    rows={3}\n                  />\n                  <Button onClick={sendMessage} disabled={!newMessage.trim()}>\n                    <Send className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              </div>\n            ) : (\n              <div className=\"h-96 flex items-center justify-center text-muted-foreground\">\n                <div className=\"text-center\">\n                  <MessageSquare className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                  <p>Selecciona un ticket para ver la conversaci√≥n</p>\n                </div>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\admin\\VendorChangeAnalytics.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\admin\\VendorManagement.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1568,1571],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1568,1571],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchCategories' and 'fetchVendors'. Either include them or remove the dependency array.","line":70,"column":6,"nodeType":"ArrayExpression","endLine":70,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchCategories, fetchVendors]","fix":{"range":[2060,2062],"text":"[fetchCategories, fetchVendors]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":84,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2603,2606],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2603,2606],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":102,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3035,3038],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3035,3038],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":120,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3441,3444],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3441,3444],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":177,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":177,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4874,4877],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4874,4877],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":205,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":205,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5711,5714],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5711,5714],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":239,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":239,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6583,6586],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6583,6586],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":281,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":281,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7723,7726],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7723,7726],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":305,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":305,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8299,8302],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8299,8302],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Plus, Pause, Play, Edit, UserPlus, UserMinus } from \"lucide-react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\n\ninterface Vendor {\n  id: string;\n  name: string;\n  category: string;\n  phone: string;\n  address: string;\n  payment_status: string;\n  suspended_reason: string | null;\n  total_orders: number;\n  user_id: string | null;\n}\n\nexport default function VendorManagement() {\n  const [vendors, setVendors] = useState<Vendor[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [dialogOpen, setDialogOpen] = useState(false);\n  const [linkUserDialogOpen, setLinkUserDialogOpen] = useState(false);\n  const [selectedVendor, setSelectedVendor] = useState<Vendor | null>(null);\n  const { toast } = useToast();\n\n  const [linkUserData, setLinkUserData] = useState({\n    email: \"\",\n    password: \"\",\n  });\n\n  const [assignMode, setAssignMode] = useState<'create' | 'existing'>('create');\n  const [existingUsers, setExistingUsers] = useState<any[]>([]);\n  const [selectedUserId, setSelectedUserId] = useState<string>('');\n\n  const [categories, setCategories] = useState<string[]>([]);\n  const [customCategory, setCustomCategory] = useState('');\n  const [showCustomCategory, setShowCustomCategory] = useState(false);\n\n  const [formData, setFormData] = useState({\n    name: \"\",\n    category: \"\",\n    phone: \"\",\n    address: \"\",\n    email: \"\",\n    password: \"\",\n  });\n\n  useEffect(() => {\n    fetchVendors();\n    fetchCategories();\n  }, []);\n\n  const fetchCategories = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('vendors')\n        .select('category');\n\n      if (error) throw error;\n      \n      const uniqueCategories = [...new Set(data.map(v => v.category))].filter(Boolean);\n      const defaultCategories = ['restaurant', 'food', 'grocery', 'pharmacy', 'retail', 'service', 'vivero', 'other'];\n      const allCategories = [...new Set([...defaultCategories, ...uniqueCategories])];\n      setCategories(allCategories);\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const fetchExistingUsers = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('profiles')\n        .select('id, email, full_name')\n        .order('email', { ascending: true });\n\n      if (error) throw error;\n      setExistingUsers(data || []);\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const fetchVendors = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('vendors')\n        .select('*')\n        .order('created_at', { ascending: false });\n\n      if (error) throw error;\n      setVendors(data || []);\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const createVendor = async () => {\n    try {\n      // Create the vendor record\n      const { data: vendorData, error: vendorError } = await supabase\n        .from('vendors')\n        .insert({\n          name: formData.name,\n          category: formData.category,\n          phone: formData.phone,\n          address: formData.address,\n          payment_status: 'active',\n        })\n        .select()\n        .single();\n\n      if (vendorError) throw vendorError;\n      if (!vendorData) throw new Error('Error creando negocio');\n\n      // Only create user if email and password are provided\n      if (formData.email && formData.password) {\n        const { error } = await supabase.functions.invoke('create-vendor-user', {\n          body: {\n            email: formData.email,\n            password: formData.password,\n            vendorId: vendorData.id\n          }\n        });\n\n        if (error) throw error;\n      }\n\n      toast({\n        title: \"Negocio creado\",\n        description: \"El negocio ha sido creado exitosamente\",\n      });\n\n      setDialogOpen(false);\n      setFormData({\n        name: \"\",\n        category: \"\",\n        phone: \"\",\n        address: \"\",\n        email: \"\",\n        password: \"\",\n      });\n      fetchVendors();\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const toggleVendorStatus = async (vendorId: string, currentStatus: string) => {\n    try {\n      const newStatus = currentStatus === 'active' ? 'suspended' : 'active';\n      const { error } = await supabase\n        .from('vendors')\n        .update({ \n          payment_status: newStatus,\n          suspended_reason: newStatus === 'suspended' ? 'Suspendido por falta de pago' : null\n        })\n        .eq('id', vendorId);\n\n      if (error) throw error;\n\n      toast({\n        title: newStatus === 'active' ? \"Negocio activado\" : \"Negocio suspendido\",\n        description: `El negocio ha sido ${newStatus === 'active' ? 'activado' : 'suspendido'}`,\n      });\n\n      fetchVendors();\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const createUserForVendor = async () => {\n    if (!selectedVendor) return;\n\n    try {\n      const { data, error } = await supabase.functions.invoke('create-vendor-user', {\n        body: {\n          email: linkUserData.email,\n          password: linkUserData.password,\n          vendorId: selectedVendor.id\n        }\n      });\n\n      if (error) throw error;\n\n      toast({\n        title: \"Usuario creado\",\n        description: `Usuario creado y vinculado exitosamente al negocio ${selectedVendor.name}`,\n      });\n\n      setLinkUserDialogOpen(false);\n      setLinkUserData({ email: \"\", password: \"\" });\n      setSelectedVendor(null);\n      setAssignMode('create');\n      setSelectedUserId('');\n      fetchVendors();\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const assignExistingUser = async () => {\n    if (!selectedVendor || !selectedUserId) return;\n\n    try {\n      // Update vendor with user_id\n      const { error: vendorError } = await supabase\n        .from('vendors')\n        .update({ user_id: selectedUserId })\n        .eq('id', selectedVendor.id);\n\n      if (vendorError) throw vendorError;\n\n      // Assign vendor role\n      const { error: roleError } = await supabase\n        .from('user_roles')\n        .insert({\n          user_id: selectedUserId,\n          role: 'vendor',\n        });\n\n      // Ignore error if role already exists (code 23505 = duplicate key)\n      if (roleError && roleError.code !== '23505') throw roleError;\n\n      toast({\n        title: \"Usuario asignado\",\n        description: `Usuario vinculado exitosamente al negocio ${selectedVendor.name}`,\n      });\n\n      setLinkUserDialogOpen(false);\n      setSelectedUserId('');\n      setSelectedVendor(null);\n      setAssignMode('create');\n      fetchVendors();\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const unlinkUserFromVendor = async (vendorId: string, vendorName: string) => {\n    try {\n      const { error } = await supabase\n        .from('vendors')\n        .update({ user_id: null })\n        .eq('id', vendorId);\n\n      if (error) throw error;\n\n      toast({\n        title: \"Usuario desvinculado\",\n        description: `Usuario desvinculado exitosamente del negocio ${vendorName}`,\n      });\n\n      fetchVendors();\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  if (loading) {\n    return <div>Cargando negocios...</div>;\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <h2 className=\"text-3xl font-bold\">Gesti√≥n de Negocios</h2>\n        <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n          <DialogTrigger asChild>\n            <Button>\n              <Plus className=\"mr-2 h-4 w-4\" />\n              Crear Negocio\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-2xl\">\n            <DialogHeader>\n              <DialogTitle>Crear Nuevo Negocio</DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-4 py-4\">\n              <Input\n                placeholder=\"Nombre del negocio\"\n                value={formData.name}\n                onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n              />\n              <div className=\"space-y-2\">\n                <Select \n                  value={showCustomCategory ? 'custom' : formData.category} \n                  onValueChange={(value) => {\n                    if (value === 'custom') {\n                      setShowCustomCategory(true);\n                      setFormData({ ...formData, category: '' });\n                    } else {\n                      setShowCustomCategory(false);\n                      setFormData({ ...formData, category: value });\n                    }\n                  }}\n                >\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Seleccionar categor√≠a\" />\n                  </SelectTrigger>\n                  <SelectContent className=\"bg-background z-50\">\n                    {categories.map((cat) => (\n                      <SelectItem key={cat} value={cat}>\n                        {cat.charAt(0).toUpperCase() + cat.slice(1)}\n                      </SelectItem>\n                    ))}\n                    <SelectItem value=\"custom\">+ Agregar nueva categor√≠a</SelectItem>\n                  </SelectContent>\n                </Select>\n                \n                {showCustomCategory && (\n                  <div className=\"flex gap-2\">\n                    <Input\n                      placeholder=\"Nueva categor√≠a\"\n                      value={customCategory}\n                      onChange={(e) => setCustomCategory(e.target.value)}\n                    />\n                    <Button\n                      type=\"button\"\n                      size=\"sm\"\n                      onClick={() => {\n                        if (customCategory.trim()) {\n                          setCategories([...categories, customCategory.toLowerCase()]);\n                          setFormData({ ...formData, category: customCategory.toLowerCase() });\n                          setCustomCategory('');\n                          setShowCustomCategory(false);\n                          toast({\n                            title: \"Categor√≠a agregada\",\n                            description: `La categor√≠a \"${customCategory}\" ha sido agregada`,\n                          });\n                        }\n                      }}\n                    >\n                      Agregar\n                    </Button>\n                  </div>\n                )}\n              </div>\n              <Input\n                placeholder=\"Tel√©fono\"\n                value={formData.phone}\n                onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\n              />\n              <Textarea\n                placeholder=\"Direcci√≥n\"\n                value={formData.address}\n                onChange={(e) => setFormData({ ...formData, address: e.target.value })}\n              />\n              <div className=\"border-t pt-4 mt-4\">\n                <p className=\"text-sm text-muted-foreground mb-3\">\n                  Asignaci√≥n de usuario (opcional - puedes asignarlo despu√©s)\n                </p>\n                <Input\n                  type=\"email\"\n                  placeholder=\"Email para acceso (opcional)\"\n                  value={formData.email}\n                  onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n                />\n                <Input\n                  type=\"password\"\n                  placeholder=\"Contrase√±a (opcional)\"\n                  value={formData.password}\n                  onChange={(e) => setFormData({ ...formData, password: e.target.value })}\n                  className=\"mt-2\"\n                />\n              </div>\n              <Button onClick={createVendor} className=\"w-full\">\n                Crear Negocio\n              </Button>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n        {vendors.map((vendor) => (\n          <Card key={vendor.id}>\n            <CardHeader>\n              <div className=\"flex justify-between items-start\">\n                <CardTitle className=\"text-lg\">{vendor.name}</CardTitle>\n                <Badge variant={vendor.payment_status === 'active' ? 'default' : 'destructive'}>\n                  {vendor.payment_status === 'active' ? 'Activo' : 'Suspendido'}\n                </Badge>\n              </div>\n            </CardHeader>\n            <CardContent className=\"space-y-2\">\n              <p className=\"text-sm text-muted-foreground\">{vendor.category}</p>\n              <p className=\"text-sm\">{vendor.phone}</p>\n              <p className=\"text-sm text-muted-foreground\">{vendor.address}</p>\n              <p className=\"text-sm font-semibold\">\n                Total pedidos: {vendor.total_orders}\n              </p>\n              {!vendor.user_id && (\n                <Badge variant=\"outline\" className=\"text-yellow-600\">\n                  Sin usuario\n                </Badge>\n              )}\n              {vendor.suspended_reason && (\n                <p className=\"text-sm text-destructive\">{vendor.suspended_reason}</p>\n              )}\n              <div className=\"pt-4 flex gap-2\">\n                <Button\n                  size=\"sm\"\n                  variant={vendor.payment_status === 'active' ? 'destructive' : 'default'}\n                  onClick={() => toggleVendorStatus(vendor.id, vendor.payment_status)}\n                  className=\"flex-1\"\n                >\n                  {vendor.payment_status === 'active' ? (\n                    <>\n                      <Pause className=\"mr-2 h-4 w-4\" />\n                      Suspender\n                    </>\n                  ) : (\n                    <>\n                      <Play className=\"mr-2 h-4 w-4\" />\n                      Activar\n                    </>\n                  )}\n                </Button>\n                {!vendor.user_id ? (\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => {\n                      setSelectedVendor(vendor);\n                      setLinkUserDialogOpen(true);\n                      fetchExistingUsers();\n                    }}\n                    title=\"Asignar usuario\"\n                  >\n                    <UserPlus className=\"h-4 w-4\" />\n                  </Button>\n                ) : (\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => unlinkUserFromVendor(vendor.id, vendor.name)}\n                    title=\"Desvincular usuario\"\n                  >\n                    <UserMinus className=\"h-4 w-4\" />\n                  </Button>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      <Dialog open={linkUserDialogOpen} onOpenChange={setLinkUserDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Asignar Usuario para {selectedVendor?.name}</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <Select value={assignMode} onValueChange={(value: 'create' | 'existing') => setAssignMode(value)}>\n              <SelectTrigger>\n                <SelectValue placeholder=\"Seleccionar tipo\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"create\">Crear nuevo usuario</SelectItem>\n                <SelectItem value=\"existing\">Asignar usuario existente</SelectItem>\n              </SelectContent>\n            </Select>\n\n            {assignMode === 'create' ? (\n              <>\n                <Input\n                  type=\"email\"\n                  placeholder=\"Email\"\n                  value={linkUserData.email}\n                  onChange={(e) => setLinkUserData({ ...linkUserData, email: e.target.value })}\n                />\n                <Input\n                  type=\"password\"\n                  placeholder=\"Contrase√±a\"\n                  value={linkUserData.password}\n                  onChange={(e) => setLinkUserData({ ...linkUserData, password: e.target.value })}\n                />\n                <Button onClick={createUserForVendor} className=\"w-full\">\n                  Crear Usuario\n                </Button>\n              </>\n            ) : (\n              <>\n                <Select value={selectedUserId} onValueChange={setSelectedUserId}>\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Seleccionar usuario\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {existingUsers.map((user) => (\n                      <SelectItem key={user.id} value={user.id}>\n                        {user.email} {user.full_name ? `(${user.full_name})` : ''}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                <Button \n                  onClick={assignExistingUser} \n                  className=\"w-full\"\n                  disabled={!selectedUserId}\n                >\n                  Asignar Usuario\n                </Button>\n              </>\n            )}\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\ui\\accordion.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\ui\\alert-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\ui\\alert.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\ui\\avatar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\ui\\badge.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":36,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":36,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\ui\\button.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":56,"column":18,"nodeType":"Identifier","messageId":"namedExport","endLine":56,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\ui\\calendar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\ui\\card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\ui\\chart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\ui\\checkbox.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\ui\\dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\ui\\dropdown-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\ui\\input-otp.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\ui\\input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\ui\\label.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\ui\\menubar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\ui\\navigation-menu.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":119,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":119,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-accent/50 data-[state=open]:bg-accent/50\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\ui\\popover.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\ui\\progress.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\ui\\radio-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\ui\\scroll-area.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\ui\\select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\ui\\separator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\ui\\sheet.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\ui\\skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\ui\\sonner.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":29,"column":19,"nodeType":"Identifier","messageId":"namedExport","endLine":29,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useTheme } from \"next-themes\"\nimport { Toaster as Sonner, toast } from \"sonner\"\n\ntype ToasterProps = React.ComponentProps<typeof Sonner>\n\nconst Toaster = ({ ...props }: ToasterProps) => {\n  const { theme = \"system\" } = useTheme()\n\n  return (\n    <Sonner\n      theme={theme as ToasterProps[\"theme\"]}\n      className=\"toaster group\"\n      toastOptions={{\n        classNames: {\n          toast:\n            \"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg\",\n          description: \"group-[.toast]:text-muted-foreground\",\n          actionButton:\n            \"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground\",\n          cancelButton:\n            \"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground\",\n        },\n      }}\n      {...props}\n    />\n  )\n}\n\nexport { Toaster, toast }\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\ui\\switch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\ui\\table.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\ui\\tabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\ui\\textarea.tsx","messages":[{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"An interface declaring no members is equivalent to its supertype.","line":5,"column":18,"nodeType":"Identifier","messageId":"noEmptyInterfaceWithSuper","endLine":5,"endColumn":31,"suggestions":[{"messageId":"replaceEmptyInterfaceWithSuper","fix":{"range":[73,159],"text":"type TextareaProps = React.TextareaHTMLAttributes<HTMLTextAreaElement>"},"desc":"Replace empty interface with a type alias."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nexport interface TextareaProps\n  extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}\n\nconst Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(\n  ({ className, ...props }, ref) => {\n    return (\n      <textarea\n        className={cn(\n          \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\ui\\toast.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\ui\\toaster.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\ui\\toggle.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":43,"column":18,"nodeType":"Identifier","messageId":"namedExport","endLine":43,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3\",\n        sm: \"h-9 px-2.5\",\n        lg: \"h-11 px-5\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\ui\\tooltip.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\components\\ui\\use-toast.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\hooks\\use-mobile.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\hooks\\use-toast.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\hooks\\useNotificationPermission.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\hooks\\useRealtimeMessages.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1945,1948],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1945,1948],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":79,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2284,2287],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2284,2287],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState, useCallback } from 'react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { Message } from '@/types/order';\nimport { useToast } from '@/hooks/use-toast';\n\nexport function useRealtimeMessages(orderId: string, customerPhone?: string) {\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [isBotPaused, setIsBotPaused] = useState(false);\n  const { toast } = useToast();\n\n  // Check bot status\n  const checkBotStatus = useCallback(async () => {\n    if (!customerPhone) return;\n    \n    const { data } = await supabase\n      .from('user_sessions')\n      .select('in_vendor_chat')\n      .eq('phone', customerPhone)\n      .maybeSingle();\n    \n    setIsBotPaused(data?.in_vendor_chat || false);\n  }, [customerPhone]);\n\n  // Pause bot when vendor sends message\n  const pauseBot = useCallback(async () => {\n    if (!customerPhone) return;\n    \n    await supabase\n      .from('user_sessions')\n      .upsert({\n        phone: customerPhone,\n        in_vendor_chat: true,\n        updated_at: new Date().toISOString()\n      }, { onConflict: 'phone' });\n    \n    setIsBotPaused(true);\n  }, [customerPhone]);\n\n  // Activate bot\n  const activateBot = useCallback(async () => {\n    if (!customerPhone) return;\n    \n    await supabase\n      .from('user_sessions')\n      .update({\n        in_vendor_chat: false,\n        assigned_vendor_phone: null,\n        updated_at: new Date().toISOString()\n      })\n      .eq('phone', customerPhone);\n    \n    setIsBotPaused(false);\n    \n    // Notify customer\n    await supabase.functions.invoke('send-whatsapp-notification', {\n      body: {\n        phoneNumber: customerPhone,\n        message: '‚úÖ El asistente virtual est√° activo nuevamente.'\n      }\n    });\n    \n    toast({ title: 'Bot reactivado', description: 'El cliente fue notificado' });\n  }, [customerPhone, toast]);\n\n  useEffect(() => {\n    let channel: any;\n\n    const fetchMessages = async () => {\n      try {\n        const { data, error } = await supabase\n          .from('messages')\n          .select('*')\n          .eq('order_id', orderId)\n          .order('created_at', { ascending: true });\n\n        if (error) throw error;\n\n        const formattedMessages: Message[] = data?.map((msg: any) => ({\n          id: msg.id,\n          orderId: msg.order_id,\n          sender: msg.sender as 'customer' | 'vendor' | 'system',\n          content: msg.content,\n          timestamp: new Date(msg.created_at),\n          isRead: msg.is_read\n        })) || [];\n\n        setMessages(formattedMessages);\n      } catch (error) {\n        console.error('Error fetching messages:', error);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    // Check initial bot status\n    checkBotStatus();\n\n    const setupRealtime = () => {\n      channel = supabase\n        .channel(`messages-${orderId}`)\n        .on(\n          'postgres_changes',\n          {\n            event: 'INSERT',\n            schema: 'public',\n            table: 'messages',\n            filter: `order_id=eq.${orderId}`\n          },\n          (payload) => {\n            console.log('New message received:', payload);\n            \n            const newMessage: Message = {\n              id: payload.new.id,\n              orderId: payload.new.order_id,\n              sender: payload.new.sender as 'customer' | 'vendor' | 'system',\n              content: payload.new.content,\n              timestamp: new Date(payload.new.created_at),\n              isRead: payload.new.is_read\n            };\n\n            setMessages(prev => [...prev, newMessage]);\n            \n            // Show notification if message is from customer\n            if (newMessage.sender === 'customer') {\n              toast({\n                title: 'üí¨ Nuevo mensaje',\n                description: newMessage.content.substring(0, 50) + '...',\n              });\n            }\n          }\n        )\n        .subscribe();\n    };\n\n    fetchMessages();\n    setupRealtime();\n\n    return () => {\n      if (channel) {\n        supabase.removeChannel(channel);\n      }\n    };\n  }, [orderId, toast, checkBotStatus]);\n\n  const sendMessage = async (content: string, sender: 'customer' | 'vendor') => {\n    try {\n      const { data, error } = await supabase\n        .from('messages')\n        .insert({\n          order_id: orderId,\n          sender,\n          content,\n          is_read: false\n        })\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      // If vendor is sending, pause bot and notify customer via WhatsApp\n      if (sender === 'vendor') {\n        console.log('Vendor sending message, fetching order and vendor data...');\n        const { data: orderData, error: orderError } = await supabase\n          .from('orders')\n          .select('customer_phone, vendor:vendors(name)')\n          .eq('id', orderId)\n          .single();\n\n        if (orderError) {\n          console.error('Error fetching order data:', orderError);\n          throw orderError;\n        }\n\n        if (orderData && orderData.customer_phone) {\n          const vendorName = orderData.vendor?.name || 'el vendedor';\n          const wasBotPaused = isBotPaused;\n          \n          // Pause the bot when vendor sends a message\n          await supabase\n            .from('user_sessions')\n            .upsert({\n              phone: orderData.customer_phone,\n              in_vendor_chat: true,\n              updated_at: new Date().toISOString()\n            }, { onConflict: 'phone' });\n          \n          setIsBotPaused(true);\n          console.log('Bot paused for customer:', orderData.customer_phone);\n          \n          // Si el bot NO estaba pausado, primero notificar que el vendedor va a responder\n          if (!wasBotPaused) {\n            console.log('Sending bot paused notification to:', orderData.customer_phone);\n            await supabase.functions.invoke('send-whatsapp-notification', {\n              body: {\n                phoneNumber: orderData.customer_phone,\n                message: `‚ö†Ô∏è *${vendorName}* va a responderte personalmente.\\n\\nü§ñ El bot est√° pausado.\\n\\n_Escrib√≠ *\"menu\"* para volver al bot._`\n              }\n            });\n          }\n          \n          // Send WhatsApp notification with vendor message\n          console.log('Sending WhatsApp notification to:', orderData.customer_phone);\n          \n          const { data: whatsappResponse, error: whatsappError } = await supabase.functions.invoke('send-whatsapp-notification', {\n            body: {\n              orderId,\n              phoneNumber: orderData.customer_phone,\n              message: `üì© Mensaje de *${vendorName}*: ${content}`\n            }\n          });\n\n          if (whatsappError) {\n            console.error('Error sending WhatsApp notification:', whatsappError);\n            toast({\n              title: 'Advertencia',\n              description: `No se pudo enviar por WhatsApp: ${whatsappError.message || 'error desconocido'}`,\n              variant: 'destructive'\n            });\n          } else if (whatsappResponse && whatsappResponse.success === false) {\n            console.error('WhatsApp API reported failure:', whatsappResponse);\n            toast({\n              title: 'Advertencia',\n              description: `No se pudo enviar por WhatsApp: ${whatsappResponse.error || 'verifica el n√∫mero o la configuraci√≥n'}`,\n              variant: 'destructive'\n            });\n          } else {\n            console.log('WhatsApp notification sent successfully:', whatsappResponse);\n            toast({\n              title: 'Mensaje enviado',\n              description: 'Bot pausado. El cliente recibir√° el mensaje por WhatsApp.',\n            });\n          }\n        } else {\n          console.error('No customer phone found for order:', orderId);\n        }\n      }\n\n      return data;\n    } catch (error) {\n      console.error('Error sending message:', error);\n      toast({\n        title: 'Error',\n        description: 'No se pudo enviar el mensaje',\n        variant: 'destructive'\n      });\n      return null;\n    }\n  };\n\n  return {\n    messages,\n    loading,\n    sendMessage,\n    isBotPaused,\n    activateBot,\n    pauseBot\n  };\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\hooks\\useRealtimeOrders.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[429,432],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[429,432],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":32,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[897,900],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[897,900],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1157,1160],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1157,1160],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":113,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4061,4064],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4061,4064],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":123,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4546,4549],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4546,4549],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'orders'. Either include it or remove the dependency array.","line":231,"column":6,"nodeType":"ArrayExpression","endLine":231,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [vendorId, toast, orders]","fix":{"range":[9498,9515],"text":"[vendorId, toast, orders]"}}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { Order, OrderStatus } from '@/types/order';\nimport { useToast } from '@/hooks/use-toast';\n\nexport function useRealtimeOrders(vendorId?: string) {\n  const [orders, setOrders] = useState<Order[]>([]);\n  const [loading, setLoading] = useState(true);\n  const { toast } = useToast();\n\n  useEffect(() => {\n    let channel: any;\n\n    const fetchOrders = async () => {\n      try {\n        let query = supabase\n          .from('orders')\n          .select(`\n            *,\n            vendor:vendors(*)\n          `)\n          .order('created_at', { ascending: false });\n\n        if (vendorId) {\n          query = query.eq('vendor_id', vendorId);\n        }\n\n        const { data, error } = await query;\n\n        if (error) throw error;\n\n        const formattedOrders: Order[] = data?.map((order: any) => ({\n          id: order.id,\n          customerName: order.customer_name,\n          customerPhone: order.customer_phone,\n          vendorId: order.vendor_id,\n          vendorName: order.vendor?.name || '',\n          items: (order.items || []).map((item: any) => ({\n            id: item.product_id || item.id,\n            name: item.product_name || item.name,\n            quantity: item.quantity,\n            price: Number(item.price),\n            notes: item.notes\n          })),\n          total: Number(order.total),\n          status: order.status as OrderStatus,\n          address: order.address,\n          coordinates: order.coordinates,\n          estimatedDelivery: order.estimated_delivery ? new Date(order.estimated_delivery) : undefined,\n          createdAt: new Date(order.created_at),\n          updatedAt: new Date(order.updated_at),\n          notes: order.notes,\n          deliveryPersonName: order.delivery_person_name,\n          deliveryPersonPhone: order.delivery_person_phone,\n          payment_receipt_url: order.payment_receipt_url,\n          address_is_manual: order.address_is_manual || false,\n          payment_status: order.payment_status,\n          payment_method: order.payment_method,\n          paid_at: order.paid_at ? new Date(order.paid_at) : undefined,\n          delivery_type: (order.delivery_type as 'delivery' | 'pickup') || 'delivery',\n          // Masked fields for vendor view\n          customerNameMasked: order.customer_name?.substring(0, 3) + '***',\n          customerPhoneMasked: '****' + order.customer_phone?.slice(-4),\n          addressSimplified: order.address?.split(',')[0]\n        })) || [];\n\n        setOrders(formattedOrders);\n      } catch (error) {\n        console.error('Error fetching orders:', error);\n        toast({\n          title: 'Error',\n          description: 'No se pudieron cargar los pedidos',\n          variant: 'destructive'\n        });\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    const setupRealtime = () => {\n      channel = supabase\n        .channel('orders-channel')\n        .on(\n          'postgres_changes',\n          {\n            event: '*',\n            schema: 'public',\n            table: 'orders',\n            ...(vendorId && { filter: `vendor_id=eq.${vendorId}` })\n          },\n          async (payload) => {\n            console.log('Order change received:', payload);\n            \n            if (payload.eventType === 'INSERT') {\n              // Fetch the complete order with vendor info\n              const { data } = await supabase\n                .from('orders')\n                .select(`\n                  *,\n                  vendor:vendors(*)\n                `)\n                .eq('id', payload.new.id)\n                .single();\n\n              if (data) {\n                const items = Array.isArray(data.items) ? data.items : [];\n                const newOrder: Order = {\n                  id: data.id,\n                  customerName: data.customer_name,\n                  customerPhone: data.customer_phone,\n                  vendorId: data.vendor_id,\n                  vendorName: data.vendor?.name || '',\n                  items: items.map((item: any) => ({\n                    id: item.product_id || item.id,\n                    name: item.product_name || item.name,\n                    quantity: item.quantity,\n                    price: Number(item.price),\n                    notes: item.notes\n                  })),\n                  total: Number(data.total),\n                  status: data.status as OrderStatus,\n                  address: data.address,\n                  coordinates: data.coordinates ? (data.coordinates as any) : undefined,\n                  estimatedDelivery: data.estimated_delivery ? new Date(data.estimated_delivery) : undefined,\n                  createdAt: new Date(data.created_at),\n                  updatedAt: new Date(data.updated_at),\n                  notes: data.notes,\n                  deliveryPersonName: data.delivery_person_name,\n                  deliveryPersonPhone: data.delivery_person_phone,\n                  payment_receipt_url: data.payment_receipt_url,\n                  address_is_manual: data.address_is_manual || false,\n                  payment_status: data.payment_status,\n                  payment_method: data.payment_method as 'efectivo' | 'transferencia' | 'mercadopago' | undefined,\n                  paid_at: data.paid_at ? new Date(data.paid_at) : undefined,\n                  delivery_type: (data.delivery_type as 'delivery' | 'pickup') || 'delivery',\n                  customerNameMasked: data.customer_name?.substring(0, 3) + '***',\n                  customerPhoneMasked: '****' + data.customer_phone?.slice(-4),\n                  addressSimplified: data.address?.split(',')[0]\n                };\n\n                setOrders(prev => [newOrder, ...prev]);\n                \n                // Insertar notificaci√≥n en la tabla de historial\n                // Esto disparar√° el realtime para el NotificationCenter\n                await supabase.from('vendor_notification_history').insert({\n                  vendor_id: newOrder.vendorId,\n                  type: 'new_order',\n                  title: 'Nuevo Pedido',\n                  message: `Pedido #${newOrder.id.slice(0, 8)} - $${newOrder.total.toLocaleString()}`,\n                  data: { order_id: newOrder.id, total: newOrder.total }\n                });\n\n                toast({\n                  title: 'üÜï NUEVO PEDIDO INGRESADO',\n                  description: `Pedido #${newOrder.id.slice(0, 8)} - $${newOrder.total.toFixed(2)}`,\n                  duration: 10000,\n                });\n              }\n            } else if (payload.eventType === 'UPDATE') {\n              const oldOrder = orders.find(o => o.id === payload.new.id);\n              const newStatus = payload.new.status as OrderStatus;\n              \n              setOrders(prev => prev.map(order => \n                order.id === payload.new.id\n                  ? {\n                      ...order,\n                      status: newStatus,\n                      updatedAt: new Date(payload.new.updated_at),\n                      deliveryPersonName: payload.new.delivery_person_name,\n                      deliveryPersonPhone: payload.new.delivery_person_phone,\n                      notes: payload.new.notes,\n                      payment_status: payload.new.payment_status,\n                      payment_method: payload.new.payment_method,\n                      paid_at: payload.new.paid_at ? new Date(payload.new.paid_at) : undefined\n                    }\n                  : order\n              ));\n\n              // Crear notificaciones seg√∫n el tipo de cambio\n              if (oldOrder && oldOrder.status !== newStatus) {\n                let notificationType: 'order_cancelled' | 'order_updated' | 'payment_received' = 'order_updated';\n                let title = 'Pedido Actualizado';\n                let message = `Estado cambiado a ${newStatus}`;\n\n                if (newStatus === 'cancelled') {\n                  notificationType = 'order_cancelled';\n                  title = 'Pedido Cancelado';\n                  message = `El pedido #${payload.new.id.slice(0, 8)} fue cancelado`;\n                }\n\n                await supabase.from('vendor_notification_history').insert({\n                  vendor_id: payload.new.vendor_id,\n                  type: notificationType,\n                  title,\n                  message,\n                  data: { order_id: payload.new.id, status: newStatus }\n                });\n              }\n\n              // Notificaci√≥n de pago recibido\n              if (oldOrder && oldOrder.payment_status !== 'paid' && payload.new.payment_status === 'paid') {\n                await supabase.from('vendor_notification_history').insert({\n                  vendor_id: payload.new.vendor_id,\n                  type: 'payment_received',\n                  title: 'Pago Recibido',\n                  message: `Se recibi√≥ el pago del pedido #${payload.new.id.slice(0, 8)}`,\n                  data: { order_id: payload.new.id }\n                });\n              }\n\n              toast({\n                title: '‚úÖ Pedido actualizado',\n                description: `Estado cambiado a ${newStatus}`,\n              });\n            } else if (payload.eventType === 'DELETE') {\n              setOrders(prev => prev.filter(order => order.id !== payload.old.id));\n            }\n          }\n        )\n        .subscribe();\n    };\n\n    fetchOrders();\n    setupRealtime();\n\n    return () => {\n      if (channel) {\n        supabase.removeChannel(channel);\n      }\n    };\n  }, [vendorId, toast]);\n\n  const updateOrderStatus = async (orderId: string, newStatus: OrderStatus) => {\n    try {\n      // Primero verificar el estado actual\n      const currentOrder = orders.find(o => o.id === orderId);\n      if (!currentOrder) {\n        throw new Error('Pedido no encontrado');\n      }\n\n      // Evitar actualizar al mismo estado\n      if (currentOrder.status === newStatus) {\n        console.log(`Pedido ya est√° en estado ${newStatus}, ignorando actualizaci√≥n`);\n        return;\n      }\n\n      // Actualizar localmente primero para feedback inmediato\n      setOrders(prev => prev.map(order => \n        order.id === orderId\n          ? { ...order, status: newStatus, updatedAt: new Date() }\n          : order\n      ));\n\n      const { error } = await supabase\n        .from('orders')\n        .update({ \n          status: newStatus,\n          updated_at: new Date().toISOString()\n        })\n        .eq('id', orderId);\n\n      if (error) throw error;\n\n      // Notificar al vendedor si el pedido fue cancelado\n      if (newStatus === 'cancelled') {\n        supabase.functions.invoke('notify-vendor', {\n          body: {\n            orderId,\n            eventType: 'order_cancelled'\n          }\n        }).then(({ data, error }) => {\n          if (error) {\n            console.error('Error sending vendor cancellation notification:', error);\n          } else {\n            console.log('Vendor cancellation notification sent:', data);\n          }\n        });\n      }\n\n      // Send WhatsApp notification to customer\n      const statusMessages = {\n        confirmed: 'confirmado',\n        preparing: 'est√° siendo preparado',\n        ready: 'est√° listo',\n        delivering: 'est√° en camino',\n        delivered: 'ha sido entregado',\n        cancelled: 'ha sido cancelado'\n      };\n\n      const isPickup = currentOrder.delivery_type === 'pickup';\n      const statusDescriptions = {\n        confirmed: 'El vendedor est√° preparando tu pedido.',\n        preparing: 'Tu pedido est√° siendo preparado.',\n        ready: isPickup \n          ? 'Tu pedido est√° listo para retirar en el local.' \n          : 'Tu pedido est√° listo para entrega.',\n        delivering: 'Tu pedido est√° en camino.',\n        delivered: isPickup\n          ? '¬°Gracias por retirarlo!'\n          : '¬°Gracias por tu compra!',\n        cancelled: 'Si tienes alguna duda, contacta al vendedor.'\n      };\n\n      let notificationMessage = `Tu pedido #${orderId.slice(0, 8)} ${statusMessages[newStatus as keyof typeof statusMessages]}. ${statusDescriptions[newStatus as keyof typeof statusDescriptions]}`;\n      \n      // Si el estado es delivered, enviar mensaje con prompt de calificaci√≥n\n      if (newStatus === 'delivered') {\n        // Actualizar sesi√≥n del usuario para que est√© en modo RATING_ORDER\n        await supabase\n          .from('user_sessions')\n          .upsert({\n            phone: currentOrder.customerPhone,\n            previous_state: 'RATING_ORDER',\n            last_bot_message: JSON.stringify({\n              selected_vendor_id: currentOrder.vendorId,\n              pending_order_id: orderId\n            }),\n            updated_at: new Date().toISOString()\n          }, { onConflict: 'phone' });\n        \n        // Enviar mensaje de entrega con prompt de calificaci√≥n\n        notificationMessage = `üéâ ¬°Tu pedido #${orderId.slice(0, 8)} ha sido entregado! \n\n¬°Esperamos que lo disfrutes! üçΩÔ∏è\n\nüìù *¬øQuer√©s calificar tu experiencia?*\nTu opini√≥n nos ayuda a mejorar.\n\nPod√©s calificar:\n‚è±Ô∏è Tiempo de entrega (1-5 estrellas)\nüë• Atenci√≥n del negocio (1-5 estrellas)\nüì¶ Calidad del producto (1-5 estrellas)\n\nSolo escrib√≠ \"quiero calificar\" o \"calificar\" cuando quieras hacerlo. Es opcional üòä`;\n      }\n\n      await supabase.functions.invoke('send-whatsapp-notification', {\n        body: {\n          orderId,\n          phoneNumber: currentOrder.customerPhone,\n          message: notificationMessage\n        }\n      });\n\n      toast({\n        title: 'Estado actualizado',\n        description: `El pedido ha sido marcado como ${newStatus}`,\n      });\n    } catch (error) {\n      console.error('Error updating order status:', error);\n      // Refrescar desde la base de datos para obtener el estado correcto\n      const { data } = await supabase\n        .from('orders')\n        .select(`\n          *,\n          vendor:vendors(*)\n        `)\n        .eq('id', orderId)\n        .single();\n      \n      if (data) {\n        setOrders(prev => prev.map(order => \n          order.id === orderId\n            ? {\n                ...order,\n                status: data.status as OrderStatus,\n                updatedAt: new Date(data.updated_at)\n              }\n            : order\n        ));\n      }\n      \n      toast({\n        title: 'Error',\n        description: 'No se pudo actualizar el estado del pedido',\n        variant: 'destructive'\n      });\n    }\n  };\n\n  return {\n    orders,\n    loading,\n    updateOrderStatus\n  };\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\hooks\\useVendorNotifications.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\integrations\\supabase\\client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\integrations\\supabase\\database.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\integrations\\supabase\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\lib\\paymentValidation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\lib\\timezone.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\pages\\Admin.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'checkAdminAccess'. Either include it or remove the dependency array.","line":60,"column":6,"nodeType":"ArrayExpression","endLine":60,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [checkAdminAccess]","fix":{"range":[2832,2834],"text":"[checkAdminAccess]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { \n  Store, DollarSign, BarChart3, LogOut, Headphones, Bot, Star, \n  TrendingUp, Users, Wrench, AlertTriangle, Menu, FileText \n} from \"lucide-react\";\nimport {\n  Sheet,\n  SheetContent,\n  SheetHeader,\n  SheetTitle,\n  SheetTrigger,\n} from \"@/components/ui/sheet\";\nimport VendorManagement from \"@/components/admin/VendorManagement\";\nimport CommissionManagement from \"@/components/admin/CommissionManagement\";\nimport CommissionReports from \"@/components/admin/CommissionReports\";\nimport SupportPanel from \"@/components/admin/SupportPanel\";\nimport SoporteUserManagement from \"@/components/admin/SoporteUserManagement\";\nimport { PlatformReviewsPanel } from \"@/components/admin/PlatformReviewsPanel\";\nimport { PWAInstallPrompt } from \"@/components/PWAInstallPrompt\";\nimport { EvolutionConfig } from \"@/components/EvolutionConfig\";\nimport AdminPaymentMetrics from \"@/components/admin/AdminPaymentMetrics\";\nimport CommissionInvoiceGenerator from \"@/components/admin/CommissionInvoiceGenerator\";\nimport { VendorChangeAnalytics } from \"@/components/admin/VendorChangeAnalytics\";\nimport PharmacyProductLoader from \"@/components/admin/PharmacyProductLoader\";\nimport EmergencyControl from \"@/components/admin/EmergencyControl\";\nimport lapachoLogo from \"@/assets/lapacho-logo.png\";\nimport lapachoIcon from \"@/assets/lapacho-icon.png\";\nimport { cn } from \"@/lib/utils\";\n\nconst menuItems = [\n  { value: \"vendors\", label: \"Negocios\", icon: Store },\n  { value: \"commissions\", label: \"Comisiones\", icon: DollarSign },\n  { value: \"metrics\", label: \"M√©tricas\", icon: BarChart3 },\n  { value: \"analytics\", label: \"Analytics\", icon: TrendingUp },\n  { value: \"invoices\", label: \"Facturaci√≥n\", icon: FileText },\n  { value: \"reports\", label: \"Reportes\", icon: BarChart3 },\n  { value: \"reviews\", label: \"Rese√±as\", icon: Star },\n  { value: \"support\", label: \"Tickets Soporte\", icon: Headphones },\n  { value: \"soporte-users\", label: \"Usuarios Soporte\", icon: Users },\n  { value: \"evolution\", label: \"Agente IA\", icon: Bot },\n  { value: \"emergency\", label: \"Emergencia\", icon: AlertTriangle, danger: true },\n  { value: \"tools\", label: \"Herramientas\", icon: Wrench },\n];\n\nexport default function Admin() {\n  const [loading, setLoading] = useState(true);\n  const [isAdmin, setIsAdmin] = useState(false);\n  const [activeTab, setActiveTab] = useState(\"vendors\");\n  const [drawerOpen, setDrawerOpen] = useState(false);\n  const navigate = useNavigate();\n  const { toast } = useToast();\n\n  useEffect(() => {\n    checkAdminAccess();\n  }, []);\n\n  const checkAdminAccess = async () => {\n    try {\n      const { data: { session } } = await supabase.auth.getSession();\n      \n      if (!session) {\n        navigate('/admin-auth');\n        return;\n      }\n\n      const { data: roles, error } = await supabase\n        .from('user_roles')\n        .select('role')\n        .eq('user_id', session.user.id)\n        .eq('role', 'admin')\n        .single();\n\n      if (error || !roles) {\n        toast({\n          title: \"Acceso denegado\",\n          description: \"No tienes permisos de administrador\",\n          variant: \"destructive\",\n        });\n        navigate('/');\n        return;\n      }\n\n      setIsAdmin(true);\n    } catch (error) {\n      console.error('Error checking admin access:', error);\n      navigate('/admin-auth');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSignOut = async () => {\n    await supabase.auth.signOut();\n    navigate('/admin-auth');\n  };\n\n  const handleMenuItemClick = (value: string) => {\n    setActiveTab(value);\n    setDrawerOpen(false);\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto\"></div>\n          <p className=\"mt-4 text-muted-foreground\">Verificando acceso...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!isAdmin) return null;\n\n  const currentMenuItem = menuItems.find(item => item.value === activeTab);\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <PWAInstallPrompt userType=\"admin\" />\n      <header className=\"border-b bg-card sticky top-0 z-50\">\n        <div className=\"container mx-auto px-4 py-4 flex justify-between items-center\">\n          <div className=\"flex items-center gap-3\">\n            {/* Bot√≥n hamburguesa - solo m√≥vil */}\n            <Sheet open={drawerOpen} onOpenChange={setDrawerOpen}>\n              <SheetTrigger asChild className=\"lg:hidden\">\n                <Button variant=\"ghost\" size=\"icon\">\n                  <Menu className=\"h-5 w-5\" />\n                </Button>\n              </SheetTrigger>\n              <SheetContent side=\"left\" className=\"w-72\">\n                <SheetHeader>\n                  <SheetTitle className=\"flex items-center gap-2\">\n                    <img src={lapachoIcon} alt=\"Lapacho\" className=\"h-6\" />\n                    Panel Admin\n                  </SheetTitle>\n                </SheetHeader>\n                <nav className=\"mt-6 flex flex-col gap-1\">\n                  {menuItems.map((item) => (\n                    <Button\n                      key={item.value}\n                      variant={activeTab === item.value ? \"secondary\" : \"ghost\"}\n                      className={cn(\n                        \"justify-start w-full\",\n                        item.danger && activeTab === item.value && \"bg-orange-500 text-white hover:bg-orange-600\",\n                        item.danger && activeTab !== item.value && \"text-orange-600 hover:text-orange-700 hover:bg-orange-50\"\n                      )}\n                      onClick={() => handleMenuItemClick(item.value)}\n                    >\n                      <item.icon className=\"mr-3 h-4 w-4\" />\n                      {item.label}\n                    </Button>\n                  ))}\n                </nav>\n              </SheetContent>\n            </Sheet>\n\n            {/* Logo */}\n            <img src={lapachoIcon} alt=\"Lapacho\" className=\"h-8 lg:hidden\" />\n            <img src={lapachoLogo} alt=\"Lapacho Logo\" className=\"h-10 hidden lg:block\" />\n          </div>\n\n          <Button onClick={handleSignOut} variant=\"outline\" size=\"sm\">\n            <LogOut className=\"mr-2 h-4 w-4\" />\n            <span className=\"hidden sm:inline\">Cerrar Sesi√≥n</span>\n          </Button>\n        </div>\n      </header>\n\n      <main className=\"container mx-auto px-4 py-8\">\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n          {/* TabsList solo visible en desktop */}\n          <TabsList className=\"hidden lg:grid w-full grid-cols-12 mb-8\">\n            {menuItems.map((item) => (\n              <TabsTrigger\n                key={item.value}\n                value={item.value}\n                className={cn(\n                  item.danger && \"data-[state=active]:bg-orange-500 data-[state=active]:text-white\"\n                )}\n              >\n                <item.icon className=\"mr-2 h-4 w-4\" />\n                <span className=\"hidden xl:inline\">{item.label}</span>\n              </TabsTrigger>\n            ))}\n          </TabsList>\n\n          {/* Indicador de secci√≥n actual en m√≥vil */}\n          {currentMenuItem && (\n            <div className=\"lg:hidden mb-4 flex items-center gap-2 px-1\">\n              <currentMenuItem.icon className={cn(\n                \"h-5 w-5\",\n                currentMenuItem.danger ? \"text-orange-500\" : \"text-primary\"\n              )} />\n              <h2 className=\"text-lg font-semibold\">{currentMenuItem.label}</h2>\n            </div>\n          )}\n\n          <TabsContent value=\"vendors\">\n            <VendorManagement />\n          </TabsContent>\n\n          <TabsContent value=\"commissions\">\n            <CommissionManagement />\n          </TabsContent>\n\n          <TabsContent value=\"metrics\">\n            <AdminPaymentMetrics />\n          </TabsContent>\n\n          <TabsContent value=\"analytics\">\n            <VendorChangeAnalytics />\n          </TabsContent>\n\n          <TabsContent value=\"invoices\">\n            <CommissionInvoiceGenerator />\n          </TabsContent>\n\n          <TabsContent value=\"reports\">\n            <CommissionReports />\n          </TabsContent>\n\n          <TabsContent value=\"reviews\">\n            <PlatformReviewsPanel />\n          </TabsContent>\n\n          <TabsContent value=\"support\">\n            <SupportPanel />\n          </TabsContent>\n\n          <TabsContent value=\"soporte-users\">\n            <SoporteUserManagement />\n          </TabsContent>\n\n          <TabsContent value=\"evolution\">\n            <EvolutionConfig />\n          </TabsContent>\n\n          <TabsContent value=\"emergency\">\n            <EmergencyControl />\n          </TabsContent>\n\n          <TabsContent value=\"tools\">\n            <div className=\"space-y-6\">\n              <h2 className=\"text-2xl font-bold\">Herramientas de Administraci√≥n</h2>\n              <PharmacyProductLoader />\n            </div>\n          </TabsContent>\n        </Tabs>\n      </main>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\pages\\AdminAuth.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'checkAuth'. Either include it or remove the dependency array.","line":21,"column":6,"nodeType":"ArrayExpression","endLine":21,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [checkAuth]","fix":{"range":[820,822],"text":"[checkAuth]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":59,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1774,1777],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1774,1777],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":103,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2941,2944],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2941,2944],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Lock } from \"lucide-react\";\nimport lapachoIcon from \"@/assets/lapacho-icon.png\";\n\nexport default function AdminAuth() {\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n  const [isSignUp, setIsSignUp] = useState(false);\n  const navigate = useNavigate();\n  const { toast } = useToast();\n\n  useEffect(() => {\n    checkAuth();\n  }, []);\n\n  const checkAuth = async () => {\n    const { data: { session } } = await supabase.auth.getSession();\n    if (session) {\n      // Check if user is admin\n      const { data: roles } = await supabase\n        .from('user_roles')\n        .select('role')\n        .eq('user_id', session.user.id)\n        .eq('role', 'admin')\n        .single();\n      \n      if (roles) {\n        navigate('/admin');\n      }\n    }\n  };\n\n  const handleSignUp = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n\n    try {\n      const { data: { user }, error: signUpError } = await supabase.auth.signUp({\n        email,\n        password,\n      });\n\n      if (signUpError) throw signUpError;\n\n      if (user) {\n        toast({\n          title: \"Cuenta creada\",\n          description: \"Ahora ve al SQL Editor de Supabase y ejecuta: SELECT public.make_user_admin('\" + email + \"');\",\n          duration: 10000,\n        });\n      }\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSignIn = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n\n    try {\n      const { data: { user }, error: signInError } = await supabase.auth.signInWithPassword({\n        email,\n        password,\n      });\n\n      if (signInError) throw signInError;\n\n      if (user) {\n        // Check if user has admin role\n        const { data: roles, error: roleError } = await supabase\n          .from('user_roles')\n          .select('role')\n          .eq('user_id', user.id)\n          .eq('role', 'admin')\n          .single();\n\n        if (roleError || !roles) {\n          await supabase.auth.signOut();\n          throw new Error('No tienes permisos de administrador. Ejecuta: SELECT public.make_user_admin(\\'' + email + '\\'); en el SQL Editor');\n        }\n\n        toast({\n          title: \"Inicio de sesi√≥n exitoso\",\n          description: \"Bienvenido al panel de administraci√≥n\",\n        });\n        \n        navigate('/admin');\n      }\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-background p-4\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader className=\"space-y-1\">\n          <div className=\"flex items-center justify-center mb-6\">\n            <img src={lapachoIcon} alt=\"Lapacho\" className=\"h-20 w-auto\" />\n          </div>\n          <CardTitle className=\"text-2xl text-center\">Panel de Administraci√≥n</CardTitle>\n          <CardDescription className=\"text-center\">\n            Acceso exclusivo para administradores\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={isSignUp ? handleSignUp : handleSignIn} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Input\n                type=\"email\"\n                placeholder=\"Email\"\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n                required\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Input\n                type=\"password\"\n                placeholder=\"Contrase√±a\"\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                required\n                minLength={6}\n              />\n            </div>\n            <Button type=\"submit\" className=\"w-full\" disabled={loading}>\n              {loading ? \"Procesando...\" : (isSignUp ? \"Crear Cuenta Admin\" : \"Iniciar Sesi√≥n\")}\n            </Button>\n            <div className=\"text-center\">\n              <Button\n                type=\"button\"\n                variant=\"link\"\n                onClick={() => setIsSignUp(!isSignUp)}\n                className=\"text-sm\"\n              >\n                {isSignUp ? \"¬øYa tienes cuenta? Inicia sesi√≥n\" : \"¬øPrimera vez? Crea tu cuenta admin\"}\n              </Button>\n            </div>\n          </form>\n          \n          {isSignUp && (\n            <div className=\"mt-4 p-4 bg-muted rounded-lg text-sm\">\n              <p className=\"font-medium mb-2\">Despu√©s de crear tu cuenta:</p>\n              <ol className=\"list-decimal list-inside space-y-1 text-muted-foreground\">\n                <li>Ve al SQL Editor de Supabase</li>\n                <li>Ejecuta: <code className=\"bg-background px-1 py-0.5 rounded\">SELECT public.make_user_admin('tu-email@ejemplo.com');</code></li>\n                <li>Regresa aqu√≠ e inicia sesi√≥n</li>\n              </ol>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\pages\\Ayuda.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\pages\\BrandAssets.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'checkAdminAccess'. Either include it or remove the dependency array.","line":64,"column":6,"nodeType":"ArrayExpression","endLine":64,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [checkAdminAccess]","fix":{"range":[1769,1771],"text":"[checkAdminAccess]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Download, Sun, Moon, ArrowLeft, Loader2 } from \"lucide-react\";\nimport { Link } from \"react-router-dom\";\nimport { supabase } from \"@/integrations/supabase/client\";\n\ninterface LogoVariant {\n  name: string;\n  description: string;\n  lightSvg: string;\n  darkSvg: string;\n  width: number;\n  height: number;\n}\n\nconst logoVariants: LogoVariant[] = [\n  {\n    name: \"Logo Icon\",\n    description: \"Solo el √≠cono de la hoja\",\n    lightSvg: \"/brand/logo-icon-light.svg\",\n    darkSvg: \"/brand/logo-icon-dark.svg\",\n    width: 512,\n    height: 512,\n  },\n  {\n    name: \"Logo + Texto\",\n    description: \"√çcono con el nombre Lapacho\",\n    lightSvg: \"/brand/logo-text-light.svg\",\n    darkSvg: \"/brand/logo-text-dark.svg\",\n    width: 400,\n    height: 100,\n  },\n  {\n    name: \"Logo Completo\",\n    description: \"√çcono, nombre y slogan\",\n    lightSvg: \"/brand/logo-full-light.svg\",\n    darkSvg: \"/brand/logo-full-dark.svg\",\n    width: 400,\n    height: 120,\n  },\n  {\n    name: \"Wordmark\",\n    description: \"Solo el texto Lapacho\",\n    lightSvg: \"/brand/wordmark-light.svg\",\n    darkSvg: \"/brand/wordmark-dark.svg\",\n    width: 300,\n    height: 80,\n  },\n];\n\nconst pngSizes = [64, 128, 256, 512, 1024];\n\nconst BrandAssets = () => {\n  const navigate = useNavigate();\n  const [downloading, setDownloading] = useState<string | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [isAdmin, setIsAdmin] = useState(false);\n\n  useEffect(() => {\n    checkAdminAccess();\n  }, []);\n\n  const checkAdminAccess = async () => {\n    try {\n      const { data: { session } } = await supabase.auth.getSession();\n      \n      if (!session) {\n        navigate('/admin-auth');\n        return;\n      }\n\n      const { data: roles } = await supabase\n        .from('user_roles')\n        .select('role')\n        .eq('user_id', session.user.id)\n        .eq('role', 'admin')\n        .single();\n\n      if (!roles) {\n        navigate('/admin');\n        return;\n      }\n      \n      setIsAdmin(true);\n      setLoading(false);\n    } catch (error) {\n      console.error('Error checking admin access:', error);\n      navigate('/admin-auth');\n    }\n  };\n\n  const downloadSvg = (url: string, filename: string) => {\n    const link = document.createElement(\"a\");\n    link.href = url;\n    link.download = filename;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  };\n\n  const downloadPng = async (svgUrl: string, filename: string, width: number, height: number, targetSize: number, isDark: boolean) => {\n    setDownloading(`${filename}-${targetSize}`);\n    \n    try {\n      // Construir URL completa para evitar 404 en producci√≥n\n      const fullUrl = svgUrl.startsWith('/') \n        ? `${window.location.origin}${svgUrl}` \n        : svgUrl;\n      const response = await fetch(fullUrl);\n      const svgText = await response.text();\n      \n      const canvas = document.createElement(\"canvas\");\n      // Make it square with padding\n      canvas.width = targetSize;\n      canvas.height = targetSize;\n      \n      const ctx = canvas.getContext(\"2d\");\n      if (!ctx) return;\n      \n      // Fill background based on theme\n      ctx.fillStyle = isDark ? \"#1A1A1A\" : \"#FFFFFF\";\n      ctx.fillRect(0, 0, canvas.width, canvas.height);\n      \n      const img = new Image();\n      const svgBlob = new Blob([svgText], { type: \"image/svg+xml;charset=utf-8\" });\n      const svgBlobUrl = URL.createObjectURL(svgBlob);\n      \n      img.onload = () => {\n        // Calculate size with padding (80% of canvas, centered)\n        const padding = targetSize * 0.1;\n        const availableSize = targetSize - (padding * 2);\n        const scale = Math.min(availableSize / width, availableSize / height);\n        const scaledWidth = width * scale;\n        const scaledHeight = height * scale;\n        const x = (targetSize - scaledWidth) / 2;\n        const y = (targetSize - scaledHeight) / 2;\n        \n        ctx.drawImage(img, x, y, scaledWidth, scaledHeight);\n        URL.revokeObjectURL(svgBlobUrl);\n        \n        canvas.toBlob((blob) => {\n          if (blob) {\n            const link = document.createElement(\"a\");\n            link.href = URL.createObjectURL(blob);\n            link.download = `${filename}-${targetSize}px.png`;\n            document.body.appendChild(link);\n            link.click();\n            document.body.removeChild(link);\n            URL.revokeObjectURL(link.href);\n          }\n          setDownloading(null);\n        }, \"image/png\");\n      };\n      \n      img.src = svgBlobUrl;\n    } catch (error) {\n      console.error(\"Error downloading PNG:\", error);\n      setDownloading(null);\n    }\n  };\n\n  const downloadAllAsZip = async () => {\n    for (const variant of logoVariants) {\n      const lightName = variant.lightSvg.split(\"/\").pop()?.replace(\".svg\", \"\") || \"\";\n      const darkName = variant.darkSvg.split(\"/\").pop()?.replace(\".svg\", \"\") || \"\";\n      downloadSvg(variant.lightSvg, `${lightName}.svg`);\n      await new Promise(resolve => setTimeout(resolve, 300));\n      downloadSvg(variant.darkSvg, `${darkName}.svg`);\n      await new Promise(resolve => setTimeout(resolve, 300));\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  if (!isAdmin) {\n    return null;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <header className=\"border-b border-border bg-card/50 backdrop-blur-sm sticky top-0 z-50\">\n        <div className=\"container mx-auto px-4 py-4\">\n          <div className=\"flex items-center justify-between\">\n            <Link to=\"/admin\" className=\"flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors\">\n              <ArrowLeft className=\"h-5 w-5\" />\n              <span>Volver al Admin</span>\n            </Link>\n            <h1 className=\"text-xl font-semibold text-foreground\">Brand Assets</h1>\n            <Button onClick={downloadAllAsZip} variant=\"outline\" size=\"sm\">\n              <Download className=\"h-4 w-4 mr-2\" />\n              Descargar Todo (SVG)\n            </Button>\n          </div>\n        </div>\n      </header>\n\n      {/* Main Content */}\n      <main className=\"container mx-auto px-4 py-8\">\n        {/* Brand Colors Section */}\n        <section className=\"mb-12\">\n          <h2 className=\"text-2xl font-semibold mb-4 text-foreground\">Colores de Marca</h2>\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n            <div className=\"rounded-lg overflow-hidden border border-border\">\n              <div className=\"h-24 bg-[#E878A8]\"></div>\n              <div className=\"p-3 bg-card\">\n                <p className=\"font-medium text-foreground\">Rosa Lapacho</p>\n                <p className=\"text-sm text-muted-foreground\">#E878A8</p>\n              </div>\n            </div>\n            <div className=\"rounded-lg overflow-hidden border border-border\">\n              <div className=\"h-24 bg-[#D45A8A]\"></div>\n              <div className=\"p-3 bg-card\">\n                <p className=\"font-medium text-foreground\">Rosa Oscuro</p>\n                <p className=\"text-sm text-muted-foreground\">#D45A8A</p>\n              </div>\n            </div>\n            <div className=\"rounded-lg overflow-hidden border border-border\">\n              <div className=\"h-24 bg-[#1A1A1A]\"></div>\n              <div className=\"p-3 bg-card\">\n                <p className=\"font-medium text-foreground\">Negro</p>\n                <p className=\"text-sm text-muted-foreground\">#1A1A1A</p>\n              </div>\n            </div>\n            <div className=\"rounded-lg overflow-hidden border border-border\">\n              <div className=\"h-24 bg-white border-b border-border\"></div>\n              <div className=\"p-3 bg-card\">\n                <p className=\"font-medium text-foreground\">Blanco</p>\n                <p className=\"text-sm text-muted-foreground\">#FFFFFF</p>\n              </div>\n            </div>\n          </div>\n        </section>\n\n        {/* Logo Variants */}\n        <section>\n          <h2 className=\"text-2xl font-semibold mb-6 text-foreground\">Variantes del Logo</h2>\n          \n          <div className=\"grid gap-8\">\n            {logoVariants.map((variant) => (\n              <Card key={variant.name} className=\"overflow-hidden\">\n                <CardHeader>\n                  <CardTitle className=\"flex items-center justify-between\">\n                    <div>\n                      <span className=\"text-foreground\">{variant.name}</span>\n                      <p className=\"text-sm font-normal text-muted-foreground mt-1\">{variant.description}</p>\n                    </div>\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <Tabs defaultValue=\"light\" className=\"w-full\">\n                    <TabsList className=\"mb-4\">\n                      <TabsTrigger value=\"light\" className=\"gap-2\">\n                        <Sun className=\"h-4 w-4\" />\n                        Tema Claro\n                      </TabsTrigger>\n                      <TabsTrigger value=\"dark\" className=\"gap-2\">\n                        <Moon className=\"h-4 w-4\" />\n                        Tema Oscuro\n                      </TabsTrigger>\n                    </TabsList>\n                    \n                    <TabsContent value=\"light\">\n                      <div className=\"space-y-4\">\n                        {/* Preview */}\n                        <div className=\"bg-white border border-border rounded-lg p-8 flex items-center justify-center min-h-[200px]\">\n                          <img \n                            src={variant.lightSvg} \n                            alt={`${variant.name} - Tema Claro`}\n                            className=\"max-w-full max-h-32 object-contain\"\n                          />\n                        </div>\n                        \n                        {/* Download Options */}\n                        <div className=\"flex flex-wrap gap-2\">\n                          <Button \n                            variant=\"default\" \n                            size=\"sm\"\n                            onClick={() => downloadSvg(variant.lightSvg, `lapacho-${variant.name.toLowerCase().replace(/\\s+/g, '-')}-light.svg`)}\n                          >\n                            <Download className=\"h-4 w-4 mr-2\" />\n                            SVG\n                          </Button>\n                          {pngSizes.map((size) => (\n                            <Button\n                              key={size}\n                              variant=\"outline\"\n                              size=\"sm\"\n                              disabled={downloading === `${variant.name}-light-${size}`}\n                            onClick={() => downloadPng(\n                                variant.lightSvg,\n                                `lapacho-${variant.name.toLowerCase().replace(/\\s+/g, '-')}-light`,\n                                variant.width,\n                                variant.height,\n                                size,\n                                false\n                              )}\n                            >\n                              <Download className=\"h-4 w-4 mr-2\" />\n                              PNG {size}px\n                            </Button>\n                          ))}\n                        </div>\n                      </div>\n                    </TabsContent>\n                    \n                    <TabsContent value=\"dark\">\n                      <div className=\"space-y-4\">\n                        {/* Preview */}\n                        <div className=\"bg-[#1A1A1A] border border-border rounded-lg p-8 flex items-center justify-center min-h-[200px]\">\n                          <img \n                            src={variant.darkSvg} \n                            alt={`${variant.name} - Tema Oscuro`}\n                            className=\"max-w-full max-h-32 object-contain\"\n                          />\n                        </div>\n                        \n                        {/* Download Options */}\n                        <div className=\"flex flex-wrap gap-2\">\n                          <Button \n                            variant=\"default\" \n                            size=\"sm\"\n                            onClick={() => downloadSvg(variant.darkSvg, `lapacho-${variant.name.toLowerCase().replace(/\\s+/g, '-')}-dark.svg`)}\n                          >\n                            <Download className=\"h-4 w-4 mr-2\" />\n                            SVG\n                          </Button>\n                          {pngSizes.map((size) => (\n                            <Button\n                              key={size}\n                              variant=\"outline\"\n                              size=\"sm\"\n                              disabled={downloading === `${variant.name}-dark-${size}`}\n                            onClick={() => downloadPng(\n                                variant.darkSvg,\n                                `lapacho-${variant.name.toLowerCase().replace(/\\s+/g, '-')}-dark`,\n                                variant.width,\n                                variant.height,\n                                size,\n                                true\n                              )}\n                            >\n                              <Download className=\"h-4 w-4 mr-2\" />\n                              PNG {size}px\n                            </Button>\n                          ))}\n                        </div>\n                      </div>\n                    </TabsContent>\n                  </Tabs>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </section>\n\n        {/* Usage Guidelines */}\n        <section className=\"mt-12\">\n          <h2 className=\"text-2xl font-semibold mb-4 text-foreground\">Gu√≠a de Uso</h2>\n          <Card>\n            <CardContent className=\"pt-6\">\n              <div className=\"grid md:grid-cols-2 gap-6\">\n                <div>\n                  <h3 className=\"font-semibold text-foreground mb-2\">‚úì Uso Correcto</h3>\n                  <ul className=\"text-sm text-muted-foreground space-y-1\">\n                    <li>‚Ä¢ Usar los colores oficiales de la marca</li>\n                    <li>‚Ä¢ Mantener proporciones originales</li>\n                    <li>‚Ä¢ Dejar espacio suficiente alrededor del logo</li>\n                    <li>‚Ä¢ Usar tema claro sobre fondos claros</li>\n                    <li>‚Ä¢ Usar tema oscuro sobre fondos oscuros</li>\n                  </ul>\n                </div>\n                <div>\n                  <h3 className=\"font-semibold text-foreground mb-2\">‚úó Evitar</h3>\n                  <ul className=\"text-sm text-muted-foreground space-y-1\">\n                    <li>‚Ä¢ Distorsionar o estirar el logo</li>\n                    <li>‚Ä¢ Cambiar los colores de la marca</li>\n                    <li>‚Ä¢ Agregar efectos como sombras o brillos</li>\n                    <li>‚Ä¢ Usar sobre fondos que reduzcan legibilidad</li>\n                    <li>‚Ä¢ Rotar o inclinar el logo</li>\n                  </ul>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </section>\n      </main>\n    </div>\n  );\n};\n\nexport default BrandAssets;\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\pages\\Contacto.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\pages\\Landing.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\pages\\NotFound.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\pages\\PaymentConfirmation.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[569,572],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[569,572],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":152,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":152,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5542,5545],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5542,5545],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from \"react\";\nimport { useNavigate, useSearchParams } from \"react-router-dom\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { CheckCircle, XCircle, Clock, ArrowLeft, MessageCircle } from \"lucide-react\";\nimport { toast } from \"sonner\";\n\ninterface OrderDetails {\n  id: string;\n  customer_name: string;\n  total: number;\n  status: string;\n  payment_status: string;\n  items: any[];\n}\n\nconst PaymentConfirmation = () => {\n  const [searchParams] = useSearchParams();\n  const navigate = useNavigate();\n  const [order, setOrder] = useState<OrderDetails | null>(null);\n  const [loading, setLoading] = useState(true);\n\n  const orderId = searchParams.get(\"orderId\") || searchParams.get(\"external_reference\");\n  const status = searchParams.get(\"status\") || searchParams.get(\"collection_status\");\n  const paymentId = searchParams.get(\"payment_id\") || searchParams.get(\"collection_id\");\n\n  useEffect(() => {\n    const fetchOrder = async () => {\n      if (!orderId) {\n        toast.error(\"No se encontr√≥ el ID del pedido\");\n        setLoading(false);\n        return;\n      }\n\n      try {\n        const { data, error } = await supabase\n          .from(\"orders\")\n          .select(\"*\")\n          .eq(\"id\", orderId)\n          .single();\n\n        if (error) throw error;\n        setOrder(data as OrderDetails);\n      } catch (error) {\n        console.error(\"Error fetching order:\", error);\n        toast.error(\"Error al cargar los detalles del pedido\");\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchOrder();\n  }, [orderId]);\n\n  const getStatusConfig = () => {\n    const statusLower = status?.toLowerCase();\n    \n    if (statusLower === \"approved\" || statusLower === \"success\") {\n      return {\n        icon: <CheckCircle className=\"w-16 h-16 text-green-500\" />,\n        title: \"¬°Pago Exitoso!\",\n        description: \"Tu pago ha sido procesado correctamente\",\n        message: \"Tu pedido est√° siendo preparado. Recibir√°s actualizaciones por WhatsApp.\",\n        color: \"text-green-600\",\n        bgColor: \"bg-green-50\",\n      };\n    } else if (statusLower === \"pending\" || statusLower === \"in_process\") {\n      return {\n        icon: <Clock className=\"w-16 h-16 text-yellow-500\" />,\n        title: \"Pago Pendiente\",\n        description: \"Tu pago est√° siendo verificado\",\n        message: \"Estamos procesando tu pago. Te notificaremos cuando se confirme.\",\n        color: \"text-yellow-600\",\n        bgColor: \"bg-yellow-50\",\n      };\n    } else {\n      return {\n        icon: <XCircle className=\"w-16 h-16 text-red-500\" />,\n        title: \"Pago No Completado\",\n        description: \"Hubo un problema con tu pago\",\n        message: \"Por favor, intenta nuevamente o contacta con el vendedor.\",\n        color: \"text-red-600\",\n        bgColor: \"bg-red-50\",\n      };\n    }\n  };\n\n  const statusConfig = getStatusConfig();\n\n  const handleWhatsAppRedirect = () => {\n    // Redirect to WhatsApp\n    window.location.href = `https://wa.me/${import.meta.env.VITE_WHATSAPP_NUMBER || \"\"}`;\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-background\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4\"></div>\n          <p className=\"text-muted-foreground\">Cargando informaci√≥n del pago...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background p-4\">\n      <div className=\"max-w-2xl mx-auto py-8\">\n        <Card>\n          <CardHeader className=\"text-center\">\n            <div className=\"flex justify-center mb-4\">\n              {statusConfig.icon}\n            </div>\n            <CardTitle className={`text-2xl ${statusConfig.color}`}>\n              {statusConfig.title}\n            </CardTitle>\n            <CardDescription className=\"text-base\">\n              {statusConfig.description}\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            <div className={`p-4 rounded-lg ${statusConfig.bgColor}`}>\n              <p className={`text-center ${statusConfig.color}`}>\n                {statusConfig.message}\n              </p>\n            </div>\n\n            {paymentId && (\n              <div className=\"border-t pt-4\">\n                <p className=\"text-sm text-muted-foreground\">\n                  <strong>ID de Pago:</strong> {paymentId}\n                </p>\n              </div>\n            )}\n\n            {order && (\n              <div className=\"border-t pt-4 space-y-2\">\n                <h3 className=\"font-semibold text-lg\">Detalles del Pedido</h3>\n                <div className=\"space-y-1 text-sm\">\n                  <p><strong>Pedido:</strong> #{order.id.slice(0, 8)}</p>\n                  <p><strong>Cliente:</strong> {order.customer_name}</p>\n                  <p><strong>Total:</strong> ${order.total}</p>\n                  <p><strong>Estado del Pedido:</strong> {order.status}</p>\n                  <p><strong>Estado del Pago:</strong> {order.payment_status || \"Pendiente\"}</p>\n                </div>\n                \n                {order.items && order.items.length > 0 && (\n                  <div className=\"mt-4\">\n                    <p className=\"font-medium mb-2\">Productos:</p>\n                    <ul className=\"space-y-1 text-sm\">\n                      {order.items.map((item: any, index: number) => (\n                        <li key={index}>\n                          {item.quantity}x {item.product_name || item.name} - ${item.price}\n                        </li>\n                      ))}\n                    </ul>\n                  </div>\n                )}\n              </div>\n            )}\n\n            <div className=\"flex flex-col sm:flex-row gap-3 pt-4\">\n              <Button\n                onClick={handleWhatsAppRedirect}\n                className=\"flex-1\"\n                variant=\"default\"\n              >\n                <MessageCircle className=\"w-4 h-4 mr-2\" />\n                Volver a WhatsApp\n              </Button>\n              <Button\n                onClick={() => navigate(\"/\")}\n                variant=\"outline\"\n                className=\"flex-1\"\n              >\n                <ArrowLeft className=\"w-4 h-4 mr-2\" />\n                Ir al Inicio\n              </Button>\n            </div>\n\n            {status?.toLowerCase() === \"failure\" && (\n              <div className=\"text-center pt-2\">\n                <p className=\"text-sm text-muted-foreground mb-2\">\n                  ¬øNecesitas ayuda?\n                </p>\n                <Button\n                  onClick={handleWhatsAppRedirect}\n                  variant=\"link\"\n                  className=\"text-primary\"\n                >\n                  Contactar con el vendedor\n                </Button>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n};\n\nexport default PaymentConfirmation;\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\pages\\Platform.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'checkAuth'. Either include it or remove the dependency array.","line":29,"column":6,"nodeType":"ArrayExpression","endLine":29,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [checkAuth]","fix":{"range":[1298,1300],"text":"[checkAuth]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":76,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2456,2459],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2456,2459],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { VendorDashboardWithRealtime } from \"@/components/VendorDashboardWithRealtime\";\nimport { VendorCatalog } from \"@/components/VendorCatalog\";\nimport { OrderTracking } from \"@/components/OrderTracking\";\nimport { AdminPanel } from \"@/components/AdminPanel\";\nimport { EvolutionConfig } from \"@/components/EvolutionConfig\";\nimport { Vendor } from \"@/types/order\";\nimport { Store } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useRealtimeOrders } from \"@/hooks/useRealtimeOrders\";\nimport lapachoLogo from \"@/assets/lapacho-logo.png\";\nimport lapachoIcon from \"@/assets/lapacho-icon.png\";\n\nconst Platform = () => {\n  const [vendors, setVendors] = useState<Vendor[]>([]);\n  const [selectedVendor, setSelectedVendor] = useState<Vendor | null>(null);\n  const [loadingVendors, setLoadingVendors] = useState(true);\n  const [loading, setLoading] = useState(true);\n  const navigate = useNavigate();\n  const { toast } = useToast();\n  const { orders } = useRealtimeOrders();\n\n  // Check authentication\n  useEffect(() => {\n    checkAuth();\n  }, []);\n\n  const checkAuth = async () => {\n    try {\n      const { data: { session } } = await supabase.auth.getSession();\n      \n      if (!session) {\n        navigate('/vendor-auth');\n        return;\n      }\n\n      // Verify vendor profile exists\n      const { data: vendor, error } = await supabase\n        .from('vendors')\n        .select('*')\n        .eq('user_id', session.user.id)\n        .single();\n\n      if (error || !vendor) {\n        toast({\n          title: \"Acceso denegado\",\n          description: \"No tienes un perfil de vendedor asociado\",\n          variant: \"destructive\",\n        });\n        navigate('/vendor-auth');\n        return;\n      }\n\n      setLoading(false);\n    } catch (error) {\n      console.error('Error checking auth:', error);\n      navigate('/vendor-auth');\n    }\n  };\n\n  // Fetch vendors from Supabase\n  useEffect(() => {\n    const fetchVendors = async () => {\n      try {\n        const { data, error } = await supabase\n          .from('vendors')\n          .select('*')\n          .eq('is_active', true)\n          .order('name');\n\n        if (error) throw error;\n\n        const formattedVendors: Vendor[] = data?.map((vendor: any) => ({\n          id: vendor.id,\n          name: vendor.name,\n          category: vendor.category,\n          phone: vendor.phone,\n          whatsappNumber: vendor.whatsapp_number,\n          address: vendor.address,\n          isActive: vendor.is_active,\n          rating: Number(vendor.rating),\n          totalOrders: vendor.total_orders,\n          joinedAt: new Date(vendor.joined_at),\n          image: vendor.image,\n          openingTime: vendor.opening_time,\n          closingTime: vendor.closing_time,\n          daysOpen: vendor.days_open,\n          availableProducts: vendor.available_products\n        })) || [];\n\n        setVendors(formattedVendors);\n        if (formattedVendors.length > 0) {\n          setSelectedVendor(formattedVendors[0]);\n        }\n      } catch (error) {\n        console.error('Error fetching vendors:', error);\n        toast({\n          title: 'Error',\n          description: 'No se pudieron cargar los vendedores',\n          variant: 'destructive'\n        });\n      } finally {\n        setLoadingVendors(false);\n      }\n    };\n\n    fetchVendors();\n  }, [toast]);\n\n  const handleToggleVendorStatus = async (vendorId: string) => {\n    try {\n      const vendor = vendors.find(v => v.id === vendorId);\n      const newStatus = !vendor?.isActive;\n\n      const { error } = await supabase\n        .from('vendors')\n        .update({ is_active: newStatus })\n        .eq('id', vendorId);\n\n      if (error) throw error;\n\n      setVendors(prevVendors =>\n        prevVendors.map(vendor =>\n          vendor.id === vendorId\n            ? { ...vendor, isActive: newStatus }\n            : vendor\n        )\n      );\n      \n      toast({\n        title: newStatus ? \"Vendedor activado\" : \"Vendedor desactivado\",\n        description: `${vendor?.name} ha sido ${newStatus ? 'activado' : 'desactivado'}`,\n      });\n    } catch (error) {\n      console.error('Error updating vendor status:', error);\n      toast({\n        title: 'Error',\n        description: 'No se pudo actualizar el estado del vendedor',\n        variant: 'destructive'\n      });\n    }\n  };\n\n  if (loading || loadingVendors) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto\"></div>\n          <p className=\"mt-4 text-muted-foreground\">Cargando plataforma...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-subtle\">\n      {/* Header */}\n      <header className=\"bg-white shadow-sm border-b sticky top-0 z-40\">\n        <div className=\"container mx-auto px-4 py-4\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3 justify-center md:justify-start flex-1 md:flex-initial\">\n              <img src={lapachoIcon} alt=\"Lapacho\" className=\"h-8 md:hidden\" />\n              <img src={lapachoLogo} alt=\"Lapacho Logo\" className=\"h-12 hidden md:block\" />\n              <span className=\"text-xl font-bold md:hidden\">Lapacho</span>\n            </div>\n            <div className=\"flex items-center gap-4\">\n              <a \n                href=\"/ayuda\"\n                className=\"text-sm text-primary hover:underline flex items-center gap-1\"\n              >\n                Ayuda\n              </a>\n              <a \n                href=\"/vendor-auth\"\n                className=\"text-sm text-primary hover:underline flex items-center gap-1\"\n              >\n                <Store className=\"h-4 w-4\" />\n                Acceso Vendedores\n              </a>\n              <div className=\"w-2 h-2 bg-primary rounded-full animate-pulse\" />\n            </div>\n          </div>\n        </div>\n      </header>\n\n      {/* Main Content */}\n      <main className=\"container mx-auto px-4 py-8\">\n        <Tabs defaultValue=\"catalog\" className=\"w-full\">\n          <TabsList className=\"grid w-full grid-cols-6 mb-8\">\n            <TabsTrigger value=\"catalog\">Cat√°logo</TabsTrigger>\n            <TabsTrigger value=\"vendor\">Panel Vendedor</TabsTrigger>\n            <TabsTrigger value=\"tracking\">Seguimiento</TabsTrigger>\n            <TabsTrigger value=\"admin\">Administraci√≥n</TabsTrigger>\n            <TabsTrigger value=\"whatsapp\">WhatsApp Bot</TabsTrigger>\n            <TabsTrigger value=\"about\">Acerca de</TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"catalog\">\n            <VendorCatalog />\n          </TabsContent>\n\n          <TabsContent value=\"vendor\">\n            {selectedVendor && (\n              <VendorDashboardWithRealtime vendor={selectedVendor} />\n            )}\n          </TabsContent>\n\n          <TabsContent value=\"tracking\">\n            <div className=\"space-y-6\">\n              {orders.slice(0, 5).map(order => (\n                <OrderTracking key={order.id} order={order} />\n              ))}\n              {orders.length === 0 && (\n                <div className=\"text-center py-12 text-muted-foreground\">\n                  <p>No hay pedidos para rastrear</p>\n                </div>\n              )}\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"admin\">\n            <AdminPanel\n              vendors={vendors}\n              onToggleVendorStatus={handleToggleVendorStatus}\n            />\n          </TabsContent>\n\n          <TabsContent value=\"whatsapp\">\n            <EvolutionConfig />\n          </TabsContent>\n\n          <TabsContent value=\"about\" className=\"space-y-6\">\n            <div className=\"text-center max-w-3xl mx-auto\">\n              <div className=\"mb-8\">\n                <img src={lapachoLogo} alt=\"Lapacho\" className=\"h-24 mx-auto mb-4\" />\n                <h2 className=\"text-3xl font-bold mb-4 bg-gradient-primary bg-clip-text text-transparent\">\n                  Tu Delivery Local\n                </h2>\n                <p className=\"text-muted-foreground mb-4\">\n                  Conectamos vendedores locales con clientes de forma simple y eficiente.\n                </p>\n                <p className=\"text-muted-foreground\">\n                  Conectamos vendedores locales con clientes a trav√©s de WhatsApp Business, \n                  facilitando pedidos y entregas en toda la ciudad de manera simple y eficiente.\n                </p>\n              </div>\n              \n              <div className=\"grid md:grid-cols-3 gap-6 text-left\">\n                <div className=\"bg-card p-6 rounded-lg shadow-sm border-t-4 border-primary\">\n                  <div className=\"text-3xl mb-3\">üõµ</div>\n                  <h3 className=\"font-semibold mb-2\">Delivery R√°pido</h3>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Procesamiento instant√°neo de pedidos con tiempos de entrega de 30-45 minutos\n                  </p>\n                </div>\n                \n                <div className=\"bg-card p-6 rounded-lg shadow-sm border-t-4 border-primary\">\n                  <div className=\"text-3xl mb-3\">üí¨</div>\n                  <h3 className=\"font-semibold mb-2\">WhatsApp Business</h3>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Bot inteligente que entiende tus pedidos y te conecta con los mejores locales\n                  </p>\n                </div>\n                \n                <div className=\"bg-card p-6 rounded-lg shadow-sm border-t-4 border-primary\">\n                  <div className=\"text-3xl mb-3\">üè™</div>\n                  <h3 className=\"font-semibold mb-2\">Locales Verificados</h3>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Restaurantes, farmacias y mercados con productos actualizados y precios reales\n                  </p>\n                </div>\n              </div>\n            </div>\n          </TabsContent>\n        </Tabs>\n      </main>\n    </div>\n  );\n};\n\nexport default Platform;\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\pages\\Privacidad.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\pages\\ProductImage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\pages\\Soporte.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'checkSoporteAccess'. Either include it or remove the dependency array.","line":21,"column":6,"nodeType":"ArrayExpression","endLine":21,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [checkSoporteAccess]","fix":{"range":[851,853],"text":"[checkSoporteAccess]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { Button } from \"@/components/ui/button\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { LogOut, Headphones } from \"lucide-react\";\nimport SupportPanel from \"@/components/admin/SupportPanel\";\nimport { PWAInstallPrompt } from \"@/components/PWAInstallPrompt\";\nimport lapachoLogo from \"@/assets/lapacho-logo.png\";\nimport lapachoIcon from \"@/assets/lapacho-icon.png\";\n\nexport default function Soporte() {\n  const [loading, setLoading] = useState(true);\n  const [hasAccess, setHasAccess] = useState(false);\n  const [userRole, setUserRole] = useState<string | null>(null);\n  const navigate = useNavigate();\n  const { toast } = useToast();\n\n  useEffect(() => {\n    checkSoporteAccess();\n  }, []);\n\n  const checkSoporteAccess = async () => {\n    try {\n      const { data: { session } } = await supabase.auth.getSession();\n      \n      if (!session) {\n        navigate('/soporte-auth');\n        return;\n      }\n\n      const { data: roles, error } = await supabase\n        .from('user_roles')\n        .select('role')\n        .eq('user_id', session.user.id)\n        .in('role', ['admin', 'soporte']);\n\n      if (error || !roles || roles.length === 0) {\n        toast({\n          title: \"Acceso denegado\",\n          description: \"No tienes permisos para acceder al panel de soporte\",\n          variant: \"destructive\",\n        });\n        setHasAccess(false);\n        setLoading(false);\n        return;\n      }\n\n      setUserRole(roles[0].role);\n      setHasAccess(true);\n    } catch (error) {\n      console.error('Error checking soporte access:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSignOut = async () => {\n    try {\n      const { error } = await supabase.auth.signOut();\n      if (error) {\n        toast({\n          title: \"Error al cerrar sesi√≥n\",\n          description: error.message,\n          variant: \"destructive\",\n        });\n        return;\n      }\n      toast({\n        title: \"Sesi√≥n cerrada\",\n        description: \"Has cerrado sesi√≥n correctamente\",\n      });\n      navigate('/');\n    } catch (error) {\n      console.error('Error signing out:', error);\n      toast({\n        title: \"Error\",\n        description: \"No se pudo cerrar la sesi√≥n. Por favor, intenta de nuevo.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto\"></div>\n          <p className=\"mt-4 text-muted-foreground\">Verificando acceso...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!hasAccess && !loading) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <header className=\"border-b bg-card sticky top-0 z-50\">\n          <div className=\"container mx-auto px-4 py-4\">\n            <div className=\"flex justify-between items-center\">\n              <div className=\"flex items-center gap-3 justify-center md:justify-start flex-1 md:flex-initial\">\n                <img src={lapachoIcon} alt=\"Lapacho\" className=\"h-8 md:hidden\" />\n                <img src={lapachoLogo} alt=\"Lapacho Logo\" className=\"h-10 hidden md:block\" />\n                <span className=\"text-xl font-bold md:hidden\">Lapacho</span>\n              </div>\n              <Button variant=\"ghost\" onClick={() => navigate('/')}>\n                Inicio\n              </Button>\n            </div>\n          </div>\n        </header>\n\n        <main className=\"container mx-auto px-4 py-8\">\n          <div className=\"max-w-md mx-auto text-center\">\n            <Headphones className=\"h-16 w-16 text-primary mx-auto mb-6\" />\n            <h2 className=\"text-2xl font-bold mb-4\">Panel de Soporte</h2>\n            <p className=\"text-muted-foreground mb-6\">\n              No tienes permisos para acceder al panel de soporte.\n            </p>\n            <div className=\"space-y-3\">\n              <Button \n                onClick={() => navigate('/soporte-auth')} \n                variant=\"default\"\n                className=\"w-full\"\n                size=\"lg\"\n              >\n                Iniciar Sesi√≥n\n              </Button>\n              <Button \n                onClick={() => navigate('/')} \n                variant=\"ghost\"\n                className=\"w-full\"\n              >\n                Volver al Inicio\n              </Button>\n            </div>\n          </div>\n        </main>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <PWAInstallPrompt userType=\"soporte\" />\n      <header className=\"border-b bg-card sticky top-0 z-50\">\n        <div className=\"container mx-auto px-4 py-4\">\n          <div className=\"flex justify-between items-center\">\n            <div className=\"flex items-center gap-3 justify-center md:justify-start flex-1 md:flex-initial\">\n              <img src={lapachoIcon} alt=\"Lapacho\" className=\"h-8 md:hidden\" />\n              <img src={lapachoLogo} alt=\"Lapacho Logo\" className=\"h-10 hidden md:block\" />\n              <div>\n                <h1 className=\"text-xl md:text-2xl font-bold md:hidden\">Lapacho</h1>\n                <p className=\"text-xs text-muted-foreground capitalize hidden md:block\">Rol: {userRole}</p>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-4\">\n              <Button variant=\"ghost\" onClick={() => navigate('/')}>\n                Inicio\n              </Button>\n              {userRole === 'admin' && (\n                <Button variant=\"ghost\" onClick={() => navigate('/admin')}>\n                  Panel Admin\n                </Button>\n              )}\n              <Button onClick={handleSignOut} variant=\"outline\">\n                <LogOut className=\"mr-2 h-4 w-4\" />\n                Cerrar Sesi√≥n\n              </Button>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"container mx-auto px-4 py-8\">\n        <div className=\"mb-6 text-center\">\n          <Headphones className=\"h-12 w-12 text-primary mx-auto mb-4\" />\n          <h2 className=\"text-2xl font-semibold mb-2\">Sistema de Tickets de Soporte</h2>\n          <p className=\"text-muted-foreground\">\n            Gestiona las consultas y problemas reportados por clientes y vendedores\n          </p>\n        </div>\n        \n        <SupportPanel />\n      </main>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\pages\\SoporteAuth.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1916,1919],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1916,1919],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Headphones } from \"lucide-react\";\nimport lapachoLogo from \"@/assets/lapacho-logo.png\";\n\nexport default function SoporteAuth() {\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n  const navigate = useNavigate();\n  const { toast } = useToast();\n\n  const handleLogin = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n\n    try {\n      const { data: authData, error: authError } = await supabase.auth.signInWithPassword({\n        email,\n        password,\n      });\n\n      if (authError) throw authError;\n\n      if (!authData.user) {\n        throw new Error(\"No se pudo obtener la informaci√≥n del usuario\");\n      }\n\n      // Verificar que el usuario tiene rol de soporte o admin\n      const { data: roles, error: rolesError } = await supabase\n        .from('user_roles')\n        .select('role')\n        .eq('user_id', authData.user.id)\n        .in('role', ['admin', 'soporte']);\n\n      if (rolesError) {\n        console.error('Error checking roles:', rolesError);\n        throw new Error(\"Error al verificar permisos\");\n      }\n\n      if (!roles || roles.length === 0) {\n        await supabase.auth.signOut();\n        toast({\n          title: \"Acceso denegado\",\n          description: \"No tienes permisos para acceder al panel de soporte\",\n          variant: \"destructive\",\n        });\n        setLoading(false);\n        return;\n      }\n\n      toast({\n        title: \"Inicio de sesi√≥n exitoso\",\n        description: \"Bienvenido al panel de soporte\",\n      });\n\n      navigate(\"/soporte\");\n    } catch (error: any) {\n      console.error('Login error:', error);\n      toast({\n        title: \"Error al iniciar sesi√≥n\",\n        description: error.message || \"Verifica tus credenciales e intenta nuevamente\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background flex items-center justify-center p-4\">\n      <div className=\"w-full max-w-md\">\n        <div className=\"text-center mb-8\">\n          <img src={lapachoLogo} alt=\"Lapacho Logo\" className=\"h-16 mx-auto mb-4\" />\n          <Headphones className=\"h-12 w-12 text-primary mx-auto mb-4\" />\n          <h1 className=\"text-3xl font-bold mb-2\">Panel de Soporte</h1>\n          <p className=\"text-muted-foreground\">\n            Ingresa con tu cuenta de soporte\n          </p>\n        </div>\n\n        <div className=\"bg-card border rounded-lg p-6 shadow-sm\">\n          <form onSubmit={handleLogin} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <label htmlFor=\"email\" className=\"text-sm font-medium\">\n                Correo electr√≥nico\n              </label>\n              <Input\n                id=\"email\"\n                type=\"email\"\n                placeholder=\"tu@email.com\"\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n                required\n                disabled={loading}\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <label htmlFor=\"password\" className=\"text-sm font-medium\">\n                Contrase√±a\n              </label>\n              <Input\n                id=\"password\"\n                type=\"password\"\n                placeholder=\"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢\"\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                required\n                disabled={loading}\n              />\n            </div>\n\n            <Button type=\"submit\" className=\"w-full\" disabled={loading}>\n              {loading ? \"Iniciando sesi√≥n...\" : \"Iniciar sesi√≥n\"}\n            </Button>\n          </form>\n        </div>\n\n        <div className=\"mt-4 text-center\">\n          <Button variant=\"ghost\" onClick={() => navigate('/')}>\n            Volver al Inicio\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\pages\\Terminos.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\pages\\VendorAuth.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'checkVendorProfile'. Either include it or remove the dependency array.","line":47,"column":6,"nodeType":"ArrayExpression","endLine":47,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [checkVendorProfile]","fix":{"range":[1770,1772],"text":"[checkVendorProfile]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":90,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2804,2807],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2804,2807],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":140,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":140,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3978,3981],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3978,3981],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":167,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":167,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4523,4526],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4523,4526],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { supabase } from '@/integrations/supabase/client';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { useToast } from '@/hooks/use-toast';\nimport { User } from '@supabase/supabase-js';\nimport { MessageSquare } from 'lucide-react';\nimport lapachoIcon from '@/assets/lapacho-icon.png';\n\nexport default function VendorAuth() {\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [vendorName, setVendorName] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [user, setUser] = useState<User | null>(null);\n  const [hasVendorProfile, setHasVendorProfile] = useState<boolean | null>(null);\n  const navigate = useNavigate();\n  const { toast } = useToast();\n\n  useEffect(() => {\n    // Check if user is already logged in\n    supabase.auth.getSession().then(({ data: { session } }) => {\n      if (session?.user) {\n        setUser(session.user);\n        // Check if vendor profile exists\n        checkVendorProfile(session.user.id);\n      }\n    });\n\n    // Listen for auth changes\n    const { data: { subscription } } = supabase.auth.onAuthStateChange((event, session) => {\n      if (session?.user) {\n        setUser(session.user);\n        if (event === 'SIGNED_IN') {\n          checkVendorProfile(session.user.id);\n        }\n      } else {\n        setUser(null);\n      }\n    });\n\n    return () => subscription.unsubscribe();\n  }, []);\n\n  const checkVendorProfile = async (userId: string) => {\n    const { data: vendor } = await supabase\n      .from('vendors')\n      .select('*')\n      .eq('user_id', userId)\n      .maybeSingle();\n\n    if (vendor) {\n      setHasVendorProfile(true);\n      navigate('/vendor-dashboard');\n    } else {\n      setHasVendorProfile(false);\n    }\n  };\n\n  const handleCreateProfile = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n\n    try {\n      if (!user) throw new Error('No hay usuario autenticado');\n\n      const { error: vendorError } = await supabase\n        .from('vendors')\n        .insert({\n          user_id: user.id,\n          name: vendorName,\n          category: 'restaurant',\n          phone: '',\n          address: '',\n          is_active: false\n        });\n\n      if (vendorError) throw vendorError;\n\n      toast({\n        title: '‚úÖ Perfil creado',\n        description: 'Tu perfil de vendedor ha sido creado exitosamente',\n      });\n\n      navigate('/vendor-dashboard');\n    } catch (error: any) {\n      toast({\n        title: 'Error',\n        description: error.message,\n        variant: 'destructive'\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSignUp = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n\n    try {\n      // Sign up with vendor role\n      const { data, error } = await supabase.auth.signUp({\n        email,\n        password,\n        options: {\n          data: {\n            role: 'vendor'\n          },\n          emailRedirectTo: `${window.location.origin}/vendor-auth`\n        }\n      });\n\n      if (error) throw error;\n\n      if (data.user) {\n        // Create vendor profile\n        const { error: vendorError } = await supabase\n          .from('vendors')\n          .insert({\n            user_id: data.user.id,\n            name: vendorName,\n            category: 'restaurant',\n            phone: '',\n            address: '',\n            is_active: false\n          });\n\n        if (vendorError) throw vendorError;\n\n        toast({\n          title: '‚úÖ Cuenta creada',\n          description: 'Por favor verifica tu email antes de iniciar sesi√≥n',\n        });\n      }\n    } catch (error: any) {\n      toast({\n        title: 'Error',\n        description: error.message,\n        variant: 'destructive'\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSignIn = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n\n    try {\n      const { error } = await supabase.auth.signInWithPassword({\n        email,\n        password\n      });\n\n      if (error) throw error;\n\n      toast({\n        title: '‚úÖ Bienvenido',\n        description: 'Iniciando sesi√≥n...',\n      });\n    } catch (error: any) {\n      let errorMessage = error.message;\n      \n      // Handle network errors\n      if (error.message === 'Failed to fetch' || error.name === 'TypeError') {\n        errorMessage = 'Error de conexi√≥n. Verifica tu internet y vuelve a intentarlo.';\n      } else if (error.message?.includes('Invalid login credentials')) {\n        errorMessage = 'Email o contrase√±a incorrectos.';\n      }\n      \n      toast({\n        title: 'Error',\n        description: errorMessage,\n        variant: 'destructive'\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSignOut = async () => {\n    await supabase.auth.signOut();\n    navigate('/');\n  };\n\n  if (user) {\n    // Si el usuario no tiene perfil de vendedor, mostrar formulario para crearlo\n    if (hasVendorProfile === false) {\n      return (\n        <div className=\"min-h-screen bg-background flex items-center justify-center p-4\">\n          <Card className=\"w-full max-w-md\">\n            <CardHeader>\n              <div className=\"flex justify-center mb-6\">\n                <img src={lapachoIcon} alt=\"Lapacho\" className=\"h-20 w-auto\" />\n              </div>\n              <CardTitle>Crear Perfil de Vendedor</CardTitle>\n              <CardDescription>\n                Tu cuenta ({user.email}) no tiene un perfil de vendedor. Completa el formulario para crear uno.\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <form onSubmit={handleCreateProfile} className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"vendor-name\">Nombre del Negocio</Label>\n                  <Input\n                    id=\"vendor-name\"\n                    type=\"text\"\n                    placeholder=\"Mi Restaurante\"\n                    value={vendorName}\n                    onChange={(e) => setVendorName(e.target.value)}\n                    required\n                  />\n                </div>\n                <Button type=\"submit\" className=\"w-full\" disabled={loading}>\n                  {loading ? 'Creando perfil...' : 'Crear Perfil de Vendedor'}\n                </Button>\n                <Button \n                  type=\"button\"\n                  onClick={handleSignOut}\n                  variant=\"outline\"\n                  className=\"w-full\"\n                >\n                  Cerrar Sesi√≥n\n                </Button>\n              </form>\n            </CardContent>\n          </Card>\n        </div>\n      );\n    }\n\n    // Si tiene perfil, mostrar opciones normales\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center p-4\">\n        <Card className=\"w-full max-w-md\">\n          <CardHeader>\n            <CardTitle>Ya has iniciado sesi√≥n</CardTitle>\n            <CardDescription>\n              {user.email}\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <Button \n              onClick={() => navigate('/vendor-dashboard')}\n              className=\"w-full\"\n            >\n              Ir al Panel de Vendedor\n            </Button>\n            <Button \n              onClick={handleSignOut}\n              variant=\"outline\"\n              className=\"w-full\"\n            >\n              Cerrar Sesi√≥n\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background flex items-center justify-center p-4\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader>\n          <div className=\"flex justify-center mb-6\">\n            <img src={lapachoIcon} alt=\"Lapacho\" className=\"h-20 w-auto\" />\n          </div>\n          <CardTitle>Panel de Vendedor</CardTitle>\n          <CardDescription>Accede a tu panel para gestionar pedidos y tu negocio</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleSignIn} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"email\">Email</Label>\n              <Input id=\"email\" type=\"email\" placeholder=\"vendedor@ejemplo.com\" value={email} onChange={(e) => setEmail(e.target.value)} required />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"password\">Contrase√±a</Label>\n              <Input id=\"password\" type=\"password\" value={password} onChange={(e) => setPassword(e.target.value)} required />\n            </div>\n            <Button type=\"submit\" className=\"w-full\" disabled={loading}>\n              {loading ? 'Iniciando sesi√≥n...' : 'Iniciar Sesi√≥n'}\n            </Button>\n          </form>\n          <div className=\"mt-6 pt-6 border-t\">\n            <p className=\"text-sm text-center text-muted-foreground mb-4\">¬øNo tienes una cuenta de vendedor?</p>\n            <Button variant=\"outline\" className=\"w-full\" onClick={() => {\n              const whatsappNumber = '5493464448309';\n              const message = encodeURIComponent('Hola, quiero registrar mi negocio en Lapacho');\n              window.open(`https://wa.me/${whatsappNumber}?text=${message}`, '_blank');\n            }}>\n              <MessageSquare className=\"mr-2 h-4 w-4\" />\n              Contactar para Registrarse\n            </Button>\n          </div>\n          <Button variant=\"ghost\" className=\"w-full mt-4\" onClick={() => navigate('/')}>Volver al Inicio</Button>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\pages\\VendorDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":52,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2558,2561],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2558,2561],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'checkAuth' and 'toast'. Either include them or remove the dependency array.","line":72,"column":6,"nodeType":"ArrayExpression","endLine":72,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [checkAuth, toast]","fix":{"range":[3228,3230],"text":"[checkAuth, toast]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { supabase } from '@/integrations/supabase/client';\nimport { User } from '@supabase/supabase-js';\nimport { VendorDashboardWithRealtime } from '@/components/VendorDashboardWithRealtime';\nimport { VendorProductManager } from '@/components/VendorProductManager';\nimport { VendorHoursManager } from '@/components/VendorHoursManager';\nimport { VendorSettings } from '@/components/VendorSettings';\nimport { VendorOffersManager } from '@/components/VendorOffersManager';\nimport { VendorReviews } from '@/components/VendorReviews';\nimport { VendorDirectChat } from '@/components/VendorDirectChat';\nimport { VendorSupportTickets } from '@/components/VendorSupportTickets';\nimport { VendorPaymentSettings } from '@/components/VendorPaymentSettings';\nimport { VendorPaymentMetrics } from '@/components/VendorPaymentMetrics';\nimport { VendorAnalyticsDashboard } from '@/components/VendorAnalyticsDashboard';\nimport { PlatformReviewForm } from '@/components/PlatformReviewForm';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport {\n  Sheet,\n  SheetContent,\n  SheetHeader,\n  SheetTitle,\n  SheetTrigger,\n} from \"@/components/ui/sheet\";\nimport { useToast } from '@/hooks/use-toast';\nimport { \n  Loader2, Package, Clock, Settings, LayoutDashboard, Tag, Star, \n  MessageCircle, LifeBuoy, CreditCard, Heart, BarChart3, Menu, LogOut \n} from 'lucide-react';\nimport { PWAInstallPrompt } from '@/components/PWAInstallPrompt';\nimport lapachoIcon from \"@/assets/lapacho-icon.png\";\nimport { cn } from \"@/lib/utils\";\n\nconst menuItems = [\n  { value: \"dashboard\", label: \"Pedidos\", icon: LayoutDashboard },\n  { value: \"products\", label: \"Productos\", icon: Package },\n  { value: \"offers\", label: \"Ofertas\", icon: Tag },\n  { value: \"chats\", label: \"Chats\", icon: MessageCircle },\n  { value: \"reviews\", label: \"Rese√±as\", icon: Star },\n  { value: \"hours\", label: \"Horarios\", icon: Clock },\n  { value: \"metrics\", label: \"M√©tricas\", icon: BarChart3 },\n  { value: \"payments\", label: \"Pagos\", icon: CreditCard },\n  { value: \"settings\", label: \"Ajustes\", icon: Settings },\n  { value: \"support\", label: \"Soporte\", icon: LifeBuoy },\n  { value: \"review\", label: \"Calificar\", icon: Heart },\n];\n\nexport default function VendorDashboard() {\n  const [user, setUser] = useState<User | null>(null);\n  const [vendor, setVendor] = useState<any>(null);\n  const [loading, setLoading] = useState(true);\n  const [activeTab, setActiveTab] = useState(\"dashboard\");\n  const [drawerOpen, setDrawerOpen] = useState(false);\n  const navigate = useNavigate();\n  const { toast } = useToast();\n\n  useEffect(() => {\n    checkAuth();\n    \n    // Check if MercadoPago was just connected\n    const urlParams = new URLSearchParams(window.location.search);\n    if (urlParams.get('mp_connected') === 'true') {\n      toast({\n        title: 'MercadoPago conectado',\n        description: 'Tu cuenta de MercadoPago se conect√≥ exitosamente',\n      });\n      // Clean URL\n      window.history.replaceState({}, '', '/vendor');\n    }\n  }, []);\n\n  const checkAuth = async () => {\n    try {\n      const { data: { session } } = await supabase.auth.getSession();\n      \n      if (!session?.user) {\n        navigate('/vendor-auth');\n        return;\n      }\n\n      setUser(session.user);\n\n      // Get vendor profile\n      const { data: vendorData, error } = await supabase\n        .from('vendors')\n        .select('*')\n        .eq('user_id', session.user.id)\n        .single();\n\n      if (error || !vendorData) {\n        toast({\n          title: 'Error',\n          description: 'No se encontr√≥ el perfil de vendedor',\n          variant: 'destructive'\n        });\n        navigate('/vendor-auth');\n        return;\n      }\n\n      setVendor(vendorData);\n    } catch (error) {\n      console.error('Error checking auth:', error);\n      navigate('/vendor-auth');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSignOut = async () => {\n    await supabase.auth.signOut();\n    navigate('/vendor-auth');\n  };\n\n  const handleMenuItemClick = (value: string) => {\n    setActiveTab(value);\n    setDrawerOpen(false);\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  if (!vendor) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center p-4\">\n        <Card className=\"w-full max-w-md\">\n          <CardHeader>\n            <CardTitle>No autorizado</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-muted-foreground mb-4\">\n              No tienes permisos para acceder a esta p√°gina.\n            </p>\n            <Button onClick={() => navigate('/vendor-auth')} className=\"w-full\">\n              Ir al Login\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  const currentMenuItem = menuItems.find(item => item.value === activeTab);\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <PWAInstallPrompt userType=\"vendor\" />\n      {/* Mobile-responsive header */}\n      <div className=\"bg-card border-b sticky top-0 z-10\">\n        <div className=\"px-4 py-3 flex justify-between items-center\">\n          <div className=\"flex items-center gap-3\">\n            {/* Bot√≥n hamburguesa - solo m√≥vil */}\n            <Sheet open={drawerOpen} onOpenChange={setDrawerOpen}>\n              <SheetTrigger asChild className=\"lg:hidden\">\n                <Button variant=\"ghost\" size=\"icon\">\n                  <Menu className=\"h-5 w-5\" />\n                </Button>\n              </SheetTrigger>\n              <SheetContent side=\"left\" className=\"w-72\">\n                <SheetHeader>\n                  <SheetTitle className=\"flex items-center gap-2\">\n                    <img src={lapachoIcon} alt=\"Lapacho\" className=\"h-6\" />\n                    {vendor.name}\n                  </SheetTitle>\n                </SheetHeader>\n                <nav className=\"mt-6 flex flex-col gap-1\">\n                  {menuItems.map((item) => (\n                    <Button\n                      key={item.value}\n                      variant={activeTab === item.value ? \"secondary\" : \"ghost\"}\n                      className=\"justify-start w-full\"\n                      onClick={() => handleMenuItemClick(item.value)}\n                    >\n                      <item.icon className=\"mr-3 h-4 w-4\" />\n                      {item.label}\n                    </Button>\n                  ))}\n                </nav>\n                <div className=\"absolute bottom-6 left-4 right-4\">\n                  <Button \n                    onClick={handleSignOut} \n                    variant=\"outline\" \n                    className=\"w-full\"\n                  >\n                    <LogOut className=\"mr-2 h-4 w-4\" />\n                    Cerrar Sesi√≥n\n                  </Button>\n                </div>\n              </SheetContent>\n            </Sheet>\n\n            {/* Logo */}\n            <img src={lapachoIcon} alt=\"Lapacho\" className=\"h-8 lg:hidden\" />\n            <h1 className=\"text-lg sm:text-xl font-bold truncate hidden lg:inline\">\n              {vendor.name}\n            </h1>\n          </div>\n          <Button \n            onClick={handleSignOut} \n            variant=\"outline\" \n            size=\"sm\"\n            className=\"ml-2\"\n          >\n            <LogOut className=\"mr-2 h-4 w-4 hidden sm:inline\" />\n            Salir\n          </Button>\n        </div>\n      </div>\n      \n      {/* Dashboard tabs */}\n      <div className=\"container mx-auto p-4\">\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n          {/* TabsList solo visible en desktop */}\n          <TabsList className=\"hidden lg:flex flex-wrap gap-2 h-auto p-1 mb-6\">\n            {menuItems.map((item) => (\n              <TabsTrigger \n                key={item.value} \n                value={item.value} \n                className=\"flex items-center gap-1\"\n              >\n                <item.icon className=\"h-4 w-4\" />\n                <span>{item.label}</span>\n              </TabsTrigger>\n            ))}\n          </TabsList>\n\n          {/* Indicador de secci√≥n actual en m√≥vil */}\n          {currentMenuItem && (\n            <div className=\"lg:hidden mb-4 flex items-center gap-2 px-1\">\n              <currentMenuItem.icon className=\"h-5 w-5 text-primary\" />\n              <h2 className=\"text-lg font-semibold\">{currentMenuItem.label}</h2>\n            </div>\n          )}\n\n          <TabsContent value=\"dashboard\">\n            <VendorDashboardWithRealtime vendor={vendor} />\n          </TabsContent>\n\n          <TabsContent value=\"products\">\n            <VendorProductManager vendorId={vendor.id} />\n          </TabsContent>\n\n          <TabsContent value=\"offers\">\n            <VendorOffersManager vendorId={vendor.id} />\n          </TabsContent>\n\n          <TabsContent value=\"chats\">\n            <VendorDirectChat vendorId={vendor.id} />\n          </TabsContent>\n\n          <TabsContent value=\"reviews\">\n            <VendorReviews vendorId={vendor.id} />\n          </TabsContent>\n\n          <TabsContent value=\"hours\">\n            <VendorHoursManager vendorId={vendor.id} />\n          </TabsContent>\n\n          <TabsContent value=\"metrics\">\n            <div className=\"space-y-8\">\n              <VendorAnalyticsDashboard vendorId={vendor.id} />\n              <VendorPaymentMetrics vendorId={vendor.id} />\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"payments\">\n            <VendorPaymentSettings vendorId={vendor.id} />\n          </TabsContent>\n\n          <TabsContent value=\"settings\">\n            <VendorSettings vendorId={vendor.id} />\n          </TabsContent>\n\n          <TabsContent value=\"support\">\n            <VendorSupportTickets vendorId={vendor.id} />\n          </TabsContent>\n\n          <TabsContent value=\"review\">\n            <PlatformReviewForm \n              userType=\"vendor\"\n              defaultName={vendor.name}\n              defaultPhone={vendor.phone}\n            />\n          </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\types\\order.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1649,1652],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1649,1652],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export type OrderStatus = \n  | 'pending'\n  | 'confirmed'\n  | 'preparing'\n  | 'ready'\n  | 'delivering'\n  | 'delivered'\n  | 'cancelled';\n\nexport type PaymentMethod = 'efectivo' | 'transferencia' | 'mercadopago';\n\nexport interface OrderItem {\n  id: string;\n  name: string;\n  quantity: number;\n  price: number;\n  notes?: string;\n}\n\nexport interface Order {\n  id: string;\n  customerName: string;\n  customerPhone: string;\n  vendorId: string;\n  vendorName: string;\n  items: OrderItem[];\n  total: number;\n  status: OrderStatus;\n  address: string;\n  coordinates?: {\n    lat: number;\n    lng: number;\n  };\n  estimatedDelivery?: Date;\n  createdAt: Date;\n  updatedAt: Date;\n  notes?: string;\n  deliveryPersonName?: string;\n  deliveryPersonPhone?: string;\n  payment_receipt_url?: string;\n  address_is_manual?: boolean;  // Nueva: indica si la direcci√≥n fue ingresada manualmente\n  payment_status?: string;  // Estado de pago: 'pending', 'paid', etc.\n  payment_method?: PaymentMethod;  // M√©todo de pago: 'efectivo', 'transferencia', 'mercadopago'\n  paid_at?: Date;  // Fecha y hora del pago\n  delivery_type?: 'delivery' | 'pickup';  // ‚≠ê NUEVO: Tipo de entrega\n  // Masked fields for vendor view\n  customerNameMasked?: string;\n  customerPhoneMasked?: string;\n  addressSimplified?: string;\n}\n\nexport interface Vendor {\n  id: string;\n  name: string;\n  category: 'restaurant' | 'pharmacy' | 'market' | 'other';\n  phone: string;\n  whatsappNumber?: string;\n  address: string;\n  isActive: boolean;\n  rating: number;\n  totalOrders: number;\n  joinedAt: Date;\n  image?: string;\n  openingTime?: string;\n  closingTime?: string;\n  daysOpen?: string[];\n  availableProducts?: any[];\n}\n\nexport interface Message {\n  id: string;\n  orderId: string;\n  sender: 'customer' | 'vendor' | 'system';\n  content: string;\n  timestamp: Date;\n  isRead: boolean;\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\facun\\Proyectos\\Mios\\pedido-wa-track\\src\\vite-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
